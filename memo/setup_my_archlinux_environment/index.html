<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
  <head>
    <link href="http://gmpg.org/xfn/11" rel="profile">
    <meta charset="utf-8">

    
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

    <title> SETUP MY ARCH LINUX ENVIRONMENT &middot; Mudox </title>

    
    
    
    
    <link rel="stylesheet" href="/css/mudox_hyde.css">

    
    <link rel="stylesheet" href="http://fonts.useso.com/css?family=PT+Sans:400,400italic,700|Abril+Fatface">

    
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/apple-touch-icon-144-precomposed.png">
    <link rel="shortcut icon" href="/favicon.ico">

    
    <link href="" rel="alternate" type="application/rss+xml" title="Mudox" />

    
    <link rel="stylesheet" href="/highlight_js/styles/pojoaque.css">
    
    
    
    <script src="/highlight_js/highlight.pack.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>

    
    <script src="/jquery.min.js"></script>
    <script src="/jquery.tagcanvas.min.js"></script>
  </head>

<body class="theme-base-08">

    <div class="sidebar">

  
  <div id="particles-js">
    <script src="/particles.js"></script>
    <script>
      particlesJS('particles-js', {
        particles: {
          color: '#fff',
          shape: 'circle', 
          opacity: 0.3,
          size: 3,
          size_random: true,
          nb: 35,
          line_linked: {
            enable_auto: true,
            distance: 300,
            color: '#fff',
            opacity: 0.5,
            width: 1,
            condensed_mode: {
              enable: false,
              rotateX: 600,
              rotateY: 600
            }
          },
          anim: {
            enable: true,
            speed: 2
          }
        },
        interactivity: {
          enable: true,
          mouse: {
            distance: 250
          },
          detect_on: 'window', 
          mode: 'grab'
        },
         
        retina_detect: true
      });
    </script>
  </div>

  
  <div id="sidebar-front-content" class="container">
    <nav id=sidebar-menu-wall>
      
      <li class="top-menu-item">
        <a class="top-menu-item" href="http://mudox.github.io/note/">NOTES</a>
      </li>
      <li class="top-menu-item">
        <a class="top-menu-item" href="http://mudox.github.io/memo/">MEMOS</a>
      </li>
      <li class="top-menu-item">
        <a class="top-menu-item" href="http://mudox.github.io/project/">PROJECTS</a>
      </li>
      <li class="top-menu-item">
        <a class="top-menu-item" href="http://mudox.github.io/post/">POSTS</a>
      </li>
    </nav>

    <nav id="tagCloud">
      <canvas id="tagCloudCanvas" width="250" height="250" style="width: 100%;">
        
        <a href="/categories">categories</a>  
        <a href="/languages">languages</a> 
        <a href="/languages/bash">bash</a> 
        <a href="/languages/c">c</a> 
        <a href="/languages/css">css</a> 
        <a href="/languages/english">english</a> 
        <a href="/languages/go">go</a> 
        <a href="/languages/html">html</a> 
        <a href="/languages/javascript">javascript</a> 
        <a href="/languages/lua">lua</a> 
        <a href="/languages/objective-c">objective-c</a> 
        <a href="/languages/swift">swift</a> 
        <a href="/languages/vimscript">vimscript</a>  
        <a href="/platforms">platforms</a> 
        <a href="/platforms/arch-linux">arch-linux</a> 
        <a href="/platforms/ios">ios</a> 
        <a href="/platforms/linux">linux</a> 
        <a href="/platforms/macos">macos</a> 
        <a href="/platforms/web">web</a> 
        <a href="/platforms/windows">windows</a>  
        <a href="/series">series</a> 
        <a href="/series/error-collection">error-collection</a> 
        <a href="/series/setup">setup</a>  
        <a href="/tags">tags</a> 
        <a href="/tags/awesome-wm">awesome-wm</a> 
        <a href="/tags/bash">bash</a> 
        <a href="/tags/cocoa">cocoa</a> 
        <a href="/tags/concurrency">concurrency</a> 
        <a href="/tags/dev-tool">dev-tool</a> 
        <a href="/tags/git">git</a> 
        <a href="/tags/libraries">libraries</a> 
        <a href="/tags/me">me</a> 
        <a href="/tags/setup">setup</a> 
        <a href="/tags/shell">shell</a> 
        <a href="/tags/system">system</a> 
        <a href="/tags/vim">vim</a> 
        <a href="/tags/zsh">zsh</a>  
      </canvas>
    </nav>
    <script>
      if (!$('#tagCloudCanvas').tagcanvas({
          initial: [0.203, -0.088],
          fadeIn: 1983,
          dragControl: true,
          dragThreshold: 4,
          decel: 0.985,
          clickToFront: 600,
          textColour: '#ffffff',
          outlineThickness: 0.5,
          maxSpeed: 0.018,
          minSpeed: 0.002,
          outlineMethod:'size',
          outlineIncrease: 4,
          depth: 0.55
        })) {
        $('#tagCloud').hide();
      }
    </script>


    <div class="container sidebar-sticky">
      <div class="sidebar-about">
        <a href="/" id="Mudox">Mudox</a>
        <p class="lead">
          My personal site powered by <a href="http://gohugo.io">Hugo</a> with a customized theme -- <a href="https://github.com/spf13/hyde.git">hyde</a>.
        </p>
      </div>

      <p>&copy; 2014. All rights reserved. </p>
    </div>
  </div>

</div>


    <div class="content container">
        <div class="post">
            
            <h1>SETUP MY ARCH LINUX ENVIRONMENT</h1>
            <span class="post-date">Sat, Nov 8, 2014</span>

            
            <div id="toc">
                <nav id="TableOfContents">
<ul>
<li><a href="#toc_0">Mouse acceleration</a></li>
<li><a href="#toc_1">Input Method</a></li>
<li><a href="#toc_2">Window Manager</a></li>
<li><a href="#toc_3">Shell Environment</a>
<ul>
<li><a href="#toc_4">Pull down dot-files repo</a></li>
<li><a href="#toc_5">Setup xterm</a></li>
<li><a href="#toc_6">Setup zsh</a></li>
</ul></li>
<li><a href="#toc_7">Setup Virtualbox</a>
<ul>
<li><a href="#toc_8">Installing virutalbox</a></li>
<li><a href="#toc_9">Confiuring virtualbox</a></li>
</ul></li>
<li><a href="#toc_10">VPN</a>
<ul>
<li><a href="#toc_11">Setup pptpclient</a></li>
<li><a href="#toc_12">Route all traffic through VPN connection</a>
<ul>
<li><a href="#toc_13">Manually</a></li>
<li><a href="#toc_14">Automatically</a></li>
</ul></li>
<li><a href="#toc_15">Modify DNS server list</a>
<ul>
<li><a href="#toc_16"><del>Automate the DNS modification process by /etc/ppp/ip-[up/down].d/*.sh</del></a>
<ul>
<li><a href="#toc_17">My hacky way</a></li>
</ul></li>
</ul></li>
</ul></li>
</ul>
</nav>
            </div>

            
            

<p>The marason of installing &amp; tunning the Arch Linux to my flavor.</p>

<h1 id="toc_0">Mouse acceleration</h1>

<p>Type <code>xset q | grep Pointer</code> to see current mouse acceleration setting.</p>

<p>Try <code>xset m &lt;acceleration&gt; &lt;threshold&gt;</code> with different values to find the best
combination for your feeling.</p>

<blockquote>
<p>where acceleration defines how many times faster the cursor will move than
the default speed. threshold is the velocity required for acceleration to
become effective, usually measured in device units per 10ms. acceleration can
be a fraction, so if you want to slow down the mouse you can use <sup>1</sup>&frasl;<sub>2</sub>, <sup>1</sup>&frasl;<sub>3</sub>,
<sup>1</sup>&frasl;<sub>4</sub>, &hellip; if you want to make it faster you can use <sup>2</sup>&frasl;<sub>1</sub>, <sup>3</sup>&frasl;<sub>1</sub>, <sup>4</sup>&frasl;<sub>1</sub>, &hellip;</p>

<p>Threshold defines the point at which acceleration should occur in pixels per
10 ms.</p>
</blockquote>

<p>I found my lucky combiantion is <code>1/4 8</code> and I add the setting command into
<em>rc.lua</em> of <a href="http://awesome.naquadah.org">Awesome WM</a> to apply the setting on each startup.</p>

<p>reference:</p>

<ul>
<li><a href="https://wiki.archlinux.org/index.php/Mouse_acceleration">Mouse acceleration from ArchWiki</a></li>
</ul>

<h1 id="toc_1">Input Method</h1>

<p>The <strong>ibus + isbus-rime</strong> combinations works nicely on my Arch Linux.</p>

<p>After ibus gets installed, run <code>ibus-setup</code>, it will show a setting guide
window where you can adjust ibus settings to adapt to <a href="awesome">Awesome WM</a>
environment.</p>

<ul>
<li><p>I prefer to change the keyboard shortcut of switching to next input method to
<code>&lt;Atl&gt;&lt;Shift&gt;space</code></p></li>

<li><p>Check off the <em>Embed preedit text in application window</em> option, because I
found it does not run properly in some applications (e.g. Vim).</p></li>
</ul>

<p>On  environments, ibus-daemon can not be loaded automatically on
startup, so we need to manually run it. There are many ways to auto-start
applications on linux platform, I choose to let <a href="awesome">Awesome WM</a> to start it by adding
auto-start code in <em>rc.lua</em>.</p>

<p>For ibus-rime, it is in tranditional chinese mode by default. To switch to
simplified chinese mode, press <code>Ctrl-~</code> when ibus-rime is active to open setup
candiate menu and choose <em>朙月拼音-简化字</em></p>

<pre><code class="language-bash">sudo pacman -S ibus ibus-qt ibus-rime

ibus-setup

# manually staRt ibus daemon for this session.
# this command has been added in my Awesome config file 'rc.lua' to auto-start
# it in the beginning of each Awesome session.
ibus-daemon -drx
</code></pre>

<p>reference:</p>

<ul>
<li><a href="https://wiki.archlinux.org/index.php/Ibus">IBus from ArchWiki</a></li>
</ul>

<h1 id="toc_2">Window Manager</h1>

<p>On Linux platforms, I prefer WMs to DEs.</p>

<p>The <a href="http://awesome.naquadah.org">Awesome WM</a> is my favorite window manager.</p>

<p>see <a href="/memo/setup_my_aweseome_wm_environment/">SETUP MY AWESOME WM ENVIRONMENT</a>
for details.</p>

<h1 id="toc_3">Shell Environment</h1>

<p>I have used several terminal emulators (gnome-terminal, xvrt &hellip;), and finally
I settled myself on <strong>xterm</strong>, which I feel it:</p>

<ul>
<li><p>consume the smallest resource among other terminal emulators.</p></li>

<li><p>starts up very fast.</p></li>

<li><p>is much more robust.</p></li>

<li><p>is the standard shell for the X Window System, which bring a great
compatiblity.</p></li>
</ul>

<p>As to shells, I become a <strong>zsh</strong> fan soon after played with it as well as
bash &amp; fish shells. the reason is obvious:</p>

<ul>
<li><p>it is powerfull than bash, whose syntax is completely covered by zsh.</p></li>

<li><p>it provides more flexibility in configuration than fish shell.</p></li>

<li><p>there already exist quite a many user contributed resources on the net, e.g:</p>

<ul>
<li><p><a href="https://github.com/robbyrussell/oh-my-zsh">on-my-zsh</a>.</p></li>

<li><p><a href="https://github.com/zsh-users/antigen">antigen</a> plugin manager.</p></li>
</ul></li>
</ul>

<h2 id="toc_4">Pull down dot-files repo</h2>

<p>My configuration resource related to termianl emulator &amp; shells are managed in
a github repo &ndash; <a href="https://github.com/Mudox/dot-files.git">dot-files</a>.</p>

<pre><code class="language-bash">cd ~/Git # ~/Git is the place I assemble most of my github repos.
git clone https://github.com/Mudox/dot-files.git
</code></pre>

<h2 id="toc_5">Setup xterm</h2>

<p>First, install xterm from Arch Linux&rsquo;s official repository.</p>

<p>Then, link out the .Xresources file from my <a href="https://github.com/Mudox/dot-files.git">dot-files</a> repo. It is
the configuration file that hold my xterm settings (colors, cursors, fonts
etc.) among other x utility setttings.</p>

<pre><code class="language-bash">sudo pacman -S xterm
cd ~
ln -sf Git/dot-files/Xresources .Xresources
</code></pre>

<h2 id="toc_6">Setup zsh</h2>

<p>see <a href="/memo/setup_my_zsh_environment/">SETUP MY ZSH ENVIRONMENTS</a> for details.</p>

<h1 id="toc_7">Setup Virtualbox</h1>

<h2 id="toc_8">Installing virutalbox</h2>

<p>First, from the official repository, install <em>vitualbox</em> package, which comes
with <em>virtualbox-host-modules</em>.</p>

<p>Then we need to add the basic <strong>vboxdrv</strong> kernel module to host kernel.</p>

<p>Finally, add my user name to the <strong>vboxusers</strong> group in order to use USB port in
virtual machines.</p>

<pre><code class="language-bash">sudo pacman -S virtualbox

# manually add vboxdrv to host kernel for one time.
sudo modeprobe vboxdrv

# auto-load vboxdrv on every system startup.
sudo echo 'vboxdrv' &gt; /etc/modules-load.d/virtualbox.conf

# add user name in vboxusers group to use USB ports in vitual machines.
sudo gpasswd -a &quot;${USER}&quot; vboxusers
</code></pre>

<h2 id="toc_9">Confiuring virtualbox</h2>

<ol>
<li><p>Set <em>Host Key Combination</em> to <code>right &lt;winkey&gt;</code> which is consistent with
<a href="awesome">Awesome WM</a>&rsquo;s keyboads shortcuts, it&rsquo;s in
<em>File-&gt;Preference-&gt;Input-&gt;Virtual Machine</em> of <em>Oracle VM VitualBox Manager</em>
window.</p></li>

<li><p>Enalbe <em>Bidiretional clipboard</em>, it&rsquo;s in <em>Devices-&gt;Shared
Clipboard-&gt;Bidirectional</em> of virtual machine window.</p></li>
</ol>

<p>reference:</p>

<ul>
<li><p><a href="https://wiki.archlinux.org/index.php/Virtualbox">Virtualbox from ArchWiki</a></p></li>

<li><p><a href="https://wiki.archlinux.org/index.php/Kernel_modules">kernel_modules from ArchWiki</a></p></li>
</ul>

<h1 id="toc_10">VPN</h1>

<h2 id="toc_11">Setup pptpclient</h2>

<ol>
<li><p>install pptpclient from the official repository of Arch Linux.</p></li>

<li><p>use <code>pptpsetup</code> command to register my VPN account, you need to collect the
following information in advance.</p>

<ul>
<li><p>VPN server&rsquo;s <em>ip address</em> from your VPN provider.</p></li>

<li><p><em>user name</em> of your VPN account.</p></li>

<li><p><em>user password</em> of your VPN account.</p></li>
</ul></li>

<li><p>install <code>ppp-mppe</code> (i.e. Microsoft Pointer-to-Pointer Encryption), if the
<code>pptpsetup</code> command complains about <em>MPPE</em> module things.</p></li>

<li><p>test configuration</p>

<ul>
<li><p>use <code>pon &lt;tunnel_name&gt; debug dump logfd 2 nodetach</code> to test the
configuration. If everything has been configured correctly, the command
should not terminate. <code>Ctrl-C</code> to quit it.</p></li>

<li><p>type <code>ip addr show</code>, and you will see a new device <strong>ppp0</strong> is listed in.</p></li>
</ul></li>

<li><p>connect VPN using <code>sudo pon &lt;tunnel_name&gt;</code>, <code>sudo poff &lt;tunnel_name&gt;</code> to
tear down.</p></li>
</ol>

<pre><code class="language-bash"># install pptpclient
sudo pacman -S pptpclient

# add you VPN account (i.e. create a new tunnel)
sudo pptpsetup \
  --create &lt;tunnel_name_whatever_you_like&gt; \
  --server &lt;your_VPN_server_ip_address&gt; \
  --username &lt;username_of_you_VPN_account&gt; \
  --password &lt;password_of_you_VPN_account&gt; \
  --encrypt

# install ppp-mppe, if the command above complains about lacking of `MPPE`
# module things. reun `pptpsetup` command above after installing it.
sudo pacman -S ppp-mppe

# test 1, the command should not terminate if everything is okay.
sudo pon &lt;tunnel_name_above&gt; debug dump logfd 2 nodetach

# test 2, you would see `ppp0` listed in the output.
ip addr show

# finally, connect!
sudo pon &lt;tunnel_name&gt;
</code></pre>

<h2 id="toc_12">Route all traffic through VPN connection</h2>

<h3 id="toc_13">Manually</h3>

<p>Use the powerfull <code>ip</code> command to add a route rule into route table.</p>

<pre><code class="language-bash"># make all packages go through interface ppp0
ip route add default dev ppp0
</code></pre>

<p>This route rule is only effective during this ppp session. after your tear down
the VPN connection by <code>sudo pon &lt;tunnel_name&gt;</code>, it will vanish.</p>

<h3 id="toc_14">Automatically</h3>

<p>Every executable scripts under /etc/ppp/ip-up.d/ will be called when a VPN
connection startup. Hence, we can use it to automatically set route rules.</p>

<pre><code class="language-bash"># /etc/ppp/ip-up.d/01-routes.sh
# ----------------------------------------
#!/bin/bash

# This script is called with the following arguments:
# Arg Name
# $1 Interface name
# $2 The tty
# $3 The link speed
# $4 Local IP number
# $5 Peer IP number
# $6 Optional ``ipparam'' value foo

ip route add default via $4
</code></pre>

<pre><code class="language-bash">cd /etc/ppp/ip-up.d
echo 'ip route add default via $4' &gt; 01-routes.sh

# the script file need to have `x` permission to be run.
# it's stdin &amp; stderr will be redirected off terminal, so not output will
# be shown when run.
sudo chmod +x /etc/ppp/ip-up.d/01-routes.sh
</code></pre>

<h2 id="toc_15">Modify DNS server list</h2>

<p>If you found you still can not access some site (e.g. youtube, twitter, etc.)
after establishing the VPN connection, then you should insert <code>servername
8.8.8.8</code> ahead of existing lines in <em>/etc/resolve.conf</em>.</p>

<pre><code class="language-bash"># /etc/resolve.conf
# ----------------------------------------
nameserver 8.8.8.8
nameserver 192.168.0.1
</code></pre>

<h3 id="toc_16"><del>Automate the DNS modification process by /etc/ppp/ip-[up/down].d/*.sh</del></h3>

<p><strong>NOTE: for unknown reason, I failed following this way to achieve the
automation, the <code>/etc/ppp/ip-up.d/00-dns.sh</code> did run, but it just did not move
files. But it is the mechanism provided by <code>ppp</code> thus IMO it is the standard
way that you should try first</strong></p>

<p>Whenever you tear down a VPN connection and get back to the local connection,
using the local DNS server may provide better connection speed. So, there comes
the need to restore <code>/etc/resolv.conf</code></p>

<p>By using <em>/etc/ppp/ip-up.d/00-dns.sh</em> and <em>/etc/ppp/ip-down.d/00-dns.sh</em>, which
automatically substitutes <em>/etc/ppp/resolv.conf</em> with <em>/etc/resolv.conf</em></p>

<ol>
<li><p>put your VPN specific resolv.conf under <em>/etc/ppp/</em></p></li>

<li><p>add <code>export USEPEERSDNS=1</code> into <em>~/.profile</em></p></li>
</ol>

<h4 id="toc_17">My hacky way</h4>

<p>I wrote a script to get around of this:</p>

<pre><code class="language-bash"># ~/.bin/vpn.sh
# ----------------------------------------
#!/bin/sh

tunnel=&quot;your configured tunnel name&quot;

if [ &quot;$#&quot; -ne 1 ]; then
  echo &quot;usage: $0 [on|off]&quot;
  exit 1
fi

case &quot;$1&quot; in
  on )
    # connect
    pon ${tunnel} || exit 1

    # here we just overwrite the /etc/resolv.conf by `echo`ing the hard
    # written DNS list to it.
    printf &quot;nameserver 8.8.8.8\nnameserver 192.168.0.1&quot; &gt; /etc/resolv.conf || exit 1
    ;;
  off )
    # disconnect
    poff ${tunnel}

    # some as above, we just `echo` back.
    echo 'nameserver 192.168.0.1' &gt; /etc/resolv.conf || exit 1
    ;;
  * )
    echo &quot;usage: $0 [on|off]&quot;
    ;;
esac

unset tunnel
</code></pre>

<p>in your .bashrc or .zshrc file:</p>

<pre><code class="language-bash">alias vpon='sudo ~/.bin/vpn.sh on'
alias vpoff='sudo ~/.bin/vpn.sh off'
</code></pre>

<p>then, you can type <code>vpon</code> to turn on the VPN, and <code>vpoff</code> to shutdown.</p>

<p>reference:</p>

<ul>
<li><a href="https://wiki.archlinux.org/index.php/PPTP_VPN_client_setup_with_pptpclient">PPTP VPN client setup with pptpclient</a></li>
</ul>

        </div>
    </div>

</body>
</html>
