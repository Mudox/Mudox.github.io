<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
  <head>

    <link href="http://gmpg.org/xfn/11" rel="profile">
    <meta charset="utf-8">

    
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

    <title> Mudox &middot; Mudox </title>

    
    <link rel="stylesheet" href="/lib/normalize/normalize.css">
    <link rel="stylesheet" href="/lib/mudox_hyde.css">

    
    
    <link rel="stylesheet" href="/lib/fonts/fonts.css">

    
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/lib/apple-touch-icon-144-precomposed.png">
    <link rel="shortcut icon" href="/lib/favicon.ico">

    
    <link href="http://mudox.github.io/index.xml/" rel="alternate" type="application/rss+xml" title="Mudox" />

    
    <script src="/lib/jquery/jquery.min.js"></script>

    
    
    
    <link rel="stylesheet" href="/lib/highlight/styles/tomorrow.css">
    <script src="/lib/highlight/highlight.pack.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>

    
    <script src="/lib/tagcanvas/jquery.tagcanvas.min.js"></script>

    
    <script src="/lib/particles/particles.js"></script>

    
    
    

    
    <link rel="stylesheet" href="/lib/animate/animate.min.css">

  </head>

<body class="theme-base-red">

  <div class="sidebar">

  
  <div id="particles-js"> </div>

  
  <div id="sidebar-front-content" class="container">

    <nav id=sidebar-menu>
      
      <li class="top-menu-item">
        <a href="http://mudox.github.io/note/">NOTES</a>
      </li>
      <li class="top-menu-item">
        <a href="http://mudox.github.io/memo/">MEMOS</a>
      </li>
      <li class="top-menu-item">
        <a href="http://mudox.github.io/project/">PROJECTS</a>
      </li>
      <li class="top-menu-item">
        <a href="http://mudox.github.io/post/">POSTS</a>
      </li>
    </nav>

    <nav id="cloud-container">
      <canvas id="cloud-canvas" width="300" height="300" style="width: 100%;">
        
        <a href="/languages">languages</a> 
        <a href="/languages/bash">bash</a> 
        <a href="/languages/c">c</a> 
        <a href="/languages/chinese">chinese</a> 
        <a href="/languages/css">css</a> 
        <a href="/languages/english">english</a> 
        <a href="/languages/go">go</a> 
        <a href="/languages/html">html</a> 
        <a href="/languages/javascript">javascript</a> 
        <a href="/languages/lua">lua</a> 
        <a href="/languages/objc">objc</a> 
        <a href="/languages/oc">oc</a> 
        <a href="/languages/swift">swift</a> 
        <a href="/languages/viml">viml</a>  
        <a href="/platforms">platforms</a> 
        <a href="/platforms/arch">arch</a> 
        <a href="/platforms/ios">ios</a> 
        <a href="/platforms/linux">linux</a> 
        <a href="/platforms/macos">macos</a> 
        <a href="/platforms/web">web</a> 
        <a href="/platforms/win">win</a>  
        <a href="/series">series</a> 
        <a href="/series/error">error</a> 
        <a href="/series/setup">setup</a>  
        <a href="/tags">tags</a> 
        <a href="/tags/appdev">appdev</a> 
        <a href="/tags/awesome">awesome</a> 
        <a href="/tags/bash">bash</a> 
        <a href="/tags/cocoa">cocoa</a> 
        <a href="/tags/concurrency">concurrency</a> 
        <a href="/tags/dev">dev</a> 
        <a href="/tags/git">git</a> 
        <a href="/tags/libraries">libraries</a> 
        <a href="/tags/me">me</a> 
        <a href="/tags/networking">networking</a> 
        <a href="/tags/setup">setup</a> 
        <a href="/tags/shell">shell</a> 
        <a href="/tags/system">system</a> 
        <a href="/tags/tool">tool</a> 
        <a href="/tags/translation">translation</a> 
        <a href="/tags/unicode">unicode</a> 
        <a href="/tags/vim">vim</a> 
        <a href="/tags/vocabulary">vocabulary</a> 
        <a href="/tags/xcode">xcode</a> 
        <a href="/tags/zsh">zsh</a>  
      </canvas>
    </nav>

    <div class="sidebar-about sidebar-sticky">
      <div id="logo"><a href="/" id="Mudox" class="animated bounceInLeft">Mudox</a>
      </div>
      <p class="lead">
        My site powered by <a href="http://gohugo.io">Hugo</a> with a theme customized from <a href="https://github.com/spf13/hyde.git">hyde</a>.
      </p>
      <p>&copy; 2015. All rights reserved. </p>
    </div>

  </div>

</div>


  <div class="content container">
    <div class="posts">

      
      <div class="post">
        <h1 class="post-title">
          <a href="http://mudox.github.io/post/translation_swift_building_assert_in_swift_part2/">
            Swift 官博文章翻译 - 在 Swift 中构建 assert(), 第一部分：__FILE__ 和 __LINE__
          </a>
        </h1>

        <span class="post-date">Sat, May 9, 2015</span>

        

<p>原文链接：<a href="https://developer.apple.com/swift/blog/?id=15">Building <code>assert()</code> in Swift, Part 2: __FILE__ and __LINE__ </a></p>

<p>译者：Mudox</p>

<p>大家都知道 C 语言里有两个宏 <code>__LINE__</code>，<code>__FILE__</code> 在某些场合下很有用。在编译器开始编译之前，预编译器都会将他们展开为当前的文件名和行号。尽管 Swift 没有预编译器，但是它也提供了这两个名字，并具有相同的作用，只是其运行机制截然不同。</p>

<h1 id="toc_0">内建的标识符</h1>

<p>正如<a href="http://developer.apple.com/library/prerelease/ios/documentation/swift/conceptual/swift_programming_language/LexicalStructure.html">《Swift 语言编程指南》</a>说所，Swift 有一些内建的标识符，其中就包括 <code>__FLIE__</code>，<code>__LINE__</code>，<code>__COLUMN__</code> 和 <code>__FUNCTION__</code>。您可以在代码中的任何地方使用他们，Swift 编译器会将他们转变成表示当前代码位置的字符串或者和整形常量。当您想要手动记录事件时，比如在退出前打印出当前代码的位置，他们会非常有用。</p>

<pre><code class="language-swift">func assert(predicate : @autoclosure () -&gt; Bool) {
  #if DEBUG
    if !predicate() {
      println(&quot;assertion failed at \(__FILE__):\(__LINE__)&quot;)
      abort()
    }
  #endif
}
</code></pre>

<p>上面的代码只会打印出 <code>assert()</code> 函数体内部的位置，而不是我们想要的调用它的代码的位置。</p>

<h1 id="toc_1">获取调用者的位置</h1>

<p>Swift 从 D 语言那里借鉴来一个非常聪明的做法：讲这些特殊的位置标识符作为参数的默认值。于是我们将 <code>asssert()</code> 函数定义为：</p>

<pre><code class="language-swift">func assert(
  condition: @autoclosure () -&gt; Bool,
  _ message: String = &quot;&quot;,
       file: String = __FILE__,
       line: Int = __LINE__)
{
    #if DEBUG
      if !condition() {
        println(&quot;assertion failed at \(file):\(line): \(message)&quot;)
        abort()
      }
    #endif
}
</code></pre>

<p>函数 <code>assert()</code> 的第二个参数是一个可选的字符串，第三和第四个参数默认为调用代码行的位置。这样 <code>assert()</code> 将默认得到调用它的代码行的位置。当然您也可以在 <code>assert()</code> 基础上再包裹一层抽象，并将您认为合适的位置信息传主动递进 <code>assert()</code> 里面。比如如下的简单示例：</p>

<pre><code class="language-swift">func logAndAssert(
  condition: @autoclosure () -&gt; Bool,
  _ message: StaticString = &quot;&quot;,
       file: StaticString = __FILE__,
       line: UWord = __LINE__)
{

  logMessage(message)
  assert(condition, message, file: file, line: line)
}
</code></pre>

<p>上面的代码中，函数 <code>logAndAssert()</code> 的调用位置被正确传递给 <code>assert()</code>。值得一提的是，我们给第二个参数使用了 <code>StaticString</code> 类型，他是一个和 <code>String</code> 类似的字符串类型，用来存储像 <code>__FILE__</code> 这样展开得到的字符串，使用它没有内存管理方面的开销。</p>

<p>除了被用于 <code>assert()</code> 函数的实现外，这些功能还被用于 Swift 版的 XCTest 框架的实现中。当然，他们也可以被用于您的代码库的实现里。</p>

      </div>
      
      <div class="post">
        <h1 class="post-title">
          <a href="http://mudox.github.io/post/translation_swift_value_and_reference_types/">
            Swift 官博文章翻译 - 值类型与引用类型
          </a>
        </h1>

        <span class="post-date">Sat, May 9, 2015</span>

        

<p>原文链接：<a href="https://developer.apple.com/swift/blog/?id=10">Value and Reference Types</a></p>

<p>译者：Mudox</p>

<p>Swift 的所有类型都归于两大类：</p>

<ul>
<li><p><strong>值类型</strong>，每个实例都保存着属于自己的那一份独一无二的数据，结构体 <code>struct</code>，枚举 <code>enum</code> 和元祖 <code>tuple</code> 都属于此类。</p></li>

<li><p><strong>引用类型</strong>，实例之间经常共用一份数据，类 <code>class</code> 就是此类型。</p></li>
</ul>

<p>本文我们将探讨下他们各自的优点，以及如何在他们之间做选择。</p>

<h1 id="toc_0">可变性在安全性上扮演的角色</h1>

<p>每次我们选择使用值类型而非引用类型时一个最主要的原因就是能够让代码更加清晰明了，这样我们就更容易掌控代码。如果您得到总是一份独一无二的数据拷贝，您就能确信在您的代码的其他地方不会私下改动您当前的数据。这在多线程环境中是非常有用的，因为线程经常可能在您不经意间改变了您的数据，而这种错误一旦产生又非常难排查。</p>

<p>由于两种类型之间的差异主要发生在修改数据时，因此当您的实例不可修改时，两者表现就完全一样了。</p>

<p>您可能在想某些情况下让类类型不可修改也是很有必要的呀。这样我们既能使用 Cocoa 的 <code>NSObject</code> 对象，又能享受到值语义的好处。今天，通过只定义只读的存储属性，以及避免暴露那些会更改状态的 API 接口，您也能用 Swift 创建出不可修改的类来。事实上，很多常用的 Cocoa 类，比如 <code>NSURL</code>，都被设计为不可修改的类。但是 Swift 并没有像对结构体，枚举那样，在语言层面上提供确保类不变性的机制（比如施加在子类上面）。</p>

<h1 id="toc_1">如何选择?</h1>

<p>那么当您要构建一个新的类型时，您如果决定使用那种类型的语义呢？当您要使用 Cocoa 时，许多 API 都要用到 <code>NSObject</code> 的子类，因此您必须使用类类型。对于其他的情况，这里有一些指导建议：</p>

<p>使用值类型的情况：</p>

<ul>
<li><p>有必要用 <code>==</code> 来比较数据时</p></li>

<li><p>您需要拷贝数据以获得独立的状态时</p></li>

<li><p>数据将被用于多个线程中</p></li>
</ul>

<p>使用引用类型的情况：</p>

<ul>
<li><p>需要用 <code>===</code> 来比较实例的唯一性时</p></li>

<li><p>您需要创建共享的，可修改的状态时</p></li>
</ul>

<p>在 Swift 中，数组 <code>Array</code>，字典 <code>Dictionary</code>，字符串 <code>String</code> 都是值类型。他们用起来就像 C 语言中简单的 <code>int</code> 值一样，就像每个实例都是一份独一无二的拷贝。您无需刻意去拷贝他们以防止数据被其他代码暗地里修改掉。更重要的是，在多线程之间您可以安全的传递这些值类型而无需同步措施。基于安全第一的原则，Swift 提供的这种模型能帮助您写出更加可预测的代码。</p>

      </div>
      
      <div class="post">
        <h1 class="post-title">
          <a href="http://mudox.github.io/post/translation_swift_building_assert_in_swift_part1/">
            Swift 官博文章翻译 - 在 Swift 中构建 assert()，第一部分：延迟计算
          </a>
        </h1>

        <span class="post-date">Sat, May 9, 2015</span>

        

<p>原文链接：<a href="https://developer.apple.com/swift/blog/?id=4">Building assert() in Swift, Part 1: Lazy Evaluation </a></p>

<p>译者：Mudox</p>

<p>我们在设计 Swift 语言时做出了一个关键的决断就是抛弃 C 语言的预编译器的概念，这样做不仅彻底消除了使用它可能带来的很多 bug，还让代码明了易懂。这对程序员来说是一个巨大的利好，但是它也意味着 Swift 必须用新的技术来实现一些旧的特性。大部分这样的特性的实现都很明了（模块导入，条件化编译），其中大家可能最感兴趣的就是 Swift 是如果支持类似 <code>assert</code>() 这样的宏定义的。</p>

<p>当我们在 C 语言下编译可执行文件的 release 版本时，<code>assert()</code> 宏并不对运行时性能有任何影响，因为它并不处理任何参数。它在 C 语言下的可能是这样实现的：</p>

<pre><code class="language-c">#ifdef NDEBUG
#define assert(e)  ((void)0)
#else
#define assert(e)  \
  ((void) ((e) ? ((void)0) : __assert (#e, __FILE__, __LINE__)))
#define __assert(e, file, line) \
  ((void)printf (&quot;%s:%u: failed assertion `%s'\n&quot;, file, line, e), abort())
#endif
</code></pre>

<p>Swift 版的 <code>assert()</code> 提供和 C 版本同样的功能，没有用到预编译，而且我们以一种更加干净的方式实现了它。</p>

<h1 id="toc_0">实参的延迟计算</h1>

<p>我们在实现 <code>assert()</code> 时，首先碰到的挑战就是，在 Swift 中没有明显的方法让一个函数接受一个表达式，而不立马求它的值。比方说，我们尝试用了：</p>

<pre><code class="language-swift">func assert(x : Bool) {
  #if !NDEBUG

    /*noop*/
  #endif
}
</code></pre>

<p>即使断言被禁用了，应用程序也得承担对实参表达求值的运行时开销：</p>

<pre><code class="language-swift">assert(someExpensiveComputation() != 42)
</code></pre>

<p>我们或许可以通过让断言改而接受一个闭包来补救它：</p>

<pre><code class="language-swift">func assert(predicate : () -&gt; Bool) {
  #if !NDEBUG
    if !predicate() {
      abort()
    }
  #endif
}
</code></pre>

<p>被裹进闭包的表达式只有在断言被启用的情况下才会被求值：</p>

<pre><code class="language-swift">assert({ someExpensiveComputation() != 42 })
</code></pre>

<p>但是这样的话，我们又不得不使用这种奇怪的调用语法：</p>

<pre><code class="language-swift">assert({ someExpensiveComputation() != 42 })
</code></pre>

<p>我们可以使用 Swift 提供的属性 <code>@autoclosure</code> 来补救这一点。自动闭包（auto-closure）属性可以修饰函数的参数，它只是编译器自动将被修饰的实参裹进一个闭包里，就好像如下的代码：</p>

<pre><code class="language-swift">func assert(predicate : @autoclosure () -&gt; Bool) {
  #if !NDEBUG
    if !predicate() {
      abort()
    }
  #endif
}
</code></pre>

<p>它允许您这样调用断言：</p>

<pre><code class="language-swift">assert(someExpensiveComputation() != 42)
</code></pre>

<p>自动闭包是一个强大的特性，它能让您有条件的计算一个表达式，甚至计算多次，就像使用闭包那样。自动闭包也被用在 Swift 的其他很多地方。比如实现短路估值（short-circuiting）的逻辑运算符，如下：</p>

<pre><code class="language-swift">func &amp;&amp;(lhs: BooleanType, rhs: @autoclosure () -&gt; BooleanType) -&gt; Bool {
  return lhs.boolValue ? rhs().boolValue : false
}
</code></pre>

<p>Swift 将表达式的右操作数声明为自动闭包以让它的估值得以延迟。</p>

<h1 id="toc_1">自动闭包</h1>

<p>自动闭包和 C 语言宏一样强大，所以我们必须谨慎使用它。因为使用闭包时，调用方很容易意识不到他传入的实参的求值时机被改变了。我们还限制自动闭包不接受任何参数。您不应该拿他们当某种控制流来使用。只有当用它可以实现用户预期的语义效果时，我们才使用它，而不是用它来仅仅为了消除闭包的语法的花括号。</p>

<p>本文探讨 Swift 实现 <code>assert()</code> 所使用到其中一个技术。我们还将在后续文章讨论其他的方面。</p>

      </div>
      
      <div class="post">
        <h1 class="post-title">
          <a href="http://mudox.github.io/post/translation_swift_optionals_case_study_valuesforkeys/">
            Swift 官博文章翻译 - 可为空类型案例分析：valueForKeys
          </a>
        </h1>

        <span class="post-date">Fri, May 8, 2015</span>

        

<p>原文链接：<a href="https://developer.apple.com/swift/blog/?id=12">Optionals Case Study: valuesFoyKeys</a></p>

<p>译者：Mudox</p>

<p>本文我们将探索下可为空类型（optionals）是如果帮助 Swift 保持类型安全的。我将创建一个 Ojbective-C API 的 Swift 版本。尽管在 Swift 我们并不需要用到它，但是它确实一个有趣的例子。</p>

<p>在 Objective-C 中，<code>NSDictionary</code> 类有一个方法 <code>objectsForKeys:notFoundMarker</code>，它接受一个 <code>NSArray</code> 参数，您把要查询的键值对的键放进去，它会就把对应的值存放进另一个 <code>NSArray</code> 中返回。文档上说，返回的数组中的值和您存入到数组中的键是一一对应的。但是如果其中一个键在字典里没有对应的值呢？所以我们还需要传入另一个参数 <code>notFoundMarker</code>。对于那些在字典中没有对应值的键，<code>objectsForKeys:notFoundMarker</code> 会在返回的数组中用 <code>notFoundMarker</code> 的值来填补空位。Foundation 框架甚至为我们预定义好了一个专门表示空值的类： <code>NSNull</code>。</p>

<p>在 Swift 中 <code>Dictionary</code> 类型并没有提供与 <code>objectsForKeys</code> 对应的方法。下面我们将要通过延展来给 <code>Dictionary</code> 类型添加这个方法。</p>

<pre><code class="language-swift">extension Dictionary {
  func valuesForKeys(keys: [K], notFoundMarker: V) -&gt; [V] {
    // To be implemented
  }
}
</code></pre>

<p>Swif 与 Objective-C 不同，它有很严格的类型检查。因此上面的方法返回的数组只能存放一种类型，所以不能用放入 <code>NSNull</code> 来表示空值。但是 Swift 提供了更好的解决方法：我们可以返回一组可为空值，所有的值被包裹进可为空值里。这样我们就能直接用 <code>nil</code> 来表示空值了。</p>

<pre><code class="language-swift">extension Dictionary {
  func valuesForKeys(keys: [Key]) -&gt; [Value?] {
    var result = [Value?]()
    result.reserveCapacity(keys.count)
    for key in keys {
      result.append(self[key])
    }
    return result
  }
}
</code></pre>

<p>你们可能已经想到为什么 Swift 的 <code>Dictionary</code> 不提供 <code>objectsForKeys</code> 方法了，因为我们可以用如下简短的代码，达到同样的效果：</p>

<pre><code class="language-swift">extension Dictionary {
  func valuesForKeys(keys: [Key]) -&gt; [Value?] {
    return keys.map { self[$0] }
  }
}
</code></pre>

<p>这就是为什么 Swift 类型总是比他们的 Objective-C 里的对应的类型提供的 API 要少很多的原因：通过 <code>map</code> 方法，我们可以轻松完成各种旧 API 的工作，而且有更多可能性。</p>

<p>现在我们来试用一下上面定义的 <code>objectsForKeys</code> 方法：</p>

<pre><code class="language-swift">let dict = [&quot;A&quot;: &quot;Amir&quot;, &quot;B&quot;: &quot;Bertha&quot;, &quot;C&quot;: &quot;Ching&quot;]

dict.valuesForKeys([&quot;A&quot;, &quot;C&quot;])
// [Optional(&quot;Amir&quot;), Optional(&quot;Ching&quot;)]

dict.valuesForKeys([&quot;B&quot;, &quot;D&quot;])
// [Optional(&quot;Bertha&quot;), nil]

dict.valuesForKeys([])
// []
</code></pre>

<h1 id="toc_0">可为空值嵌套</h1>

<p>现在我们修改一下上面的代码，在每行后面加个 <code>.last</code>， 去结果集的最后一个元素：</p>

<pre><code class="language-swift">dict.valuesForKeys([&quot;A&quot;, &quot;C&quot;]).last
// Optional(Optional(&quot;Ching&quot;))

dict.valuesForKeys([&quot;B&quot;, &quot;D&quot;]).last
// Optional(nil)

dict.valuesForKeys([]).last
// nil
</code></pre>

<p>奇怪了，第一行代码返回了两个嵌套的可为空值。第二为 <code>Optional(nil)</code>。这是怎么回事呢？</p>

<p>还记得 <code>.last</code> 的定义么：</p>

<pre><code class="language-swift">var last: T? { get }
</code></pre>

<p><code>last</code> 是一个计算属性，其类型是可为空的元素类型。由于上面的 <code>objectsForKeys</code> 放回的数组的元素本身也是可为空类型，所以我们得到就是嵌套的可为空类型了。</p>

<p>那么 <code>Optional(nil)</code> 又是什么意思呢：</p>

<p>我们知道 Objective-C 中我们需要用 <code>NSNull</code> 来作为空值占位符。上面代码的 Objective-C 版本应该是：</p>

<pre><code class="language-objc">[dict valuesForKeys:@[@&quot;A&quot;, @&quot;C&quot;] notFoundMarker:[NSNull null]].lastObject
// @&quot;Ching&quot;

[dict valuesForKeys:@[@&quot;B&quot;, @&quot;D&quot;] notFoundMarker:[NSNull null]].lastObject
// NSNull

[dict valuesForKeys:@[] notFoundMarker:[NSNull null]].lastObject
// nil
</code></pre>

<p>不管是在 Swift 中还是 Objective-C 中，返回 <code>nil</code> 都表示中间结果集为空，因为空集没有最后元素。当 Swift 的版本返回 <code>Optional(nil)</code> （或者 Objective-C 版本返回 <code>NSNull</code> ）时，这表示中间结果集里是有元素的，只是这个元素表示空值。Objective-C 必须预定义一个类型 <code>NSNull</code> 来表示空值，而 Swift 的类型系统直接就能表示它。</p>

<h1 id="toc_1">提供默认值</h1>

<p>如果您依然想用其他的值来替代字典中缺失的值呢？很容易：</p>

<pre><code class="language-swift">extension Dictionary {
  func valuesForKeys(keys: [Key], notFoundMarker: Value) -&gt; [Value] {
    return self.valuesForKeys(keys).map { $0 ?? notFoundMarker }
  }
}
</code></pre>

<p>Swift 的类型系统提供了丰富语法支持来处理一可为空类型返回的结果，而不用像 Objective-C 那样要定义一个类型来作为占位符。</p>

      </div>
      
      <div class="post">
        <h1 class="post-title">
          <a href="http://mudox.github.io/post/translation_swift_redefining_everything_with_the_swift/">
            Swift 官博文章翻译 - Swift REPL 的重定义特性
          </a>
        </h1>

        <span class="post-date">Wed, May 6, 2015</span>

        

<p>原文链接：<a href="https://developer.apple.com/swift/blog/?id=20">Redefining Everything with Swift REPL</a></p>

<p>译者：Mudox</p>

<p>我们的之前的<a href="/post/translation_swift_introduction_to_the_swift_repl/">第一篇关于 Swift REPL 的文章</a>只是简单的介绍了如何利用 REPL 来帮助您学习 Swift 语言的。本文将详细介绍 REPL 是如果绕过一些常规的语言编写规则来协助您开发 Swift 应用的。</p>

<h1 id="toc_0">重定义标识符</h1>

<p>Swift 编译器能自动检测出大量的代码错误，其中就包括重复定义标识符。</p>

<pre><code class="language-bash">swiftc -
var x = &quot;The Answer&quot;
var x = 42
^D
error: invalid redeclaration of 'x'
</code></pre>

<p>在一般的代码编写场景中，这是合情合理的。但是在 REPL 交互式环境中，应该让用户更加容易的修改之前的代码。我们在设计 Swift REPL 时考虑到了这一点：</p>

<pre><code class="language-swfit">  1&gt; var x = &quot;The Answer&quot;
x: String = &quot;The Answer&quot;
  2&gt; var x = 42
x: Int = 42
  3&gt; x + 10
$R0: Int = 52
</code></pre>

<p>同一个标识符较近的定义会覆盖所有之前的定义。如上所示，您甚至可以在在下一次重复定义时改变变量的类型。重复定义方便您反复的修改优化您的代码。比如您要设计一个递归的函数：</p>

<pre><code class="language-swfit">  4&gt; func fib(index: Int) -&gt; Int {
  5.   if index &lt;= 1 {
  6.     return 1
  7.   }
  8.   return fib(index - 1) + fib(index - 2)
  9. }
 10&gt; fib(40)
$R1: Int = 165580141
</code></pre>

<p>这是只是这个函数的其中一种实现。在 REPL 中您可以尽情的试验用其他的算法或者 API 来实现您的函数：</p>

<pre><code class="language-swift"> 11&gt; func fib(index: Int) -&gt; Int {
 12.   var lastValue = 1
 13.   var currentValue = 1
 14.   for var iteration = 2; iteration &lt;= index; ++iteration {
 15.     let newValue = lastValue + currentValue
 16.     lastValue = currentValue
 17.     currentValue = newValue
 18.   }
 19.   return currentValue
 20. }
 21&gt; fib(40)
$R2: Int = 165580141
</code></pre>

<p>直接把上面的重复的函数定义敲入 REPL 中，<code>fib</code> 函数的定义就会被 REPL 更新。这是只是一个很简单的例子，但是它展示了 REPL 是如果方便您反复试验并改进代码的。</p>

<h1 id="toc_1">重定义还是重载？</h1>

<p>我们可以在 Swift REPL 中轻松重定义常量，变量，类型还有函数，一切都很直观，方便。但是问题来了，REPL 怎么区分并让函数重定义和函数重载共存能呢？Swift REPL 只会覆盖函数名和函数签名完全都相同的函数定义。如果只是函数名相同而签名不同，那么只会引入一个函数重载。请记住，在 Swift 中就算两个函数的签名只有返回类型不同，也算是函数重载。比如：</p>

<pre><code class="language-swift"> 22&gt; func foo() {
 23.    println(&quot;Foo!&quot;)
 24. }
 25&gt; func foo() -&gt; String {
 26.    return &quot;Foo!&quot;
 27. }
 28&gt; foo()
error: ambiguous use of 'foo'
</code></pre>

<p>上面的两个函数只有返回类型不同，所以您在调用他们时必须提供足够的上下文让编译器能够推导出被调用的函数具体的返回类型（从而判断出您要调用的到底是哪个函数）：</p>

<pre><code class="language-swift"> 28&gt; var foo: String = foo()
foo: String = &quot;Foo!&quot;
 29&gt; foo() as Void
Foo!
</code></pre>

<h1 id="toc_2">捕捉定义</h1>

<p>尽管 REPL 允许重复定义，但是它只对后续出现的标识符有效。而之前已经被 REPL 编译过的那些代码行中的标识符引用的都还是之前的定义。这就好像新的定义只是替后面的代码遮住了旧的定义，而不是彻底的擦除了他们。下面的例子展示这个机制具体是如果运作的：</p>

<pre><code class="language-swfit"> 30&gt; var message = &quot;Hello, World!&quot;
message: String = &quot;Hello, World!&quot;
 31&gt; func printMessage() {
 32.    println(message)
 33. }
 34&gt; printMessage()
Hello, World!
 35&gt; message = &quot;Goodbye&quot;
 36&gt; printMessage()
Goodbye
 37&gt; var message = &quot;New Message&quot;
 38&gt; printMessage()
Goodbye
 39&gt; println(message)
New Message
</code></pre>

<p>让我们一行一行的看看到底发生了什么，第 30 行我们定义了一个名为 <code>message</code> 的变量，里面保存的是程序员御用问候语。第 31 ~ 33 定义了一个函数 <code>printMessage()</code> ，它打印出第 30 行定义的变量 <code>message</code> 保存的问候语。我们在第 34 行调用了 <code>printMessage()</code> ，问候语被打印出来。到目前为止，一切都很正常。</p>

<p>接着我们在第 35 行对之前在第 30 行定义的 <code>message</code>  变量赋予新值。在第 36 行我们再次调用 <code>printMessage()</code> ，和我们预期的一样，打印出来的是新赋予的字符串。然后我们在第 37 行重新定义了变量 <code>message</code>，这样就遮住了之前的定义，让后面的代码只能看到 <code>message</code> 的新的定义。但是我们在 38 调用的是 <code>printMessage()</code> 函数, 它恰恰是在重定义 <code>message</code> 之前定义的，因此它保留的是 <code>message</code> 之前的定义，打印还是之前的字符串。 而在第 39 行，我们敲入的是新代码，它引用的自然就是重定义之后的 <code>message</code>。</p>

<p>无论是函数，变量还是类型，他们在 REPL 中的重定义机制都是如此。尽管 REPL 能让您轻松的重定义标识符，但是重定义之前的被编译了的引用不会再改变。如果上面的 <code>message</code> 被重定义为一个类型而非变量会发生什么情况呢？<code>printMessage</code> 将不会再编译（这和我的实验不符，message 函数依然能被调用，打印的是之前的值）。与其每每碰到边界情况时没完没了的询问用户该怎么做，Swift REPL 努力坚持一个自我一致的世界观。</p>

      </div>
      
      <div class="post">
        <h1 class="post-title">
          <a href="http://mudox.github.io/post/translation_swift_what_happened_to_nsmethodsiganiture/">
            Swift 官博文章翻译 - NSMethodSiganiture 发生了什么？
          </a>
        </h1>

        <span class="post-date">Wed, May 6, 2015</span>

        <p>原文链接：<a href="https://developer.apple.com/swift/blog/?id=19">What Happened to NSMethodSiganiture?</a></p>

<p>译者：Mudox</p>

<p>将 Cocoa 框架引入 Swift 语言带给我们一个独一无二的机会，让我们能从一个全新的角度重新审视之前的 APIs 的合理性。我们发现，多数是由于 Swift 对安全性的要求，Cocoa 框架中的一些 API 不能很好的适应 Swift。那些与动态方法调用有关的的类无法导入到 Swift 中，比如 <code>NSInvocation</code>，<code>NSMethodSiganiture</code>。</p>

<p>我们最近收到了一个开发人员的 bug 报告，他试图把他的的代码移植到 Swift，打算使用 <code>NSMethodSiganiture</code> 来检视方法实参的类型，结果发现 <code>NSMethodSiganiture</code> 并没有导入到 Swift 中。他要移植的代码需要接受不同签名的 HTTP 处理函数，比如：</p>

<pre><code class="language-swift">func handleRequest(request: HTTPRequest, queryStringArguments: [String: String]) { }
func handleRequest(request: HTTPRequest, jsonBody: JSON) { }
</code></pre>

<p>在 Objective-C 中，可以用 <code>NSMethodSiganiture</code> 判断出第一个方法需要 <code>[String: String]</code> 作为实参，而第二个方法则需要 <code>JSON</code> 值。而 Swift 的功能十分强大，无需 <code>NSMethodSiganiture</code>，也不会违反编译器提供类型和内存安全性规则就能轻松处理好此类情况。下面的代码用 Swift 的方式来解决上面的问题：</p>

<pre><code class="language-swift">struct HTTPRequest {
  // ...
}

protocol HTTPHandlerType {
  typealias Data

  /// :returns: true if the request was handled; false otherwise
  func handle(request: HTTPRequest, data: Data) -&gt; Bool
}
</code></pre>

<p>我们首先声明一个协议定义处理 HTTP 请求需要满足的接口。这个协议非常简单，只有一个方法。</p>

<p>为什么不子类型化 <code>HTTPHandler</code> 呢，因为使用协议能提供更大灵活性，由用户来决定用什么来实现。如果我们定义的时一个 <code>HTTPHandler</code> 类，那么就会要求用户只能使用类类型，强迫他们使用引用类型。反之使用协议的换，用户可以自用的决定用什么来实现协议，用类，结构体甚至是枚举类型都可以。</p>

<pre><code class="language-swift">class HTTPServer {
  func addHandler&lt;T: HTTPHandlerType&gt;(handler: T) {
    handlers.append { (request: HTTPRequest, args: Any) -&gt; Bool in
      if let typedArgs = args as? T.Data {
        return handler.handle(request, data: typedArgs)
      }
      return false
    }
  }

  // ...
}
</code></pre>

<p>然后我们定义一个 <code>HTTPServer</code> 类，给它添加一个泛型方法，接受一个遵守 <code>HTTPHandlerType</code> 协议的类型参数。有了这个关联的类型参数，我们就可以通过对传入的请求数据执行条件化的向下转化来判断某个处理函数是否能处理此类数据。这就是定义协议的好处，<code>HTTPServer</code> 不需要知道处理器如何处理数据，甚至不需要知道它的具体类型。它只需确认这个对象有处理请求的能力（接口）就好了。</p>

<pre><code class="language-swift">class HTTPServer {
  // ...

  private var handlers: [(HTTPRequest, Any) -&gt; Bool] = []

  func dispatch(req: HTTPRequest, args: Any) -&gt; Bool {
    for handler in handlers {
      if handler(req, args) {
        return true
      }
    }
    return false
  }
}
</code></pre>

<p>当我们的 <code>HTTPServer</code> 需要处理请求是，它只需便利我们的请求处理对象，看哪个能处理传入的请求和数据。</p>

<p>现在我们就可以轻松的创建处理各式各样类型数据的请求处理对象，并把他们注册到 <code>HTTPServer</code> 上。</p>

<pre><code class="language-swift">class MyHandler : HTTPHandlerType {
  func handle(request: HTTPRequest, data: Int) -&gt; Bool {
    return data &gt; 5
  }
}

let server = HTTPServer()
server.addHandler(MyHandler())
server.dispatch(HTTPRequest(...), args: &quot;x&quot;) // returns false
server.dispatch(HTTPRequest(...), args: 5)   // returns false
server.dispatch(HTTPRequest(...), args: 10)  // returns true
</code></pre>

<p>通过配合使用协议和泛型，我们可以用 Swift 优雅的定义处理各式各样数据类型的 HTTP 请求对象。同时也不会破坏编译器已有的安全性规则，并获得出色的运行时表现。</p>

<p>您可以下载本文完整的示例代码，我们把它放在了一个 <a href="https://developer.apple.com/swift/blog/downloads/Request.zip">Swift Playground</a> 中。</p>

      </div>
      
      <div class="post">
        <h1 class="post-title">
          <a href="http://mudox.github.io/note/ios_notes_oss_networking_frameworks/">
            iOS NOTES - NETWORKING OPEN SOURCE FRAMEWORKS
          </a>
        </h1>

        <span class="post-date">Tue, May 5, 2015</span>

        

<p>Here records the simple usage that I learned from the 3 well-known open source
networking frameworks:</p>

<ol>
<li><p><a href="http://allseeing-i.com/ASIHTTPRequest/">ASIHTTPRequest</a> written in Objective-C language</p></li>

<li><p><a href="https://github.com/AFNetworking/AFNetworking">AFNetworking</a>  written in Objective-C language</p></li>

<li><p><a href="https://github.com/Alamofire/Alamofire">Alamofire</a> written in Swift Language</p></li>
</ol>

<p>All example below are run asynchronously.</p>

<h1 id="toc_0">Use Case #1 - Simple GET Request</h1>

<h2 id="toc_1">1.1 With ASIHTTPRequest</h2>

<p>ASIHTTPRequest provides 3 ways to handle responses:</p>

<ol>
<li><p>completion handler selector</p></li>

<li><p>completion handler block</p></li>

<li><p>delegate</p></li>
</ol>

<h3 id="toc_2">Using delegation</h3>

<p>Create &amp; configure request object and emit request.</p>

<ol>
<li><p>Define a long-standing reference somewhere, e.g. as a property of you view
controller class.</p></li>

<li><p>Initialize the <code>ASIHTTPRequest</code> instance with target URL string (make sure
it properly encoded).</p></li>

<li><p>set progress feedback settings if you want them.</p></li>

<li><p>set delegate and emit the request.</p></li>
</ol>

<pre><code class="language-objc">- (IBAction)grabSomethingInBackground: (id)sender {
// step #1
//   use Url string to initialize a instance of ASIHTTPRequest instance

  NSString *strURL = @&quot;....&quot;
  // better call this method to ensure string is properly encoded.
  strURL = [strURL stringByAddingPercentEscapesUsingEncodingSUTF8StringEncoding];
  // request instance should stand as long as possible to cover the whole fetching process
  ASIHTTPRequest *request = [ASIHTTPRequest requestWithURLtrURL];

// step #2 (optional)
//   get download progress feedback

  request.downloadProgressDelegate = self;
  request.showAccurateProgress = YES;
  [ASIHTTPRequest setShouldUpdateNetworkActivityIndicator: YES];

// step #3
// set delegate &amp; emit request ansynchronously

  request.delegate = self;
  [request startAsynchronous];
}
</code></pre>

<p>Implement delegate methods to handle results (succeed or fail).</p>

<ol>
<li><p>implement <code>requestFinished:</code> delegate methods to fetch response content.</p></li>

<li><p>implement <code>requestFailed:</code> delegate methods to handle failure.</p></li>

<li><p>implement <code>setProgress:</code> delegate methods to report the download progress.</p></li>
</ol>

<pre><code class="language-objc">#pragma mark - ASIHTTPRequestDelegate
// request succeeded
- (void)requestFinished: (ASIHTTPRequest *)request
{
  // fetch response content as NSData
  NSData *data = [request responseData];

  // fetch response content as NSString
  NSString *str = [request responseString];
}

// reqeust failed
- (void)requestFailed: (ASIHTTPRequest *)request
{
  NSLog(@&quot;ERROR: %@&quot;, [request.error localizedDescription]);
}

#pragma mark - ASIProgressDelegate
- (void)setProgress: (float)newProgress
{
  // average download speed in bytes/second
  unsigned long byte = [ASIHTTPRequest averageBandwidthUsedPerSecond];

  // current completion percent (between 0.0 ~ 1.0) from argument:
  newProgress;
}

@end

</code></pre>

<p>Another alternative is to set selectors for success &amp; fail handling respectively.</p>

<pre><code class="language-objc">  [request setDidFinishSelector:@selector(requestDone:)];
  [request setDidFailSelector:@selector(requestWentWrong:)];
</code></pre>

<p>If you set completion selectors like above, your delegate&rsquo;s completion methods
will be ignored.</p>

<h3 id="toc_3">Using blocks</h3>

<pre><code class="language-objc">- (IBAction)grabSomethingInBackground: (id)sender
{
// step #1
//   create request instance
  NSString *strURL = @&quot;....&quot;
  strURL = [strURL stringByAddingPercentEscapesUsingEncodingSUTF8StringEncoding];

  // use keyword __block to make 'request' variable capturable and modifiable by blocks following
  __block ASIHTTPRequest *request = [ASIHTTPRequest requestWithURL:url];

// setp #2 -
//   set blocks instead of delegate to handle results

  [request setCompletionBlock:^{
     // fetching text data thought captured 'request' object
     NSString *responseString = [request responseString];

     // fetching binary data thought captured 'request' object
     NSData *responseData = [request responseData];
  }];

  [request setFailedBlock:^{
     NSError *error = [request error];
  }];

  [request startAsynchronous];
}
</code></pre>

<h2 id="toc_4">1.2 With AFNetworking</h2>

<ol>
<li><p>Gain the singleton manager.</p></li>

<li><p>invode GET method &amp; set everything in just one call.</p></li>
</ol>

<pre><code class="language-objc">AFHTTPRequestOperationManager *manager = [AFHTTPRequestOperationManager manager];
[manager GET:@&quot;http://example.com/resources.json&quot;
  parameters:nil
     success:^(AFHTTPRequestOperation *operation, id responseObject) {
                NSLog(@&quot;JSON: %@&quot;, responseObject);
             }
     failure:^(AFHTTPRequestOperation *operation, NSError *error) {
                NSLog(@&quot;Error: %@&quot;, error);
             }
];
</code></pre>

<h2 id="toc_5">1.3 With Alamofire</h2>

<p>Just one call.</p>

<pre><code class="language-swift">Alamofire.request(.GET, &quot;http://httpbin.org/get&quot;, parameters: [&quot;foo&quot;: &quot;bar&quot;])
         .response { (request, response, data, error) in
                     println(request)
                     println(response)
                     println(error)
                   }
</code></pre>

<h1 id="toc_6">Use Case #2 - Simple POST Request</h1>

<h2 id="toc_7">With ASIHTTPRequest</h2>

<p>Same as the &lsquo;Simle GET Request&rsquo; above, excepts:</p>

<ul>
<li><p>You should initialize a instance of ASIFormDataRequest instead of
ASIHTTPRequest.</p></li>

<li><p>You set <code>setRequestMethod:</code> with <code>POST</code> parameter to switch to POST request
type.</p></li>

<li><p>You should call <code>addRequestHeader:</code> methods to add at least <code>Content-Type</code>
field.</p></li>

<li><p>You should put the query string in URL string into the HTTP request body by
calling <code>setPostBody</code> method, either in URL query string form or JSON form.</p></li>
</ul>

<pre><code class="language-objc">// step #1
// use Url string to initialize a instance of ASIFormDataRequest

  NSString *strURL = @&quot;...&quot;;
  // better call this method to ensure string is properly encoded.
  NSURL *strURL = strURL stringByAddingPercentEscapesUsingEncoding: SUTF8StringEncoding];

// step #2
// set request methods to 'POST'

  [self.formRequest setRequestMethod: &quot;POST&quot;];

// step #3
// add http request header &amp; body respectively

  self.formRequest = [ASIFormDataRequest requestWithURL: strURL];
  [self.formRequest addRequestHeader: &quot;Content-Type&quot; value: &quot;application/x-www-form-urlencoded&quot;];

  // body string in URL query string format
  NSMutableData *body = [NSMutableData dataWithData:
    [@&quot;type=focus-c&quot; dataUsingEncoding: SUTF8StringEncoding]];

  // body string in JSON format
  // NSMutableData *body = [NSMutableData dataWithData:
    [@&quot;p={\&quot;a\&quot;: ,\&quot;b\&quot;: }&quot; dataUsingEncoding: NSUTF8StringEncoding]];

  [self.formRequest setPostBody: NSMutableData*)[body dataUsingEncoding: NSUTF8StringEncoding]];

  // ASIFormDataRequese provides a group of methods to help you // quickly
  // construct the post body.
  //
  // setPostFilePath:
  // ----
  // setPostValue: forKey:
  // addPostValue: forKey:
  // ----
  // setFile: forKey:
  // setFile: withFileName: andContentType: forKey:
  // ----
  // setData: forKey:
  // setData: withFileName: andContentType: forKey:
  // ----
  // setPostBody:
  // setPostBodyFilePath:
  // ----
  // appendPostData:
  // appendPostDataFromFile:

// step #4
// set delegate &amp; emit request ansynchronously

  [self.formRequest setDelegate: self];
  [self.formRequest startAsynchronous];
</code></pre>

<h1 id="toc_8">Framework Office Documentation</h1>

<ol>
<li><p><a href="http://allseeing-i.com/ASIHTTPRequest/How-to-use">ASIHTTPRequest</a></p></li>

<li><p><a href="http://cocoadocs.org/docsets/AFNetworking/2.5.3/">AFNetworking</a></p></li>

<li><p><a href="https://github.com/Alamofire/Alamofire">Alamofire</a></p></li>
</ol>

      </div>
      
      <div class="post">
        <h1 class="post-title">
          <a href="http://mudox.github.io/post/translation_swift_failable_initializer/">
            Swift 官博文章翻译 - 可能失败的初始化器
          </a>
        </h1>

        <span class="post-date">Tue, May 5, 2015</span>

        <p>原文链接：<a href="https://developer.apple.com/swift/blog/?id=22">Failable Initializers</a></p>

<p>译者：Mudox</p>

<p>Xcode 6.1 带来了 Swift 1.1，后者引入了一个新的特性：可能失败的初始化器。初始化是给类或者结构体的存储属性一个初始值，并建立起实例的不变性的过程。在某些情况下，初始化可能会失败。</p>

<p>比如，初始化过程需要访问某个资源（例如从文件中加载图片）：</p>

<pre><code class="language-swift">NSImage(contentsOfFile: &quot;swift.png&quot;)
</code></pre>

<p>如果这个文件不存在或者处于某种原因不能访问，那么上面的 <code>NSImage</code> 的初始化就会失败。有了 Swift 1.1 我们可以用可能失败的初始化器（failable initializer）来报告失败的初始化操作。通过可能失败的初始化器构建对象，返回的结果被包裹在可为空类型里，如果成功就返回包含初始化了的对象的可为空值，如果失败就返回 <code>nil</code>。因此上面的初始化需要对返回的可为空值做拆箱操作：</p>

<pre><code class="language-swift">if let image = NSImage(contentsOfFile: &quot;swift.png&quot;) {
  // loaded the image successfully
} else {
  // could not load the image
}
</code></pre>

<p>我们可以在 Swift 的初始化器声明后加上 <code>!</code> 或者 <code>?</code> 后缀来表示该初始化过程会返回可为空值，且具体是那种可为空类型。比我们可以对 <code>Int</code> 类型增加一个可能失败的初始化器以尝试将从一个字符串中初始化出一个整形值来：</p>

<pre><code class="language-swift">extension Int {
  init?(fromString: String) {
    if let i = fromString.toInt() {
      // Initialize
      self = i
    } else {
      // return nil, discarding self is implied
      return nil
    }
  }
}
</code></pre>

<p>在可能失败的初始化器中返回 <code>nil</code> 指示这个初始化过程失败了，因为没有其他的值可以返回。在上面的字符串初始化整型值的例子中，如果字符串不成功的被解析为一个整形数字，那么就只能返回 nil 了。如果成功，就将 <code>self</code> 赋值为解析出来的整型值。</p>

<p>可能失败的初始化器大大降低了使用工厂方法（factory methods）的必要性，在此之前我们只能用工厂方法来报告失败的对象初始化。比如那些关联了原始类型的枚举类型，他们之前都是通过一个 <code>fromRaw</code> 工厂类方法来返回可为空的枚举值，以报告可能失败的初始化。现在 Swift 编译器会对那些尝试从一个原始类型值映射到一个枚举值的情况自动合成一个可能失败的初始化器。</p>

<pre><code class="language-swift">enum Color : Int {
  case Red = 0, Green = 1, Blue = 2

  // implicitly synthesized
  var rawValue: Int { /* returns raw value for current case */ }

  // implicitly synthesized
  init?(rawValue: Int) {
    switch rawValue {
      case 0: self = .Red
      case 1: self = .Green
      case 2: self = .Blue
      default: return nil
    }
  }
}
</code></pre>

<p>通过使用可能失败的初始化器，Swift 使其构造语法更加的统一，同时也消除了 Objective-C 中工厂方法和构造函数相互重复带来的困扰，从而大大的简化了新语言。有了可能失败的初始化器，Swift 现在把更多的带 <code>NSError *</code> 参数的 Cocoa 工厂方法视为初始化器处理，从而提供给用户更加统一，简洁的对象构造体验。</p>

<p>您可以在这里了解到更详细的关于可能失败的初始化器的内容：<a href="https://developer.apple.com/library/mac/documentation/Swift/Conceptual/Swift_Programming_Language/Initialization.html#//apple_ref/doc/uid/TP40014097-CH18-XID_339">Swift 编程语言</a></p>

      </div>
      
      <div class="post">
        <h1 class="post-title">
          <a href="http://mudox.github.io/post/translation_swift_introduction_to_the_swift_repl/">
            Swift 官博文章翻译 - Swift REPL 交互式解释环境介绍
          </a>
        </h1>

        <span class="post-date">Mon, May 4, 2015</span>

        

<p>原文链接：<a href="https://developer.apple.com/swift/blog/?id=18">Introduction to the Swift REPL</a></p>

<p>译者：Mudox</p>

<p>Xcode 6.1 引入了一种新的方式来体验 Swift 语言，那就是通过交互式的读取解释打印循环（Read Eval Print Loop —— REPL）。如果您之前在其他语言里用到过他，您将很快适应 Swift 的 REPL，就算是经验丰富人士在使用过程中也能发现 Swift REPL 的独到之处。</p>

<p>要开始使用它，请在您的 Mac OS X Yosemite 上启动 Terminal.app（在 /Applications/Utilities 里），然后打 “swift” 命令。如果您的系统是 OS X Mavericks 就打 “xcrun swift” 命令。这样您就进入了 Swift REPL 环境了：</p>

<pre><code class="language-swift">// Welcome to Swift version 1.1 (swift-600.0.20.0). Type :help for assistance.
  1&gt; ▌
</code></pre>

<p>您只需要像往常那样键入 Swift 的语句，REPL 就会马上执行您的代码。执行的结果会被自动格式化，并加上他们的类型注释（就像 Swift 的变量或者常量声明语法那样）打印在您刚刚键入的代码下：</p>

<pre><code class="language-swift">  1&gt; &quot;100&quot;.toInt()
$R0: Int? = 100
  2&gt; let name = &quot;Katherine&quot;
name: String = &quot;Katherine&quot;
  3&gt; println(&quot;Hello, \(name)&quot;)
Hello, Katherine
</code></pre>

<p>Swift REPL 会将每次的计算结果存放在一个特定命名的变量里（即使您的代码并没有把计算结果赋值给具体的变量）。这样您就可以在后续的代码中引用之前的计算结果了：</p>

<pre><code class="language-swfit"> 4&gt; $R0! + 200      // 这里用 $R0 来引用上面第一行代码的计算结果
$R1: Int = 300
</code></pre>

<p>Swift 编译器能判断出您键入的语句是否完整，并在必要时自动提示您继续输入代码以完成语句。它甚至能像 Xcode 那样自动缩进您的代码。比如当您键入如下函数声明代码时：</p>

<pre><code class="language-swift">5&gt; func timesTwo() {
6.     ▌
</code></pre>

<p>这里第 6 行为续行提示符（数字后跟一个点），这样您一眼就能明白 REPL 需要您继续键入剩余的代码。此时您可以继续键入余下的代码：</p>

<pre><code class="language-swift">5&gt; func timesTwo() {
6.      return value * 2
7. }▌
</code></pre>

<p>这里有三点值得说明下：</p>

<ul>
<li><p>首先 REPL 在第 6 行自动缩进了代码，当我们在第 7 行键入 <code>}</code> 后，REPL 又帮您自动缩进回来。</p></li>

<li><p>其次，我们在函数体内引用了一个我们忘了声明的变量名 <code>value</code>，并且函数也忘了声明返回类型，您需要把这两个都加上。</p></li>

<li><p>最后，就算您忘了添加变量声明和返回类型声明而按下了回车键，这也不会太晚，REPL 还能给您挽救的机会。</p></li>
</ul>

<h1 id="toc_0">多行历史记录</h1>

<p>您的代码被提交给编译器的同时，也会被 REPL 环境记录下来。这使得您能更加轻松的修改之前的代码。接着上面的代码，如果您按下回车键就会得到如下的提示：</p>

<pre><code class="language-bash">error: use of unresolved identifier 'value'
</code></pre>

<p>和其他环境下的历史记录功能使用方法一样，您可以按下 <code>↓</code> 键来调出之前出入过的代码行。REPL 一次性把我们上面输入的三行代码全部调了出来，并将光标放在的最后一行的末尾。按照下节的指引您就能更正之前的错误了。</p>

<p>每次会话保存的历史记录是能够保留到下次会话的，总共能保存上几百段代码。您可以从代码的首行按向上键（或者 Ctrl+P）调出更早输入的代码，也可以从最后一行代码下面的空行上按 <code>↓</code> 键调出稍近的代码。我们将在下面解释为什么最后一行往下还会出现一行空行。</p>

<h1 id="toc_1">多行编辑</h1>

<p>尽管 Swift REPL 环境表现得像传统的命令行编辑器，它还是提供了多行编辑的能力，这样像输入类定义，函数定义这样经常需要多行一起输入的情况，编辑起来就变得简单了。在上面的函数定义的示例中，在您在最后一行尾按下回车键之前，您可以按下 <code>↑</code> 将光标移动到上面的行，并使用 <code>←</code> 键移动到参数列表的 <code>(</code> 后面来修改，添加参数：</p>

<pre><code class="language-swift">5&gt; func timesTwo(▌ {
6.     return value * 2
7. }
</code></pre>

<p>现在键入参数声明，然后按 <code>→</code> 键移动到 <code>(</code> 之后，然后加上返回类型声明：</p>

<pre><code class="language-swift">5&gt; func timesTwo(value: Int) -&gt; Int▌  {
6.              return value * 2
7. }
</code></pre>

<p>在代码中间按下回车键是不能结束代码输入，提交 REPL 的。在中间按回车键只能插入新的一行以便您想在函数或者方法体内加入新行。您这里想要的是移动光标到代码最末尾，您可以按 <code>↓</code> 键两次，或者使用 Emacs 的按键序列 <code>Esc &gt;</code> (<code>Esc</code> 键之后跟一个左尖括号)。在最末尾按下回车键就能将新修改的函数定义提交了：</p>

<pre><code class="language-swift">  8&gt;  timesTwo(21)
$R2: (Int) = 42
</code></pre>

<p>自动侦测语句完整性意味着大多数情况下您只管输入心中的代码，让 REPL 来干剩下的脏活。但是某些情况下，您需要一次提交多个语句，因为他们之间相互依赖。设想有下面的代码：</p>

<pre><code class="language-swift">func foo() {
  bar()
}
func bar() {
  foo()
}
</code></pre>

<p>如果您只是一行一行的输入上面的代码，当您输入完第三行代码之后就为把第一个函数提交给 REPL 执行，自然会得到如下的警告：</p>

<pre><code class="language-bash">error: use of unresolved identifier 'bar'
</code></pre>

<p>当然您可以一行定义两个函数，两个语句之间用分号隔开，但是还有一个更好的方法。在您输入完第三行之后按下 <code>↓</code> 键就会插入并移动到第四行，这是您再就可以继续输入第二个函数的声明了。这两个语句被一次性提交给编译器，达到相互递归的意图。</p>

<h1 id="toc_2">快速参考</h1>

<p>为了帮助你快速开始使用 Swift REPL 环境，面给了常用的编辑和导航快捷键：</p>

<table>
<thead>
<tr>
<th>按键组合</th>
<th>注释</th>
</tr>
</thead>

<tbody>
<tr>
<td>方向键</td>
<td>上下左右移动光标</td>
</tr>

<tr>
<td>Control + F</td>
<td>向右移动光标一个字符，和按下 <code>→</code> 键一样</td>
</tr>

<tr>
<td>Control + B</td>
<td>向左移动光标一个字符，和按下 <code>←</code> 键一样</td>
</tr>

<tr>
<td>Control + P</td>
<td>向上移动光标一个字符，和按下 <code>↑</code> 键一样</td>
</tr>

<tr>
<td>Control + N</td>
<td>向下移动光标一个字符，和按下 <code>↓</code> 键一样</td>
</tr>

<tr>
<td>Control + D</td>
<td>删除光标键下的字符</td>
</tr>

<tr>
<td>Option + Left</td>
<td>将光标移动到上一个单词的开始处</td>
</tr>

<tr>
<td>Option + Right</td>
<td>将光标移动到下一个单词的开始处</td>
</tr>

<tr>
<td>Control + A</td>
<td>将光标移动到本行首</td>
</tr>

<tr>
<td>Control + E</td>
<td>将光标移动到本行末</td>
</tr>

<tr>
<td>Delete</td>
<td>删除光标前面的一个字符（这里指主键盘区的回退键 Backspace）</td>
</tr>

<tr>
<td>Esc &lt;</td>
<td>将光标移动到第一行的行首</td>
</tr>

<tr>
<td>Esc &gt;</td>
<td>将光标移动到最后一行的行末</td>
</tr>
</tbody>
</table>

      </div>
      
      <div class="post">
        <h1 class="post-title">
          <a href="http://mudox.github.io/post/translation_swift_1_2_and_xcode_6_3_beta_features/">
            Swift 官博文章翻译 - Swift 1.2 和 Xcode 6.3 新特性介绍
          </a>
        </h1>

        <span class="post-date">Mon, May 4, 2015</span>

        

<p>原文链接：<a href="https://developer.apple.com/swift/blog/?id=22">Swift 1.2 and Xcode 6.3 beta</a></p>

<p>译者：Mudox</p>

<p>Xcode 6.3 beta 给我们带来了 Swift 1.2 beta 版。不仅 Swift
编译器性能得到显著提升，还带了很多新的 Swift 语言特性。
如需了解全部的变更，请参阅本次的版本说明。本文将着重介绍其中的若干亮点。</p>

<h1 id="toc_0">编译器改进</h1>

<p>Swift 1.2 的编译器变得更加稳定，并全面提升了编译器性能。同时它能带来了诸多特性能是您再 Xcode 中使用 Swift 时有更好的体验。其中一些明显的改进包括：</p>

<ul>
<li><p><strong>增量构建</strong></p>

<p>默认情况下编译器不会再重复编译没有改变过的源文件，这将使绝大多数情况下的编译时间大大缩短。当然，如果您对代码结构做了大规模的改动后，依然可能导致编译器编译多个文件。</p></li>

<li><p><strong>生成更加快速的代码</strong></p>

<p>Debug 和 Release 模式下生成的可执行文件的运行速度都大大提升了。</p></li>

<li><p><strong>更强大的编译诊断能力</strong></p>

<p>增强的 Fix-its 功能，能帮助您扫除各种错误和警告，从而写出正确的 Swift 1.2 代码。</p></li>

<li><p><strong>稳定性提升</strong></p>

<p>我们修复了大多数用户常见的 SourceKit 警告。您将不再被此类提示困扰。</p></li>
</ul>

<h1 id="toc_1">新的语言特性</h1>

<p>在 1.2 中我们进一步改善了 Swift 语言，使之更加安全，可预测。我们继续改进 Swift 和 Objective-C 之间的交互。其中一些显著的进步包括：</p>

<ul>
<li><p><strong>新的 <code>as!</code> 运算符来表示可能失败的类型转换</strong></p>

<p>那些在运行时不一定成功的类型转换必须明确的用 <code>as!</code> 来表示。从而使得代码的意图和后或对后续的阅读者和维护人员更加明了。</p></li>

<li><p><strong>可以在 Objective-C 头文件中添加可为空性注释</strong></p>

<p>Clang 中引入了一个新的 Objective-C 语言扩展，能再您的 Objective-C API 中明确标注出指针和块引用的可为空性。这样您就能写出与 Swift 交互的更好的 Objective-C 框架，同时使您在项目中混用 Objective-C 和 Swift 的代码时能获得更好的性能。</p></li>

<li><p><strong>Swift 枚举类型现在可以通过 <code>@objc</code> 修饰来导出到 Objective-C 中</strong></p>

<p>比如如下的 Swift 代码：</p>

<pre><code class="language-swift">@objc enum Bear: Int {
  case Black, Grizzly, Polar
}
</code></pre>

<p>导入到 Objective-C 中为：</p>

<pre><code class="language-objc">typedef NS_ENUM(NSInteger, Bear) {
  BearBlack, BearGrizzly, BearPolar
};
</code></pre></li>

<li><p><strong>更加强大，一致的 <code>let</code> 关键字</strong> i</p>

<p>新规则规定 <code>let</code> 常量必须在第一次使用前被初始化（和 <code>var</code> 变量类似），并且之后不能被重新赋值或者修改。</p>

<p>这将允许我们写出如下的代码：</p>

<pre><code class="language-swift">let x : SomeThing
if condition {
  x = foo()
} else {
  x = bar()
}
use(x)
</code></pre>

<p>在这之前为了达到这个效果，我们只能使用 <code>var</code> 来声明（尽管初始化后就再没有代码改动它）。同样的，常量属性也可以这样声明，然后再初始化器中初始化。</p></li>

<li><p><strong>更加的强大的可为空类型条件拆箱 <code>if let</code></strong></p>

<p><code>if let</code> 语句现在能一次拆箱多个可为空变量，还可以在其中插入布尔条件表达式。这可以让您无需嵌套也能表达复杂的条件拆箱控制逻辑。</p></li>

<li><p><strong>新的原生的集合 <code>Set</code> 数据类型</strong></p>

<p><code>Set</code> 是一个和 <code>NSSet</code> 完美桥接的数据类型，用来表示一组无序的，唯一的数据。和 <code>Array</code>，<code>Dictionary</code> 一样，它在 Swift 中是一个值而非引用。</p></li>
</ul>

<h1 id="toc_2">总结</h1>

<p>我们由衷的欢迎您提交任何 bug 报告，希望所有常见的问题都在这个 beta 版得到解决。Swift 1.2 对于语言本身和其工具来说都是一次巨大的改进。它也引入了一些不向后兼容的改动，需要您对之前的代码做出修改，因此 Xcode 6.3 包含了一个移植工具来帮助您自动化这个过程。要使用该工具，请选 <em>Edit</em> 菜单，然后选择 <em>Convert -&gt; To Latest Swift Syntax&hellip;</em> 选项。</p>

      </div>
      
      <div class="post">
        <h1 class="post-title">
          <a href="http://mudox.github.io/note/ios_notes_animations/">
            iOS NOTES - iOS ANIMATIONS
          </a>
        </h1>

        <span class="post-date">Sun, May 3, 2015</span>

        

<h1 id="toc_0">iOS Animation API Clusters From Top to Bottom</h1>

<p>In general there are 2 groups of APIs: the view based animation APIs &amp; the
underlying Core Animation APIs that is backing the former.</p>

<ol>
<li><p>UIView <code>begin...</code> &amp; <code>commit...</code> style APIs</p>

<p>They are the oldest APIs before block was introduced into the framework,
with <code>begin...</code> to start recording an animation, a bunch of
<code>setAnimation...</code> to be called subsequently to set configure various
animations detailes, and then ends with a <code>commit...</code> call.</p></li>

<li><p>UIView block based APIs</p>

<p>In iOS 4.0, block was introduced to facilitates the creation of UIView
animations (replacing the old <code>begin...</code> &amp; <code>commit</code> APIs).</p>

<p>Note that during the animation block, you can still call the
<code>setAnimation...</code> functions to tweak details of animation.</p>

<p>The full form of the function accepts 5 arguments:</p>

<ol>
<li><p>Duration</p></li>

<li><p>Delay</p></li>

<li><p>Animation options</p></li>

<li><p>The animation block</p></li>

<li><p>Completion block</p></li>
</ol>

<p>The block based animation is just like creating, configuring &amp; adding
<code>CABasicAnimation</code> to layers of each involved view in the block.</p></li>

<li><p>UIView spring Animation</p>

<p>As its name suggests, it can do some kind of <em>underdamped oscillation</em>. It
arguments list is similar to full form of block based function, with two
more paramters:</p>

<ol>
<li><p>Damping ratio</p></li>

<li><p>Initial velocity</p></li>
</ol></li>

<li><p>UIView view transition APIs</p>

<p>2 convenient methods were added to faciliate the common occasions when you
want to animation subview changes in one view a whole, or replacing one
view with another.</p></li>

<li><p>UIView key frame Based APIs</p>

<p>It only have 2 methods, call <code>animateKeyframes...</code> to start the whole
animation, and within a block, call <code>addKeyframe...</code> multiple times with
apprioate relative timming setting to layout the key frames duraing the
whole animation.</p>

<p>Using it is just like adding <code>CAKeyframeAnimation</code> to the layer of involved
views in the block.</p></li>

<li><p>Core Animation</p>

<p>Provided by the <em>Quartz Core</em> framework from <em>Media Layer</em>. It is the basis
of everything mentioned above.</p>

<p>It provides concepts of layer, animcation object, animation transaction,
etc. When you can not achieve effect you want through APIs listed above,
come for it.</p></li>
</ol>

      </div>
      
      <div class="post">
        <h1 class="post-title">
          <a href="http://mudox.github.io/post/translation_swift_the_as_bang_operator/">
            Swift 官博文章翻译 - as! 运算符
          </a>
        </h1>

        <span class="post-date">Sat, May 2, 2015</span>

        <p>原文链接：<a href="https://developer.apple.com/swift/blog/?id=23">The as! Operator</a></p>

<p>译者：Mudox</p>

<p>在 Swift 1.2 之前，<code>as</code> 运算符可以用来完成两种不同类型转换操作。取决要转换的表达式的类型，和要转化到的类型，<code>as</code> 运算符可以完成如下两种转化：</p>

<ul>
<li><p><strong>总是能成功的类型转化</strong>，编译器能在编译时判断出这类转换总是能成功。比如向上转换（upcasting —— 将一个对象引用转化为自己的一个父类或者祖先类类型) 或者在给字面值常亮添加类型注释（比如, <code>1 as Float</code>）。</p></li>

<li><p><strong>强制类型转化</strong>，此类转换 Swift 编译器不能确保其绝对成功，如果不成功就引发运行时异常。比如乡下转换（downcasting —— 将一个对象引用转化为其某个子孙类类型）。</p></li>
</ul>

<p>Swift 1.2 把这两中操作分割开来，变成了两个独立的运算符。总是能成功的转化还是使用 <code>as</code> 运算符，二强制转化则使用新的 <code>as!</code> 运算符（注意这里不是两个运算符叠加在一起，它就是<strong>一个</strong>运算符）。 <code>!</code> 暗示此类型转化可能会失败。这样，你一眼扫过代码就能知道那个类型转化会引发程序奔溃。</p>

<p>如下示例展示了这个新的语言变更：</p>

<pre><code class="language-swift">class Animal {}
class Dog: Animal {}

let a: Animal = Dog()
a as Dog                // now raises the error:  &quot;'Animal is not convertible to 'Dog';
                        // ... did you mean to use 'as!' to force downcast?&quot;

a as! Dog               // forced downcast is allowed

let d = Dog()
d as Animal             // upcast succeeds
</code></pre>

<p>注意区分作为表达式后缀运算符的 <code>!</code> 和 <code>?</code> 以及转换运算符 <code>as!</code>，<code>as?</code>：</p>

<p>译者注，用于类型注释时（type annotation）：</p>

<ul>
<li><p>后缀运算符 <code>!</code> 表示要强制拆箱可为空类型 (forced unwrapping)</p></li>

<li><p>后缀运算符 <code>?</code> 可为空类型的级联访问（optional chaining）</p></li>
</ul>

<p>在声明可为空类型时：</p>

<ul>
<li><p><code>!</code> 类型后缀声明一个隐式拆箱的可为空类型（implicitly unwrapped optional）</p></li>

<li><p><code>?</code> 类型后缀声明一个普通的可为空类型（optional）</p></li>
</ul>

<pre><code class="language-swift">class Animal {}

class Cat: Animal {}

class Dog: Animal {
  var name = &quot;Spot&quot;
}

let dog: Dog? = nil
dog?.name               // evaluates to nil
dog!.name               // triggers a runtime error

let animal: Animal = Cat()
animal as? Dog  // evaluates to nil
animal as! Dog  // triggers a runtime error
</code></pre>

<p>您可以简单记忆为：在 Swift 中 <code>!</code> 暗示 <strong>可能会失败</strong>，<code>?</code> 暗示 <strong>可能为空 nil</strong>。</p>

      </div>
      
      <div class="post">
        <h1 class="post-title">
          <a href="http://mudox.github.io/note/wwdc_my_summary/">
            MY WATCH GUIDE &amp; SUGGESTIONS ABOUT WWDC SESSION VIDEOS
          </a>
        </h1>

        <span class="post-date">Fri, May 1, 2015</span>

        <p>There has been hundreds of WWDC session videos on <a href="https://developer.apple.com/videos/">Apple WWDC</a>, which provide first-hand knowledges about iOS development from Apple&rsquo;s engineers&rsquo; perspective.</p>

<p>Here records my sorting after watching progressively, mainly about the order and prerequisites of watching part of them.</p>

<ul>
<li><p><strong>View</strong></p>

<ol>
<li>◉ - Introducing Collection View (2012)</li>
<li>◎ - Advanced Collection Views and Building Custom Layouts (2012)</li>
</ol></li>

<li><p><strong>View Controllers</strong></p>

<ol>
<li>◑ - Custom Transitions Using View Controllers (2013)</li>
<li>◑ - View Controller Advancements for iOS 8 (2014)</li>
<li>◑ - Building Adaptive Apps with UIKit (2014)</li>
<li>◑ - Bkuilding Interruptible and Responsive Interactions (2014)</li>
<li>◉ - A Look Inside Presentation Controllers (2014)</li>
</ol></li>

<li><p><strong>Transitions</strong></p>

<ol>
<li>◎ - Best Practices for Cocoa Animation (2013)</li>
<li>◑ - Custom Transitions Using View Controllers (2013)</li>
<li>◑ - Building Adaptive Apps with UIKit (2014)</li>
<li>◎ - Getting Started with UIKit Dynamics (2013)</li>
<li>◎ - Advanced Techniques with UIKit Dynamics (2013)</li>
</ol></li>

<li><p><strong>Auto-Layout</strong></p>

<ol>
<li>◉ - Introduction to Auto Layout for iOS and OS X (2012)</li>
<li>◎ - Best Practices for Mastering Auto Layout (2012)</li>
<li>◎ - Auto Layout by Examples (2012)</li>
<li>◎ - The Evolution of View Controllers on iOS (2012)</li>
<li>◎ - Taking Control of Auto Layout in Xcode 5 (2012)</li>
</ol></li>

<li><p><strong>Networking</strong></p>

<ol>
<li>◑ - Networking Best Practices (2012)</li>
</ol></li>

<li><p><strong>Objective-C</strong></p></li>

<li><p><strong>Swift</strong></p>

<p>see <a href="https://developer.apple.com/swift/resources/">Swift Resources Page</a></p>

<ol>
<li>◎  - Introduction to Swift</li>
<li>◎  - Intermediate Swift</li>
<li>◎  - Advanced Swift</li>
<li>◎  - Swift Playgrounds</li>
<li>◎  - Integrating Swift with Objective-C</li>
<li>◎  - Swift Interoperability In Depth</li>
<li>◎  - Introduction to LLDB and the Swift REPL</li>
<li>◎  - Advanced Swift Debugging in LLDB</li>
</ol></li>

<li><p><strong>Text &amp; Font</strong></p></li>

<li><p><strong>The Developing Tools</strong></p>

<ol>
<li>◎  - Xcode Core Concepts (2013)</li>
<li>◎  - Testing in Xcode 6 (2014)</li>
</ol></li>

<li><p><strong>Other</strong></p>

<ol>
<li>◎  - Protecting Secrets with the Keychain (2013)</li>
<li>◉  - Keychain and Authentication With Touch ID (2014)</li>
</ol></li>
</ul>

      </div>
      
      <div class="post">
        <h1 class="post-title">
          <a href="http://mudox.github.io/post/translation_swift_nullability_and_objective_c/">
            Swift 官博文章翻译 - 可为空性和 Objective-C
          </a>
        </h1>

        <span class="post-date">Thu, Apr 30, 2015</span>

        

<p>原文链接：<a href="https://developer.apple.com/swift/blog/?id=25">Nullability and Objective-C</a></p>

<p>译者：Mudox</p>

<p>Swift 语言的一个很棒的特性就是它能透明的和 Objective-C 代码互操作，不管是系统提供 Objective-C 框架还是那些你自己写的代码都能。然而，在 Swift 中，可为空的值与不可为空的值引用之间使用明显区别的。比如说 <code>NSView</code> 和 <code>NSView?</code> 在 Swift 中是两个截然不同的类型，但在 Objective-C 中他们都用 <code>NSView *</code> 表示。由于 Swift 无法判断 <code>NSView *</code> 到底是可为空的引用还是不可为空的引用，所以 Swift 把此类型转换为一个隐式拆箱的可为空类型（implicitly unwrapped optional）—— <code>NSView!</code></p>

<p>在此前的 Xcode 版本中，Apple 公司对一些框架做了特殊处理，以让它们在 Swift 被转换为适当的可为空类型。Xcode 6.3 引入了一个新的 Objective-C 特性：可为空性注释（nullability annotation），是的程序也能对自己的代码做出同样的处理。</p>

<h1 id="toc_0">核心关键字: <code>__nullable</code>，<code>__nonnull</code></h1>

<p>这项新特性的核心就是两个关键字：<code>__nullable</code>，<code>__nonnull</code>。正如你所想的那样，所有 <code>__nullable</code> 指针可以为 <code>NULL</code> 或者 <code>nil</code>，而所有 <code>__nonnull</code> 指针不行。如果你违反了此规则，编译器将会发出警告。</p>

<pre><code class="language-objc">@interface AAPLList : NSObject &lt;NSCoding, NSCopying&gt;
// ...
- (AAPLListItem * __nullable)itemWithName:(NSString * __nonnull)name;
@property (copy, readonly) NSArray * __nonnull allItems;
// ...
@end

// --------------

[self.list itemWithName:nil]; // warning!
</code></pre>

<p>在您的 Objective-C 代码中，您几乎可以在任何可以用到 <code>const</code> 关键字的地方使用 <code>__nullable</code>，<code>__nonnull</code>，当然必须是修饰指针类型。Swift 还未常用的场景提供了更加漂亮的注释方式：对于那些简单的对象类型或者块类型的类成员声明，您可以使用 <code>__nullable</code>，<code>__nonnull</code> 非下划线版本来就注释他们。</p>

<pre><code class="language-objc">- (nullable AAPLListItem *)itemWithName:(nonnull NSString *)name;
- (NSInteger)indexOfItem:(nonnull AAPLListItem *)item;
</code></pre>

<p>对于属性，您也可以使用非下划线的版本，这次不是放在属性名前面，而是把他们挪到属性列表中（括号里面）。</p>

<pre><code class="language-objc">@property (copy, nullable) NSString *name;
@property (copy, readonly, nonnull) NSArray *allItems;
</code></pre>

<p>非下划线的版本看起来更加舒服，但是您任然需要把他们加到所有需要的头文件中。您可以使用监控区域（audited region）来简化这个过程，并让头文件变得更加干净。</p>

<h1 id="toc_1">监控区域（andited region)</h1>

<p>为了简化新注释关键字的使用，您可以把您的 Objective-C 头文件中的某段代码标记为 <strong>对可为空性进行监控</strong>。在此代码段中，所有的简单指针类型都被编译器默认认为是不可能为空的，也就是 <code>__nonnull</code>。这就大大减少了我们早前的示例中需要做的变动。</p>

<pre><code class="language-objc">NS_ASSUME_NONNULL_BEGIN
@interface AAPLList : NSObject &lt;NSCoding, NSCopying&gt;
// ...
- (nullable AAPLListItem *)itemWithName:(NSString *)name;
- (NSInteger)indexOfItem:(AAPLListItem *)item;

@property (copy, nullable) NSString *name;
@property (copy, readonly) NSArray *allItems;
// ...
@end
NS_ASSUME_NONNULL_END

// --------------

self.list.name = nil;   // okay

AAPLListItem *matchingItem = [self.list itemWithName:nil];  // warning
</code></pre>

<p>处于安全性的考量，该规则有如下例外情况：</p>

<ul>
<li><p><code>typedef</code> 类型别名语句，根据上下文，本身就是有确定的可为空性。它不受监控区域假设的影响。也就是说在监控区域内，<code>typedef</code> 语句定义的指针类型并不是默认为 <code>nonnull</code> 的，而是取决于定义它的原始类型。</p></li>

<li><p>复杂的指针类型必须明确的注释可为空性，不能省略。比如声明一个不可为空的指针只想一个可为空的对象的引用，必须用 <code>__nullable id * __nonnull</code> 来声明。</p></li>

<li><p><code>NSError</code> 是一个特殊的类型，它被用来通过参数返回错误。它总是一个指向一个可为空 <code>NSError</code> 对象指针的可为空指针，即 <code>__nullable NSError * __nullable</code>。</p></li>
</ul>

<h1 id="toc_2">兼容性</h1>

<p>那么如果您已经有了自己的 Objective-C 框架，现在要混合使用些类型安全么？当然，答案是肯定的。</p>

<ul>
<li><p>现存的，已经编译好的 Objective-C 框架代码依然会继续工作，他们的应用二进制接口（ABI）并没有变（其实变化只发生在编译时）。这样意味着，老代码不会扑捉到错误的 nil 赋值。</p></li>

<li><p>当你转而使用新的 Swift 编译时，它能对您的使用旧框架代码的当前代码中不安全的行为发出警报。</p></li>

<li><p><code>nonnull</code> 不会影响编译器优化。如果为了向后兼容，您仍然可以对您可以在代码中加入检查指针是否为空的逻辑。</p></li>
</ul>

<p>大体上您可以把 <code>nonnull</code> 和 <code>nullable</code> 当做断言或者异常捕捉特性来使用：违反协议是程序员本身的错误。毕竟是由您完全控制您的函数会返回什么值，因此在不该返回 <code>nil</code> 的函数中，您应该负责确保它不会返回空值，除非是为了向后兼容。</p>

<h1 id="toc_3">回到 Swift</h1>

<p>现在我们已经在我们的 Objective-C 一端用上了可为空性注释，让我们看看 Swift 一端该跟着怎么变：</p>

<p>在用到注释之前：</p>

<pre><code class="language-swift">class AAPLList : NSObject, NSCoding, NSCopying {
  // ...
  func itemWithName(name: String!) -&gt; AAPLListItem!
  func indexOfItem(item: AAPLListItem!) -&gt; Int

  @NSCopying var name: String! { get set }
  @NSCopying var allItems: [AnyObject]! { get }
  // ...
}
</code></pre>

<p>Objective-C 一端添加了注释之后：</p>

<pre><code class="language-swift">class AAPLList : NSObject, NSCoding, NSCopying {
  // ...
  func itemWithName(name: String) -&gt; AAPLListItem?
  func indexOfItem(item: AAPLListItem) -&gt; Int

  @NSCopying var name: String? { get set }
  @NSCopying var allItems: [AnyObject] { get }
  // ...
}
</code></pre>

<p>是不是比以前清爽了？虽然只是细微的变化（少了几个类型后缀 <code>!</code>），但是这必将使您在 Swift 中使用以前的框架的心情更加愉快。</p>

<p>详情请参考 <a href="http://developer.apple.com/go/?id=xcode-6.3-beta-release-notes">Xcode 6.3 Release Notes</a></p>

      </div>
      
      <div class="post">
        <h1 class="post-title">
          <a href="http://mudox.github.io/note/ios_notes_media_frameworks/">
            iOS NOTES - MEDIA FRAMEWORKS
          </a>
        </h1>

        <span class="post-date">Wed, Apr 29, 2015</span>

        

<h1 id="toc_0">iOS Media Frameworks Stack</h1>

<p><img src="../../../note/media_stack.svg" alt="iOS media frameworks Stack" />
</p>

<h1 id="toc_1">The Trunk Relation Graph</h1>

<p><img src="../../../note/media_trunk_graph.svg" alt="iOS media framework trunk relation graph" />
</p>

      </div>
      
      <div class="post">
        <h1 class="post-title">
          <a href="http://mudox.github.io/post/translation_swift_dynamic_dispath/">
            Swift 官博文章翻译 - 通过减少动态调度来拉升程序性能
          </a>
        </h1>

        <span class="post-date">Wed, Apr 29, 2015</span>

        

<p>原文链接：<a href="https://developer.apple.com/swift/blog/?id=27">Increasing Performance by Reducing Dynamic Dispatch </a></p>

<p>译者：Mudox</p>

<p>和其他很多语言一样，Swift 运行程序员改写从父类集成来的方法和属性。这意味着程序得在运行时也只用在运行时才能判断所引用的具体的方法或属性，并间接的调用或访问他们。这一技术名为“动态分配 dynamic dispatch”，通过为每次间接调用或访问增加常亮时间的开销来换取语言表达能力的提升。对于性能苛刻的代码，这类开销是不可取的。本文将展示三种通过消除此类动态性来拉升程序性能的方法：<code>final</code>，<code>private</code> 以及整模块优化策略。</p>

<p>请看如下代码:</p>

<pre><code class="language-swift">class ParticleModel {
  var point = ( 0.0, 0.0 )
  var velocity = 100.0

  func updatePoint(newPoint: (Double, Double), newVelocity: Double) {
    point = newPoint
    velocity = newVelocity
  }

  func update(newP: (Double, Double), newV: Double) {
    updatePoint(newP, newVelocity: newV)
  }
}

var p = ParticleModel()
for i in stride(from: 0.0, through: 360, by: 1.0) {
  p.update((i * sin(i), i), newV:i*1000)
}
</code></pre>

<p>编译器将会生成如下动态分派代码：</p>

<ol>
<li>调用 <code>update</code> 于 <code>p</code>。</li>
<li>调用  <code>updatePoint</code> 于 <code>p</code>。</li>
<li>访问 <code>p</code> 的 <code>point</code> 元祖属性。</li>
<li>访问 <code>p</code> 的 <code>velocity</code> 属性。</li>
</ol>

<p>这也许并不是你想要的。动态调度在这里之所以必要，是因为 <code>ParticleModel</code> 的子类可能重写其属性。</p>

<p>在 Swift 中，动态调度通过从函数表中搜索正确的函数并间接调用他们来实现。这显然比直接调用来的慢。此外，间接调用还会阻碍很多编译器对代码的优化，这又进一步增加了程序运行的开销。在性能关键的代码中，Swift 提供了一些技术来关闭某些不必要的动态调度以拉升程序性能。</p>

<h2 id="toc_0">当你确定某个声明不会被覆盖时，使用 <code>final</code> 关键字</h2>

<p>关键字 <code>final</code> 可以修饰类，方法或者属性的声明，它指示编译器这些声明不会被后续代码覆盖。这样编译器就能放心的在这些对象上关闭动态调度特性（不生成动态调度的代码）。比如下面的类属性 <code>point</code>，<code>velocity</code> 和函数 <code>updatePoint()</code> 将被直接访问和调用。而方法 <code>update()</code> 仍然需要通过动态调度来间接的被调用，它也因此能被子类们覆盖。</p>

<pre><code class="language-swift">class ParticleModel {
  final var point = ( x: 0.0, y: 0.0 )
  final var velocity = 100.0

  final func updatePoint(newPoint: (Double, Double), newVelocity: Double) {
    point = newPoint
    velocity = newVelocity
  }

  func update(newP: (Double, Double), newV: Double) {
    updatePoint(newP, newVelocity: newV)
  }
}
</code></pre>

<p>It is possible to mark an entire class as final by attaching the attribute to the class itself. This forbids subclassing the class, implying that all functions and properties of the class are final as well.</p>

<p>您可以用 <code>final</code> 修饰整个类的声明，这样做将直接禁止对该类的子类化，因此对其所有属性和方法的访问将都是直接的。</p>

<pre><code class="language-swift">final class ParticleModel {
  var point = ( x: 0.0, y: 0.0 )
  var velocity = 100.0
  // ...
}
</code></pre>

<h2 id="toc_1">为 <code>private</code> 声明自动推导 <code>final</code> 语义</h2>

<p>被 <code>private</code> 修饰的声明其可见性会限制在声明它的文件里。如果在该文件里，没有发现对该声明的覆盖，编译器就不会为该声明生成动态调度代码，而是直接的访问他们。</p>

<p>假设在该文件中，没有对类 <code>ParticleModel</code> 的覆盖，那么编译器就会关闭对其所有 <code>private</code> 成员的动态调度，取而代之以更加快速的直接访问。
Assuming there is no class overriding ParticleModel in the current file, the compiler can replace all dynamically dispatched calls to private declarations with direct calls.</p>

<pre><code class="language-swift">class ParticleModel {
  private var point = ( x: 0.0, y: 0.0 )
  private var velocity = 100.0

  private func updatePoint(newPoint: (Double, Double), newVelocity: Double) {
    point = newPoint
    velocity = newVelocity
  }

  func update(newP: (Double, Double), newV: Double) {
    updatePoint(newP, newVelocity: newV)
  }
}
</code></pre>

<p>上述代码中，<code>point</code>，<code>velocity</code> 和 <code>updatePoint()</code> 将被直接访问和调用。由于 <code>update()</code> 没有被 <code>private</code> 修饰，它仍然需要被动态调度。</p>

<p>和 <code>final</code> 一样，<code>private</code> 也可以被用来直接修饰整个类声明，这相当于在该类的所有成员声明面前加了 <code>private</code> 关键字。</p>

<pre><code class="language-swift">private class ParticleModel {
  var point = ( x: 0.0, y: 0.0 )
  var velocity = 100.0
  // ...
}
</code></pre>

<h1 id="toc_2">通过模块级的优化来对 <code>internal</code> 声明推导出 <code>final</code> 语义</h1>

<p>在 Swift 中，所有声明的可见性默认为 <code>internal</code>，也就是说他们只能在定义他们的模块内可见。编译器通常会单独的编译模块内的每个文件，因此它在变异某一个源文件时，无法判断在同意模块内的其他源文件里是否对该源文件内定义的 <code>internal</code> 声明的覆盖。但是如果我们启用了编译器的 <code>Whole Module Optimization</code> 模块级优选项，所以的文件将在一次编译过程中全部被编译。这样编译器就能在整个模块范围类分析是否某个 <code>internal</code> 声明被覆盖了，从而推导出 <code>final</code> 语义以关闭动态调度特性。</p>

<p>让我们回到最开始的代码，这回我们额外添加一些 <code>public</code> 关键到 <code>ParticleModel</code> 的声明中。</p>

<pre><code class="language-swift">public class ParticleModel {
  var point = ( x: 0.0, y: 0.0 )
  var velocity = 100.0

  func updatePoint(newPoint: (Double, Double), newVelocity: Double) {
    point = newPoint
    velocity = newVelocity
  }

  public func update(newP: (Double, Double), newV: Double) {
    updatePoint(newP, newVelocity: newV)
  }
}

var p = ParticleModel()
for i in stride(from: 0.0, through: times, by: 1.0) {
  p.update((i * sin(i), i), newV:i*1000)
}
</code></pre>

<p>当开启了模块级优化选项的编译器处理以上代码时，它能够推导出 <code>point</code>, <code>velocity</code> 和 <code>updatePoint()</code> 方法可以关闭动态调度特性。与此相反，由于 <code>update()</code> 被 <code>public</code> 修饰，其可见性延伸到了模块之外，所以编译器无法断定它具有 <code>final</code> 语义。</p>

      </div>
      
      <div class="post">
        <h1 class="post-title">
          <a href="http://mudox.github.io/post/translation_swift_memory_safety/">
            Swift 官博文章翻译 - 内存安全：确保值在使用前先初始化
          </a>
        </h1>

        <span class="post-date">Tue, Apr 28, 2015</span>

        

<p>原文链接：<a href="https://developer.apple.com/swift/blog/?id=28">Memory Safety: Ensuring Values are Initialized Before Use</a></p>

<p>译者：Mudox</p>

<p>我们设计 Swift 这门语言时的一个重要的发力方向就是改进编程模型的内存安全性。内存安全有很多方面，本文将由浅入深，先从一个简单的问题开始：如果确保值在使用前被初始化。</p>

<h1 id="toc_0">Swift 的方式</h1>

<p>如果每当一个变量第一次被访问时，该变量都有一个有效的初始值，那么该变量就被认为是“安全”的。不同的语言采用了不同的方式来提供这种安全性。比如 C 语言，它将责任完全交给程序员——这种方法强大，但是也很有难度。C++ 和 Objective-C 通过施加一些强制性的模式来改善此类情况，还有一些语言则（比较极端的）要求变量在定义时就必须初始化。</p>

<p>Swift 采用的主要技术是通过其先进的编译器来对代码的数据流进行分析。由编译器在编译时确保变量在使用前正确初始化，这是是一种名为 <a href="http://en.wikipedia.org/wiki/Definite_assignment_analysis">明确初始化——Definitive Initialization</a> 的策略。还有很多语言比如 Java，C# 都采用了类似的策略，而 Swift 则是的该策略的一个扩展版本应用于更大范围的变量上面。</p>

<h1 id="toc_1">本地变量的明确初始化</h1>

<p>在 Swift 中有很多场景都用到了该策略，其中最简单的场景就是用于本地变量。相较于“隐式的默认值初始化 implicit default initialization”，明确初始化初始化提供了更大的灵活性，因为它运行你写出如下的代码：</p>

<pre><code class="language-swift">var myInstance : MyClass  // Uninitialized non-nullable class reference

if x &gt; 42 {
  myInstance = MyClass(intValue: 13)
} else {
  myInstance = MyClass(floatValue: 92.3)
}

// Okay because myInstance is initialized on all paths
myInstance.printIt()
</code></pre>

<p>这里编译器能分析出 <code>if</code> 语言的两个分支里都对变量 <code>myInstance</code> 做了初始化，因此它确信后面的 <code>printIt()</code> 方法不会被调用于未初始化的内存上面。</p>

<p>明确初始化策非常强大，但是它只有在代码可靠并可预测的情况下才能发挥作用。当你的代码的控制流逻辑比较复杂时，它就可能出意外。比如如下代码：</p>

<pre><code class="language-swift">var myInstance : MyClass

if x &gt; 10 {
  myInstance = MyClass(intValue: 13)
}
// ...
if x &gt; 42 {
  myInstance.printIt()
}
</code></pre>

<p>上述代码运行时，编译器会发出警告：“变量 <code>myInstance</code> 在使用前未初始化”。这是因为编译器并不能分析出上下两个 if 语句的条件之间的内在逻辑关系。尽管我们能让编译器照顾到此类个别特殊情况，但是它还是不可能覆盖所有的特殊情况（这其实就是所谓的“<a href="http://en.wikipedia.org/wiki/Halting_problem">停机问题 halting problem</a>”），因此我们决定保持编译规则简单可预测。</p>

<p>Swift 使初始化一个变量变得极其简单。事实上用 Swift 在声明时给出初始化值 <code>var x = 0</code> 比声明一个未初始化的变量 <code>var x: Int</code> 所得到的代码更简短。Swift 提倡在任何可能的时候给声明的变量一个明确的初始化值。还有更加强大的方法就是通过调用 <code>init()</code> 方法来初始化一个变量。想要了解更加详细的信息，请参阅 Swfit Programming Language 的“<a href="https://developer.apple.com/library/ios/documentation/Swift/Conceptual/Swift_Programming_Language/Initialization.html">初始化 Initialization</a>” 一章。</p>

<h1 id="toc_2">其他的方式</h1>

<p>除了明确初始化之外，Swift 在特定情况下也会采用一些其他的策略。您很可能已经在其他语言中碰到过这些策略，因此我们将在本文中简短的介绍下他们。他们都用各自不足之处，所以 Swift 并没有将他们当做主要策略来使用。</p>

<p><strong>将安全性交给程序员</strong>：鉴于 C 的普及程度，我们有必要了解下简单的将安全性责任交给程序员这种做法的利与弊。在 C 中使用未经初始化的值会导致<a href="http://blog.llvm.org/2011/05/what-every-c-programmer-should-know.html">不确定的行为 undefined behavior</a>，经常表现为程序的运行时异常。C 语言依赖程序永远都不要犯错误。我们设计 Swift 语言的初衷之一就是让它从本质上就是安全的，所以这一策略果断被我们排除于绝大部分情况之外。但是，Swift 还是提供了诸如 <code>UnsafePointer</code> 这样的 API，以允许你再绝对必要的情况下启用这种策略。</p>

<p><strong>隐式的默认值初始化</strong>：可以让编译器隐式的初始化一个值，以确保其安全性。比如，在 Objective-C 中，给实例的成员变量设置一个初始的“零值”，或者像 C++ 那样给类提供默认的初始化器。我们曾深入探索过这一方法，但做种决定不广泛使用它。因为：</p>

<ul>
<li><p>它对与那些没有合理初始化值的类型不起作用，比如 protocol 对象并没有 <code>init()</code> 方法可以调用，已经在 Swift 非常普遍的不可为空的类引用。</p></li>

<li><p>就算是对于基本类型，比如对于一个 integer 变量，0 常常在上下文中是一个不合理的值。这也是为什么在 Swift 中给变量赋初始化值如此容易的原因之一。此外，这让代码对于后续的维护者更加的清晰明了。</p></li>
</ul>

<p>注意：对于 <code>Optional</code> 和 <code>ImplicitlyUnwrappedOptional</code> 这类可以为空的值，把他们默认初始化为空 <code>nil</code> 是理所当然的。因此在 Swift 中所有飞空值都会被自动初始化为空值。</p>

<p><strong>强制在定义时初始化</strong>：强制要求程序在定义变量是给与其初始值，意味着 <code>var x: Int</code> 将是非法的，因为它没有提供初始值给编译器。尽管该策略通用于函数式编程语言中, 但是我们认为这一要求国语严格而没有必要，也妨碍了程序员对自然模式的表达。</p>

      </div>
      
      <div class="post">
        <h1 class="post-title">
          <a href="http://mudox.github.io/note/ios_notes_amap/">
            iOS NOTES - AMAP API DEPICTED
          </a>
        </h1>

        <span class="post-date">Tue, Apr 28, 2015</span>

        

<p>AMap (高德地图) APIs depicted in several graphs I draw.</p>

<h1 id="toc_0">AMap Searching API</h1>

<p><img src="../../../note/amap_searching_graph.svg" alt="AMap Searching API Graph" />
</p>

      </div>
      
      <div class="post">
        <h1 class="post-title">
          <a href="http://mudox.github.io/note/ios_notes_lbs/">
            iOS NOTES - LOCATION BASED SERVIES
          </a>
        </h1>

        <span class="post-date">Fri, Apr 17, 2015</span>

        

<p>Quick steps to use iOS&rsquo;s LBS technology.</p>

<h1 id="toc_0">Core Location</h1>

<p>iOS devices integrates various hardware components, such as:</p>

<ul>
<li><p>GPS (Global Positioning System) for positioning</p></li>

<li><p>Hardware compass for heading monitoring.</p></li>

<li><p>WiFi for positioning.</p></li>

<li><p>Cellular network for cell-tower triangulation.</p></li>

<li><p>Blue tooth for iBeacon ranging.</p></li>

<li><p>some data sensors for improve positioning accuracy under some circumstances.</p></li>
</ul>

<p>to provides users with following LBS abilities as much as possible:</p>

<ol>
<li><p>Location Updates</p>

<ol>
<li><p>Standard location updates</p></li>

<li><p>Significant location updates</p></li>
</ol></li>

<li><p>Heading monitoring</p></li>

<li><p>Region monitoring</p></li>

<li><p>iBeacon ranging</p></li>

<li><p>Visit events</p></li>
</ol>

<p>The <code>CLLocationManager</code> acts just like an <code>NSNotificationCenter</code> (but it is not
a singleton) between the LBS hardwares and your App, you use it to request the
authorization for LBS functionalities you are planning to use afterwords, and
adjusts the relevant parameters of them before starting their notification
updating loops.</p>

<p>After you call one of its&rsquo; <code>start***</code> or <code>request***</code> methods to emit requests
for one of the 5 LBS abilities mentioned above, the <code>CLLocationManager</code>
activate relevant hardware components, when the data is available it notifies
you asynchronously by calling one of the its&rsquo; delegate&rsquo;s methods.</p>

<p><img src="../../../note/core_location_map.svg" alt="Core Location Map" />
</p>

<h2 id="toc_1">Work flow of using LBS abilities.</h2>

<ol>
<li><p>Project setup</p>

<ol>
<li><p>Enable <em>Background Location Updates Background Mode</em> capability.</p></li>

<li><p>Add <em>NSLocationAlwaysUsageDescriptions</em> or
<em>NSLocationWhenInUseUsageDescription</em> key to info.plist.</p></li>
</ol></li>

<li><p>Configuring <code>CLLocationManager</code></p>

<ol>
<li><p>Creating a <code>CllocationManager</code> instance and hold a strong reference to it.</p></li>

<li><p>Specify location manager&rsquo;s delegate, usually be a view controller.</p></li>

<li><p>Check &amp; request authorization status.</p></li>

<li><p>Configures the relevant properties for the LBS functionality you are about
to use.</p></li>

<li><p>Before starting each LBS updating functions, there are also corresponding
APIs you can invoke to check the services availability.</p></li>

<li><p>Call <code>start**</code> methods to start the various LBS notification loops.</p></li>
</ol>

<pre><code class="language-swift">// declare as some long-standing reference outside of function body.
let locationManager = CLLocationManager()
--------------------
// within functions ( be it in viewDidLoad() )
// designate delegate
locationManager.delegate = self
// request for authorization
locationManager.requestAlwaysAuthorization()
// configure updating related settings
locationManager.activityType = .AutomotiveNavigation
locationManager.desiredAccuracy = kCLLocationAccuracyBestForNavigation
locationManager.distanceFilter = 10
// finally check device &amp; service availability before starting notification loop.
if CLLocationManager.locationServicesEnabled() {
  locationManager.startUpdatingLocation()
} else {
  let alert = UIAlertController(
    title: &quot;Service Not Available&quot;,
    message: &quot;The location is not available or has been shut down.&quot;,
    preferredStyle: .Alert)
  presentViewController(alert, animated: true, completion: nil)
}
</code></pre></li>

<li><p>Implement <code>CLLocationManagerDelegate</code> methods in you designated delegate
object to:</p>

<ul>
<li><p>handle received location data updates.</p></li>

<li><p>handle LBS failures.</p></li>

<li><p>handle authorization status changes.</p></li>

<li><p>&hellip;</p></li>
</ul></li>
</ol>

<h1 id="toc_2">MapKit</h1>

<p>In general, MapKit:</p>

<ol>
<li><p>shows map in one of three map types:</p>

<ul>
<li><p>Standard</p></li>

<li><p>Satellite</p></li>

<li><p>Hybrid</p></li>
</ul></li>

<li><p>along with many built-in elements:</p>

<ul>
<li><p>compass</p></li>

<li><p>POIs (points of interest)</p></li>
</ul></li>

<li><p>and provides developer with two kinds of customizable presentation
facilities:</p>

<ul>
<li><p>annotations</p></li>

<li><p>overlays</p></li>
</ul></li>
</ol>

<p>As of managing annotations, MapKit adopts the same design pattern as that is
heavily used by <code>UITableView</code> &ndash; decoupling data model from presentation tools
through <strong>reuse pool</strong>. Hence, there comes separate class hierarchies for
storing annotation (overlay) data, and presenting them respectively.</p>

<ul>
<li><p>data object</p>

<ul>
<li><p>all objects that conforms to <code>MKAnnotation</code> protocol, are responsible for
storing data for annotations, such as location, textual info, etc.</p></li>

<li><p>all objects that conforms to <code>MKOverlay</code> protocol, are responsible for
storing data for overlays, such as location, etc.</p></li>
</ul></li>

<li><p>presentation tools</p>

<ul>
<li><p>instances that inherit from <code>MKAnnotationView</code> can be <strong>reused</strong> to display a data objects.</p></li>

<li><p>instances that inherit from <code>MKOverlayRenderer</code> can be used to display a overlay objects.</p></li>
</ul></li>
</ul>

<p><img src="../../../note/map_kit_map.svg" alt="MapKit map" />
</p>

<h2 id="toc_3">Customize annotation view</h2>

<p>A annotation view usually consist of 2 parts:</p>

<ol>
<li>The view view.</li>
</ol>

<p>Set its&rsquo; <code>image</code> property to change its&rsquo; appearance.</p>

<ol>
<li>The callout view, which is popped up when the pin view is selected.</li>
</ol>

<p>The built-in callout view is not exposed for customization, so we should disable the <code>canShowCallout</code> property</p>

      </div>
      
      <div class="post">
        <h1 class="post-title">
          <a href="http://mudox.github.io/note/swift_notes_closure/">
            SWIFT NOTES - CLOSURE
          </a>
        </h1>

        <span class="post-date">Tue, Apr 14, 2015</span>

        

<p>Thanks to the host of technologies provided by the Swift
compiler, the closure comes with a bunch of syntactic
sugars that could sweet you to diabetes.</p>

<p>The full syntax of a closure:</p>

<pre><code class="language-swift">{
  (parameters) -&gt; retrunType in
  ... statements ...
}
</code></pre>

<p>Here is an example that uses the array&rsquo;s method <code>sorted</code> to sort an array of
word.</p>

<pre><code class="language-swift">var words = [ &quot;Dolor&quot;, &quot;eum&quot;, &quot;id&quot;, &quot;suscipit&quot;, &quot;necessitatibus&quot;, &quot;quod&quot;, &quot;hic&quot;, &quot;dignissimos&quot; ]

let sortedWords = words.sorted({
  (lhs: String, rhs: String) -&gt; Bool in
  return lhs &lt; rhs
})
</code></pre>

<p>As the sugars introduced in, we will cut the lines above into an incredibly one
line of code.</p>

<h1 id="toc_0">Sugar #0 &ndash; trailing closure</h1>

<p>Often, closure parameter is placed last in parameter list. Swift thus provides
<strong>trailing closure</strong>, which means your can write the inline closure just
outside the parameter list, following the closing <code>)</code>.</p>

<p>Furthermore, if the closure is the only parameter, then the parenthesis can be
omitted.</p>

<pre><code class="language-swift">// trailing closure
let sortedWords = words.sorted/*()*/ {
  (lhs: String, rhs: String) -&gt; Bool in
  return lhs &lt; rhs
}
</code></pre>

<h1 id="toc_1">Sugar #1 &ndash; return type inference</h1>

<p><strong>return type</strong> can be inferred by swift compiler.</p>

<pre><code class="language-swift">// omit return type
let sortedWords = words.sorted {
  (lhs: String, rhs: String) /*-&gt; Bool*/ in
  return lhs &lt; rhs
}
</code></pre>

<h1 id="toc_2">Sugar #2 &ndash; parameter type inference</h1>

<p><strong>parameter types</strong> can be inferred by swift compiler as well.</p>

<pre><code class="language-swift">// omit parameter types
let sortedWords = words.sorted {
  (lhs/*: String*/, rhs/*: String*/) /*-&gt; Bool*/ in
  return lhs &lt; rhs
}
</code></pre>

<h1 id="toc_3">Sugar #3 &ndash; parenthesis-less</h1>

<p>Since no type annotation is needed, the <strong>parenthesis</strong> can be omitted.</p>

<pre><code class="language-swift">// omit parenthesis
let sortedWords = words.sorted {
  /*(*/lhs/*: String*/, rhs/*: String)*/ /*-&gt; Bool*/ in
  return lhs &lt; rhs
}
</code></pre>

<h1 id="toc_4">Sugar #4 &ndash; return statement inference</h1>

<p>If the closure has one statement, then the <strong>return</strong> statement can also be
inferred.</p>

<pre><code class="language-swift">// omit 'return'
let sortedWords = words.sorted {
  /*(*/lhs/*: String*/, rhs/*: String)*/ /*-&gt; Bool*/ in
  /*return*/ lhs &lt; rhs
}

//then we got:
let sortedWords = words.sorted { lhs, rhs in lhs &lt; rhs }
</code></pre>

<h1 id="toc_5">Sugar #5 &ndash; shorthand parameter name</h1>

<p>Swift provides <strong>shorthand parameter names</strong>: $0 for the 1st parameter, $1 for
the 2nd parameter, and so on. And as an side effect, the whole <code>(parameters) -&gt;
returType in</code> statement can be completely omitted</p>

<pre><code class="language-swift">// use shorthand parameters, omit the whole 'in' statement
let sortedWords = words.sorted {
  /*(lhs: String, rhs: String) -&gt; Bool in*/
  /*return*/ $0 &lt; $1
}

// then we got:
let sortedWords = words.sorted { $0 &lt; $1 }
</code></pre>

<h1 id="toc_6">Sugar #6 &ndash; operator as a closure</h1>

<p>In swift, <strong>operator</strong> is a function, which in turn is a <strong>special closure</strong>, so&hellip;</p>

<pre><code class="language-swift">// comes operator!
let sortedWords = words.sorted(&lt;)
</code></pre>

      </div>
      
      <div class="post">
        <h1 class="post-title">
          <a href="http://mudox.github.io/note/unicode_concepts_defined/">
            SOME UNICODE CONCEPTS CLARIFIED
          </a>
        </h1>

        <span class="post-date">Mon, Apr 13, 2015</span>

        <p>Collect several Unicode concepts encountered when I learn Swift&rsquo;s String type.</p>

<ul>
<li><p>UCS</p>

<p>Universal Coded Character Set (通用字符集)</p>

<blockquote>
<p>The Universal Coded Character Set (UCS), defined by the International
Standard ISO/IEC 10646, Information technology — Universal Coded
Character Set (UCS) (plus amendments to that standard), is a standard set
of characters upon which many character encodings are based. The UCS
contains nearly one hundred thousand abstract characters, each identified
by an unambiguous name and an integer number called its code point.</p>
</blockquote></li>

<li><p>Unicode</p>

<p>统一码，万国码, 单一码</p>

<blockquote>
<p>Unicode is a computing industry standard for the consistent encoding,
representation, and handling of text expressed in most of the world&rsquo;s
writing systems. Developed in conjunction with the Universal Character
Set standard and published as The Unicode Standard, the latest version of
Unicode contains a repertoire of more than 110,000 characters covering
100 scripts and multiple symbol sets.</p>
</blockquote>

<p>As for its&rsquo; code space layout:</p>

<blockquote>
<p>Unicode comprises 1,114,112 code points in the range 0x0 to 0x10FFFF.
The Unicode code space is divided into 17 planes (the basic multilingual
plane, and 16 supplementary planes), each with 65,536 (= 216) code
points. Thus the total size of the Unicode code space is 17 × 65,536 =
1,114,112.</p>
</blockquote></li>

<li><p>UTF</p>

<p>UCS/Unicode Transformation Format (通用字符集转换格式, Unicode 转换格式)</p></li>

<li><p>UTF-8</p>

<blockquote>
<p>UTF-8 (U from Universal Character Set + Transformation Format—8-bit[1])
is a character encoding capable of encoding all possible characters
(called code points) in Unicode. The encoding is variable-length and uses
8-bit code units. It was designed for backward compatibility with ASCII
and to avoid the complications of endianness and byte order marks in
UTF-16 and UTF-32.</p>
</blockquote></li>

<li><p>code point (code position)</p>

<blockquote>
<p>In character encoding terminology, a code point or code position is any
of the numerical values that make up the code space.</p>
</blockquote></li>

<li><p>Unicode scalar</p>

<blockquote>
<p>Behind the scenes, Swift’s native String type is built from Unicode
scalar values. A Unicode scalar is a unique 21-bit number for a character
or modifier.</p>
</blockquote>

<p>The distinction between Unicode scalar &amp; Unicode code point could be
clarified as follows:</p>

<blockquote>
<p>A Unicode scalar is any Unicode code point in the range U+0000 to U+D7FF
inclusive or U+E000 to U+10FFFF inclusive. Unicode scalars do not include
the Unicode surrogate pair code points, which are the code points in the
range U+D800 to U+DFFF inclusive.</p>
</blockquote>

<p>It is a Swift language specific notion, or more actually, a Swift defined
internal type for storing string charactor&rsquo;s Unicode points that Swift
choose to support. Behind the scene, it&rsquo;s a 21bit long numeric type, but
not all number in the range can reponds to a valid Unicode point.</p>

<p>So mathematically, the Unicode points universal set is a discrete subset of
integer set [0, 0x10FFFF]. The Swift Unicode scalar universal set is, in
turn, a discrete subset of Unicode code point universal set (with all
<em>surroagte pair</em> code points stripped).</p></li>

<li><p>code unit</p>

<blockquote>
<p>A code unit is a bit sequence used to encode each character of a
repertoire. Encodings associate their meaning with either a single code
unit value or a sequence of code units as one value.</p>
</blockquote></li>

<li><p>extended grapheme cluster</p>

<blockquote>
<p>Every instance of Swift’s Character type represents a single extended
grapheme cluster. An extended grapheme cluster is a sequence of one or
more Unicode scalars that (when combined) produce a single human-readable
character.</p>
</blockquote></li>
</ul>

      </div>
      
      <div class="post">
        <h1 class="post-title">
          <a href="http://mudox.github.io/note/swift_notes_functions/">
            SWIFT NOTES - FUNCTIONS
          </a>
        </h1>

        <span class="post-date">Mon, Apr 13, 2015</span>

        

<p>Excerpts from the &ldquo;Functions&rdquo; section of the official docuemnt <a href="http://developer.apple.com/library/prerelease/ios/documentation/swift/conceptual/swift_programming_language/LexicalStructure.html">《The Swift
Programming Language》</a></p>

<h1 id="toc_0">Function Parameters</h1>

<h2 id="toc_1">Parameter names</h2>

<p>A parameter name can have a <strong>internal name</strong> and an <strong>external name</strong> declared
in the form of: <code>external_name internal_name: type</code>.</p>

<pre><code class="language-swift">func join(String string: leftString, toString rightString) -&gt; String {
  return leftString + rightString
}

println(join(String: &quot;Hello&quot;, toString: &quot; World!&quot;))
</code></pre>

<p>Use <code>#</code> to use the same name for both names: <code>#name: type</code></p>

<pre><code class="language-swift">func join(#aString: leftString, #toString) -&gt; String {
  return aString + toString
}

println(join(aString: &quot;Hello&quot;, toString: &quot; World!&quot;))
</code></pre>

<p>Use <code>_</code> to suppress external name: <code>_ internal_name: type</code></p>

<pre><code class="language-swift">func join(_ aString: leftString, _ toString) -&gt; String {
  return aString + toString
}

println(join(&quot;Hello&quot;, &quot; World!&quot;))
</code></pre>

<h2 id="toc_2">Parameters with default value</h2>

<p>Default parameter values of the <code>[external_name /_/#]internal_name: type =
default_value</code> should be placed at end of the parameter list.</p>

<p>The compiler will synthesize a external name by reusing the internal name for
parameters with default value, if their external name is not explicitly
specified in the parameter list. (You can use <code>_</code> to suppress this behavior,
which is not recommended.)</p>

<pre><code class="language-swift">func Foo(arg1: String, arg2: Int = 30, _ arg3: Bool, #arg4: Double) {
  ...
}

Foo(&quot;text&quot;, arg2: 1, true, arg4: 4.0)
</code></pre>

<h2 id="toc_3">Variadic parameters</h2>

<p>Declare variadic parameter in form <code>name: type...</code>, which, in the function
body, is of type <code>[type]</code>.</p>

<p>Only one variadic parameter is allowed in a parameter list, and it should be
placed after all other normal parameters or parameters with default value.</p>

<h2 id="toc_4">Variable parameters</h2>

<p>Prefix parameter names with keyword <code>var</code> to make them modifiable inside the
function body.</p>

<p>It is just another small syntactic sugar brought by Swift, the change made in
the function body will not propagate outside the function body.</p>

<h2 id="toc_5">In-Out parameters</h2>

<p>Prefix parameters names with keyword <code>inout</code> (which implies <code>var</code>) to make the
change to the parameter inside function body propagate outside.</p>

<p>When specifying argument for <code>inout</code> parameters, prepend <code>&amp;</code> to the argument
name to indicate that it could be modified during the function call.</p>

<p>In-out parameters cannot have default values, and variadic parameters cannot be
marked as <code>inout</code>. If you mark a parameter as <code>inout</code>, it cannot also be marked
as var or let.</p>

<pre><code class="language-swift">func swapTwoInts(inout a: Int, inout b: Int) {
    let temporaryA = a
    a = b
    b = temporaryA
}

var a = 2
var b = 10
swapTwoInts(&amp;a, &amp;b)
println(&quot;after swapping, a = \(a), b = \(b)&quot;)
</code></pre>

<h1 id="toc_6">Function Return Values</h1>

<p>Functions without a defined return type return a special value of type
<strong>Void</strong>.  This is simply an empty tuple, in effect a tuple with zero elements,
which can be written as <code>()</code>.</p>

<p>You can use a tuple type (or a optional tuple) as the return type for a
function to return multiple values as part of one compound return value.</p>

<pre><code class="language-swift">// wrap multiple return values in an optional tuple.
func minMax(array: [Int]) -&gt; (min: Int, max: Int)? { ... }

if let minMax = minMax([1,2,3]) {
  // use name to fetch tuple element.
  println(&quot;min: \(minMax.min)\tmax: \(minMax.max)&quot;)

  // use index to fetch tuple elements.
  println(&quot;min: \(minMax.0)\tmax: \(minMax.1)&quot;)
}
</code></pre>

<h1 id="toc_7">Function Types</h1>

<p>In Swift, function is first class object, so feel free to use them as other
normal objects:</p>

<ul>
<li><p>passing them as argument into functions.</p></li>

<li><p>return them from functions.</p></li>

<li><p>declare theme as type alias for convenience.</p></li>

<li><p>even nest their in another function.</p></li>

<li><p>&hellip;</p></li>
</ul>

<pre><code class="language-swift">typealias cmp = (Int, Int) -&gt; Bool

func whichCmp(functionPassedIn: ()-&gt; Bool) -&gt; cmp {
  func Foo(lhs: Int, rhs: Int) -&gt; Bool {
    return false
  }

  func Hoo(lhs: Int, rhs: Int) -&gt; Bool {
    return true
  }

  return functionPassedIn() ? Foo : Hoo
}

func aFunc() -&gt; Bool {
  return false
}

whichCmp(aFunc)(1334, 234)
</code></pre>

      </div>
      
      <div class="post">
        <h1 class="post-title">
          <a href="http://mudox.github.io/note/ios_notes_casting/">
            iOS NOTES - CASTING
          </a>
        </h1>

        <span class="post-date">Sun, Apr 12, 2015</span>

        

<p>Collect all my gain from study &amp; using Swift&rsquo;s casting mechanism here.</p>

<p>First defining a sample class hierarchy:</p>

<pre><code class="language-swift">class SuperClass {
  func say() {
    println(&quot;super class&quot;)
  }
}

class Subclass: SuperClass {
  override func say() {
    println(&quot;subclass&quot;)
  }
}
</code></pre>

<h1 id="toc_0">3 Kinds of Castings</h1>

<ol>
<li><p>Natural Casting</p>

<p>Used in <strong>up-casting</strong> (i.e. casting from a sub-class instance to a super
class instance)</p>

<pre><code class="language-swift">var a = SubClass()
var b = a as SuperClass
</code></pre></li>

<li><p>Unconditional Casting (or forced casting)</p>

<p>Used in <strong>down-casting</strong> (i.e. the contrary of the above).</p>

<p>When the casting failed, it would incur a panic.</p>

<p>Use it when you are confident about the down-casting.</p></li>

<li><p>Conditional Casting</p>

<p>Used in <strong>down-casting</strong>, but it always returns optionals whether succeed
or fail, that means when not
applicalbe, instead of emitting a panic, it returns nil.</p></li>
</ol>

<p>Conclusion:</p>

<ul>
<li><p>Natural casting is used in <em>always-succeed</em> castings.</p></li>

<li><p>Conditional &amp; Unconditional castings are used in <em>might-fail</em> castings.</p></li>
</ul>

<h1 id="toc_1">2 Operator for Casting</h1>

<ol>
<li><p>The <code>is</code> operator</p></li>

<li><p>The <code>as</code> operators - <code>as</code>, <code>as?</code>, <code>as!</code></p></li>
</ol>

<h1 id="toc_2">Special casting scenarios in practice</h1>

<h2 id="toc_3">Protocol Casting</h2>

<p>In Swift the relationship between a protocol and the classes adopting that
protocol is like the relationship between a super class and its&rsquo; sub-classes.
Hence casting a protocol object, such as the <code>AnyObject</code> to its&rsquo; underlying
class is regarded as a down-casting.</p>

<pre><code class="language-swift">import UIKit // import AppKit

let a: AnyObject = &quot;String&quot;
let b: a as! String
</code></pre>

<p>There are 3 special types: <code>Any</code>, <code>AnyObject</code>, <code>AnyClass</code>.</p>

<p>By tracing the source code, you would find the following:</p>

<pre><code class="language-swift">/// The protocol to which all classes implicitly conform.
///
/// When used as a concrete type, all known `@objc` methods and
/// properties are available, as implicitly-unwrapped-optional methods
/// and properties respectively, on each instance of `AnyObject`.
@objc procotol AnyObject {}

/// The protocol to which all class types implicitly conform.
///
/// When used as a concrete type, all known `@objc` `class` methods and
/// properties are available, as implicitly-unwrapped-optional methods
/// and properties respectively, on each instance of `AnyClass`.
typealias AnyClass = AnyObject.Type

/// The protocol to which all types implicitly conform
typealias Any = protocol&lt;&gt;
</code></pre>

<p>There exists a prerequisite for the rules all above: the <code>Foundation</code> framework
must be imported. (Usually, you import <code>UIKit</code> or <code>AppKit</code>, which implicitly
import <code>Foundation</code> framework). Only then can swift compiler be able to
recognize the <code>@objc</code> keyword, and have Objective-C type bridging ability.</p>

<h2 id="toc_4">Optional AnyObject Collection Casting</h2>

<p>For a optional of Collection of AnyObject that reference objects of the same
class (or super class) T, can be [un]conditionally casted to [T] (without
being wrapped in optional anymore)</p>

<pre><code class="language-swift">import UIKit // import Appkit

// optional array of String.
let a: [AnyObject]? = [&quot;Newyork&quot;, &quot;London&quot;, &quot;Peking&quot;]
let b = a as! [String] // succeed.

// optional array of mixed object that have no common super class.
let a: [AnyObject]? = [&quot;Newyork&quot;, 1983, 3.14, false]
let b = a as! [String] // fail: not all element are of String.

// optinal array of mixed objects that derived from the same super class.
let a: [AnyObject]? = [Subclass(), SuperClass(), SuperClass(), Subclass()]
let b = a as! [Subclass] // succeed: not all element are of String.

// implicitly unwrapped optional dictionary with String typped keys and Int typed values.
let a: [NSObject: AnyObject]! = [&quot;id1&quot;: 32, &quot;id2&quot;: 66]
if let b = a as? [String: Int] {
  println(b)
}
</code></pre>

<p>In the code list above, the String is a structure type in Swift (no a class
type), but it can also be referenced by a <code>AnyObject</code> instance. The rules come
from the following excerpt from &ldquo;Using Swift with Cocoa and Objective-C&rdquo;
official document:</p>

<blockquote>
<p>An object is AnyObject compatible if it is an instance of an Objective-C or
Swift class, or if the object can be bridged to one.</p>
</blockquote>

<p>There exist several swift - Objective-C type bridging depicted as follows:</p>

<p><img src="../../../note/swift_objc_bridging.svg" alt="Siwft - Objective-C Bridging" />
</p>

<p>Hence, back to the code listing above, the Swift type <code>String</code> can be bridged
to NSString <code>Foundation</code> class, then it is <code>AnyObject</code> compatible.</p>

<p>In practice, there exists quit a few occasions that you need to cast optional
collections to type specific Swift collections to utilize their underlying
methods or properties.</p>

<p>For example, when you invoke the Objective-C APIs that return <code>NSArray</code>,
<code>NSDictionary</code>, <code>NSSet</code>, you would get <code>[AnyOject]!</code> <code>[NSObject: AnyOject]!</code>,
<code>[NSObject]!</code> respectively, you could cast [un]conditionally to a more concrete
Swift collection type before you access the individual elements within they.</p>

<p>When you use <code>as!</code> (the unconditional casting), you got an unwrapped collection
in one line of code.</p>

<pre><code class="language-swift">let asset: AVURLAsset = ...
for meta in asset.commonMetadata as! [AVMetadataItem] {
  switch meta.commonKey {
  case AVMetadataCommonKeyTitle:
    item.title = meta.stringValue
  case AVMetadataCommonKeyArtist:
    item.artist = meta.stringValue
  case AVMetadataCommonKeyAlbumName:
    item.albumName = meta.stringValue
  case AVMetadataCommonKeyArtwork:
    switch meta.value {
    case let data as NSData:
      item.artwork = UIImage(data: data)
    case let dict as [NSObject: AnyObject]:
      item.artwork = UIImage(data: dict[&quot;data&quot;] as! NSData)
    default:
      assert(false, &quot;Invalid metadata value type&quot;)
    }
  default:
    break
  }
}
</code></pre>

      </div>
      
      <div class="post">
        <h1 class="post-title">
          <a href="http://mudox.github.io/note/ios_notes_keyboard/">
            iOS NOTES - KEYBOARD
          </a>
        </h1>

        <span class="post-date">Wed, Apr 8, 2015</span>

        

<p>Handle iOS keyboard poppu &amp; resignment gracefully.</p>

<h1 id="toc_0">UIWindow provide 6 keyboard related notifications</h1>

<ul>
<li><p><code>UIKeyboard[Will/Did]ShowNotification</code></p></li>

<li><p><code>UIKeyboard[Will/Did]HideNotification</code></p></li>

<li><p><code>UIKeyboard[Will/Did]ChangeFrameNotification</code></p></li>
</ul>

<p>After playing with these notifications above, I found:</p>

<ol>
<li><p>When you want to move obscured contents or views to above the keyboard, put
the frame adjustment code in *<strong>Will</strong>* notifications, because the handler
methods seems to be invoked within the same animation block that provides
the keyboard revealing animation.</p></li>

<li><p>If you are only interested in tracing keyboard&rsquo;s frame (more specifically the
height) during keyboard&rsquo;s presence, monitoring
<code>UIKeyboardWillShowNotification</code> seems enough, no need to monitoring
<code>UIKboardWillChangeFrameNotification</code> additionally.</p></li>

<li><p>The frame size stored in <code>UIKeyboardFrameBeginUserInfoKey</code> and
<code>UIKeyboardFrameEndUserInfoKey</code> keys will only differ after keyboard is
first shown and before it is hidden. When the keyboard is first shown or is
resigned, the <code>Begin</code> or <code>End</code> frame is equal.</p></li>
</ol>

<h1 id="toc_1">Strategies for move contents above the keyboard:</h1>

<h2 id="toc_2">For contents embedded in <code>UISCrollView</code>s</h2>

<p>Way #1 &ndash; Adjust the bottom edge inset value of the containing scroll view&rsquo;s
contentsInset property and scroll active view into visible area using
<code>scrollRectToVisible: animated:</code> method.</p>

<p>Way #2 &ndash; Adjust containing scroll view&rsquo;s contentSize &amp; contentOffset
properties.</p>

<p>No matter which way above you choose, remember to adjust
<code>scrollIndicatorInsets</code>&rsquo;s bottom edge inset value to make the indicator fully
un-obscured from the keyboard.</p>

<h2 id="toc_3">For contents outside any <code>UIScrollView</code></h2>

<p>Recalculate and set its&rsquo; frame.origin.y value in
<code>UIKeyboardWillShowNotification</code> handler method, and the movement will be
animated along with the revealing of keyboard perfectly.</p>

<pre><code class="language-swift">func handleKeyboardNotification(notify: NSNotification) {
  let value = notify.userInfo?[UIKeyboardFrameEndUserInfoKey] as NSValue
  let keyboardHeight = value.CGRectValue().height

  switch notify.name {

  case UIKeyboardWillShowNotification:
    theViewToMove.frame.origin.y = self.view.bounds.height - keyboardHeight - theViewToMoveMargin - theViewToMove.bounds.height
    theScrollViewToAdjust.contentInset.bottom = keyboardHeight
    itemsTable.scrollIndicatorInsets.bottom = keyboardHeight

  case UIKeyboardWillHideNotification:
    theViewToMove.frame.origin.y = self.view.bounds.height - theViewToMoveMargin - theViewToMove.bounds.height
    theScrollViewToAdjust.contentInset.bottom = 0.0
    itemsTable.scrollIndicatorInsets.bottom = 0.0 // the default value

  default:
    assert(false)
  }
}
</code></pre>

<h1 id="toc_4">References:</h1>

<ul>
<li><p><a href="https://developer.apple.com/library/ios/documentation/StringsTextFonts/Conceptual/TextAndWebiPhoneOS/KeyboardManagement/KeyboardManagement.html#//apple_ref/doc/uid/TP40009542-CH5-SW7">Moving Contents That is Located Under the Keyboard in Text Programming Guide for iOS</a></p></li>

<li><p><a href="https://developer.apple.com/library/ios/documentation/UIKit/Reference/UIWindow_Class/">UIWindow Class Reference</a></p></li>
</ul>

      </div>
      
      <div class="post">
        <h1 class="post-title">
          <a href="http://mudox.github.io/memo/engligh_vocabulary_confusion/">
            ENGLISH VOCABULARY - CONFUSION GROUPS
          </a>
        </h1>

        <span class="post-date">Sun, Mar 29, 2015</span>

        <p>Words groups I collected when expand my vocabulary.</p>

<p>Will expand it day by day!</p>

<blockquote>
<p>Hew out of the mountain of despair a stone of hope and you can make you life
a splendid one!</p>
</blockquote>

<hr />

<p>amnesia<br />
anemia (anaemia), anaemic<br />
anorexia</p>

<hr />

<p>similar, similarity<br />
simulate, dissimulate ( = dissemble ), imitate, emulate<br />
assimilation &lt;-&gt; dissimilation != dissemination<br />
stipulate<br />
stimulate, stimulus, stimulant<br />
imitate<br />
intimate<br />
intimidate == browbeat, bluster, cow, intimidating == intimidatory, intimidator, intimidation</p>

<hr />

<p>analgesic, analgesia<br />
anesthetic, anesthesia<br />
anaesthetic, anaesthesia<br />
antibiotic<br />
antibody<br />
antidote<br />
antiseptic, aseptic</p>

<hr />

<p>absurd<br />
abuse, disabuse<br />
amuse, amusing, amusement<br />
accuse, accusation<br />
accuser &lt;&ndash;&gt; defendant, accused</p>

<hr />

<p>agile, agility<br />
fragile, fragility, crisp, brittle, delicate</p>

<hr />

<p>anaerobe, anaerobic<br />
anhydrous, dehydrate<br />
anorexia</p>

<hr />

<p>affable<br />
amiable, amity<br />
amicable</p>

<hr />

<p>acuity<br />
acumen</p>

<hr />

<p>accumulate, accumulation<br />
cumulate, cumulus<br />
curdle, coagulate, congeal, clot, gel<br />
commutative</p>

<hr />

<p>antipathy<br />
animus, animosity<br />
abominate, abomination<br />
averse, aversion</p>

<hr />

<p>abrogate<br />
abnegate<br />
abstain<br />
abolish<br />
annul<br />
renounce</p>

<hr />

<p>absolve, absolution<br />
amnesty<br />
acquittal</p>

<hr />

<p>allege, allegory, allegation<br />
arrogate<br />
aphorism</p>

<hr />

<p>annex, annexation<br />
adjunct<br />
addendum<br />
accessory (or, accessary)</p>

<hr />

<p>necessary, necessitous<br />
accessory<br />
accessibility</p>

<hr />

<p>apex<br />
acme != acne<br />
crest<br />
cusp<br />
climax, anticlimax<br />
peak</p>

<hr />

<p>alloy<br />
alley<br />
allay<br />
ally, alliance</p>

<hr />

<p>vow<br />
avow<br />
vowel<br />
bowel</p>

<hr />

<p>aver<br />
averse, aversion<br />
avert<br />
adverse, adversity<br />
advertise, advertisement</p>

<hr />

<p>averse<br />
animus, animosity<br />
hostility, hostile &lt;&ndash;&gt; hospitality, hospitable<br />
antagonism, antagonise, antagonist</p>

<hr />

<p>artery, aorta<br />
vein<br />
vessel<br />
vascular<br />
corpuscle<br />
anemia</p>

<hr />

<p>throat<br />
lung<br />
liver<br />
gallbladder &ndash;&gt; bile (or, choler, gall)<br />
stomach<br />
bowel, intestine, small, intestine, large, intestine<br />
bladder<br />
anus</p>

<hr />

<p>appear, appearance<br />
appeal, appealing<br />
apparent, apparel<br />
appease, appeasing, appeasement</p>

<hr />

<p>consider, considerable, considerate<br />
appreciate, appreciable<br />
appropriate, appropriateness, appropriation</p>

<hr />

<p>condiment<br />
salt, pepper, vinegar, sugar</p>

<hr />

<p>bounteous, courteous<br />
courtesy, courteous</p>

<hr />

<p>demo<br />
democrat, democracy, demotic != demonic<br />
demagogue<br />
demolish, demolishment</p>

<hr />

<p>coral<br />
corral<br />
carol<br />
cameo</p>

<hr />

<p>asthma<br />
anthem, carol<br />
chrysanthemum<br />
chrysalis<br />
talisman</p>

<hr />

<p>chasm<br />
canyon<br />
canny</p>

<hr />

<p>precious<br />
appreciate<br />
appreciable, inappreciable<br />
depreciate</p>

<hr />

<p>contrite, contrition<br />
chondrite</p>

<hr />

<p>canoe<br />
clue<br />
cliff</p>

<hr />

<p>boisterous<br />
cloister</p>

<hr />

<p>comely<br />
comet<br />
comedy<br />
comity<br />
comic</p>

<hr />

<p>atherosclerosis<br />
arteriosclerosis</p>

<hr />

<p>contentious<br />
argumentative</p>

<hr />

<p>deforestation<br />
conflagration</p>

<hr />

<p>covenant<br />
conversant<br />
countenance</p>

<hr />

<p>allege, allegation<br />
arrogate, arrogation<br />
arrogant, arrogance<br />
abrogate<br />
derogate, derogatory, derogative<br />
surrogate</p>

<hr />

<p>axle<br />
axis<br />
axe<br />
axiom, axiomatic<br />
aphorism, aphorize<br />
pith, pithy</p>

      </div>
      
      <div class="post">
        <h1 class="post-title">
          <a href="http://mudox.github.io/memo/error_collection_ios/">
            ERROR COLLECTION - IOS
          </a>
        </h1>

        <span class="post-date">Sat, Feb 7, 2015</span>

        <p>Errors that I collected day by day, when developing iOS apps.</p>

<ul>
<li><p>Specifying an invalid frame size (i.e. 0 width or 0 height), can make
UIView&rsquo;s such as UISlider unresponsive to user interaction.</p></li>

<li><p>Always wrap multiple statements following a <code>switch case:</code> in a curly brace,
where we can even put a variable declaration in it.</p></li>

<li><p>Should <strong>NOT</strong> assgin one instance of <code>UIImage</code> to multiple
<code>UITextField.leftView</code> or <code>UITextField.rightView</code> properties.</p></li>

<li><p>UIImageView, by defaults, is <strong>NOT</strong> userInteractionEnabled, hence sub views
under them may not receive touch events.</p></li>

<li><p>When creating outlets for UILabel views, <strong>DO NOT</strong> name the property
&ldquo;title&rdquo;, cause the super class of your view controller <code>UIViewController</code>
itself has a property &lsquo;title&rsquo;, it will incur exception at runtime time.</p></li>

<li><p>Remember to clean dead connnection recorded by storyboards for controls &amp;
views in interface builder window.</p></li>

<li><p>Dragging an element with <Atl> key pressed, will copy it&rsquo;s attributes as well as
it&rsquo;s connections and other info set in the interface builder and uitility
panes.</p></li>

<li><p>When presenting a view controller from a content view controller embeded in a
<strong>navigation view controller</strong>, it is the navigation view controller, rather
than the embeded content view controller, which is <strong>presenting</strong> the view
controller, while the replaced view controller is called the <strong>source</strong> view
controller.</p></li>

<li><p>When customizing table view cells, <strong>DOT NOT</strong> use <code>UIButton</code> to cover the cell for
triggering the segue, which would bring a function redundant and thus
complicates things.</p></li>

<li><p><strong>DO NOT</strong> auto-layout a subview within a auto-layout&rsquo;ed <code>UIScrollView</code> when
you plan to perform zooming operation in it.</p></li>

<li><p>After getting a reused cell, make sure all its&rsquo; states get reset to the current
value or the default value, otherwise the remained states set by last usage
would mess your up.</p></li>

<li><p>setting <code>clipsToBounds</code> to true will clips layer shadow off.</p></li>
</ul>

      </div>
      
      <div class="post">
        <h1 class="post-title">
          <a href="http://mudox.github.io/memo/setup_my_archlinux_environment/">
            SETUP MY ARCH LINUX ENVIRONMENT
          </a>
        </h1>

        <span class="post-date">Sat, Nov 8, 2014</span>

        

<p>The marathon of installing &amp; tunning the Arch Linux to my flavor.</p>

<h1 id="toc_0">SUMMARY</h1>

<p><a href="https://wiki.archlinux.org">Arch Linux</a> + <a href="http://awesome.naquadah.org">Awesome WM</a> + <a href="http://invisible-island.net/xterm/">xterm</a>, that is the
main skeleton of my system.</p>

<p>I settled on this combination under the rule:</p>

<ul>
<li><p>minimalistic environment, no huge DEs like GNOME, KDE or the likes.</p></li>

<li><p>fast revolution, always surfing in the front, since it is for personal use,
why not &hellip;</p></li>
</ul>

<p>I choose <a href="http://www.freedesktop.org/wiki/Software/LightDM/">LightDM</a>, because it</p>

<ol>
<li><p>is developed <strong>independent</strong> of other DEs, hence I don&rsquo;t have to be forced to
install a bunch of GNOME or KDE dependency packages to only for making it
run.</p></li>

<li><p>is <strong>lightweight</strong>. Very small package size, therefore starts up pretty fast, as
I can see.</p></li>

<li><p>has many front ends (a.k.a. <em>greeters</em>) due to it cross-desktop feature.</p></li>
</ol>

<p>Among various <a href="https://wiki.archlinux.org/index.php/lightdm#Greeter">greeters</a>, I currently use <code>lightdm-gtk3-greeter</code>. It
has a simplistic and neat login screen, just the necessary elements I need.</p>

<h1 id="toc_1">THE WINDOW MANAGER &ndash; AWESOME WM</h1>

<p>I have tried two ways of starting Awesome WM during system boot.</p>

<p>The first way, is using a <em>display manager</em>, which will presents you a login
screen, where you enter your user ID &amp; password. After authentication, it
will start the Awesome WM for you.</p>

<p>The second way is to use <code>xinit</code> (and it&rsquo;s front-end script <code>startx</code>). When
display manager is absent in the startup process, system will bring you to one
of the tty consoles, which is just a simplistic command line interface, then
you type <code>startx</code> manually, which then, according the configuration in
<code>~/.xinitrc</code>, do some initial setting work and finally start the Awesome WM and
transfer control to it.</p>

<p>Of the 2 ways I&rsquo;ve tried, I prefer the first one &ndash; using a display
manager. Because the display manager:</p>

<ul>
<li><p>the installation &amp; configuration process is relatively simpler than the
<em>xinit</em> way.</p></li>

<li><p>startup dependent services (e.g. audio, network etc.) in correct order
thanks to <code>systemd</code>&rsquo;s dependency management.</p></li>

<li><p>fully utilize the <code>systemd</code>&rsquo;s concurrency startup feature, making the whole
startup process pretty faster than the <em>xinit</em> way.</p></li>

<li><p>run fast, there is no need to login to tty console, and type &hellip;, which as
I&rsquo;ve seen, took more time to initiates.</p></li>
</ul>

<h2 id="toc_2">With display manager</h2>

<h3 id="toc_3">Installing LightDM</h3>

<p>First, install <code>LightDM</code> &amp; <code>lightdm-gtk3-greeter</code> from official repository. An
extra advantage of choosing <code>lightdm-gtk3-greeter</code> is that you do not need to
modify the <code>/etc/lightdm/lightdm.conf</code> to let the <code>LightDM</code> back-end use it. It
is the reference (default) greeter.</p>

<p>Then register <code>LightDM</code> to <code>systemd</code>, making it get started on boot
automatically.</p>

<pre><code class="language-bash">sudo pacman -S lightdm, lightdm-gtk3-greeter

sudo systemctl enable lightdm.service
</code></pre>

<h3 id="toc_4">Configuring LightDM</h3>

<h2 id="toc_5">Without display manager</h2>

<p>Without display manager, you should first login into the <code>tty1</code>, then type
<code>startx</code> to start the <em>Awesome WM</em>.</p>

<p>Through some configuration, the 2 steps mentioned above can be automated:</p>

<h3 id="toc_6">Step 1 &ndash; automatic login to virtual console</h3>

<p>create the following file and its&rsquo; parent directory if not exists.</p>

<pre><code class="language-conf"># /etc/systemd/system/getty@tty1.service.d/autologin
------------------------------------------------------------------------------
[Service]
ExecStart=
ExecStart=-/usr/bin/agetty --autologin mudox --noclear %I 38400 linux
Type=idle
</code></pre>

<h3 id="toc_7">Step 2 &ndash; start X at login</h3>

<p>First install the <code>xorg-xinit</code> package from the Arch Linux official
repository, which provides the <code>xinit</code> command &amp; its&rsquo; front end &ndash; the <code>startx</code>
script, besides, it also put a template <em>xinitrc</em> file under <code>/etc/skel/</code>
directory.</p>

<p>Then, base on <code>/etc/skel/.xinitrc</code>, create <code>~/.xinitrc</code> as follows:</p>

<pre><code class="language-bash">#!/bin/sh
#
# ~/.xinitrc
#
# Executed by startx (run your window manager from here)

if [ -d /etc/X11/xinit/xinitrc.d ]; then
  for f in /etc/X11/xinit/xinitrc.d/*; do
    [ -x &quot;$f&quot; ] &amp;&amp; . &quot;$f&quot;
  done
  unset f
fi

xrdb -merge ~/.Xresources # if you have ever created it.

# exec gnome-session
# exec startkde
# exec startxfce4

exec awesome # make sure it's on the last line
</code></pre>

<p>Finally, add the following code into you shell login script, such as <em>.profile</em>
for bash and <em>.zlogin</em> for zsh.</p>

<pre><code class="language-bash"># ~/.zlogin
------------------------------------------------------------------------------
[[ -z $DISPLAY &amp;&amp; $XDG_VTNR -eq 1 ]] &amp;&amp; exec startx
</code></pre>

<p>references:</p>

<ul>
<li><p><a href="https://wiki.archlinux.org/index.php/Automatic_login_to_virtual_console">Automatic login to virtual console from
ArchWiki</a></p></li>

<li><p><a href="https://wiki.archlinux.org/index.php/Start_X_at_login">Start X at login from ArchWiki</a></p></li>

<li><p><a href="https://wiki.archlinux.org/index.php/Xinitrc">xinitrc form ArchWiki</a></p></li>
</ul>

<h1 id="toc_8">MOUSE ACCELERATION</h1>

<p>Type <code>xset q | grep Pointer</code> to see current mouse acceleration setting.</p>

<p>Try <code>xset m &lt;acceleration&gt; &lt;threshold&gt;</code> with different values to find the best
combination for your feeling.</p>

<blockquote>
<p>where acceleration defines how many times faster the cursor will move than
the default speed. threshold is the velocity required for acceleration to
become effective, usually measured in device units per 10ms. acceleration can
be a fraction, so if you want to slow down the mouse you can use <sup>1</sup>&frasl;<sub>2</sub>, <sup>1</sup>&frasl;<sub>3</sub>,
<sup>1</sup>&frasl;<sub>4</sub>, &hellip; if you want to make it faster you can use <sup>2</sup>&frasl;<sub>1</sub>, <sup>3</sup>&frasl;<sub>1</sub>, <sup>4</sup>&frasl;<sub>1</sub>, &hellip;</p>

<p>Threshold defines the point at which acceleration should occur in pixels per
10 ms.</p>
</blockquote>

<p>I found my lucky combiantion is <code>1/4 8</code> and I add the setting command into
<em>rc.lua</em> of <a href="http://awesome.naquadah.org">Awesome WM</a> to apply the setting on each startup.</p>

<p>references:</p>

<ul>
<li><a href="https://wiki.archlinux.org/index.php/Mouse_acceleration">Mouse acceleration from ArchWiki</a></li>
</ul>

<h1 id="toc_9">INPUT METHOD</h1>

<p>The <strong>ibus + isbus-rime</strong> combinations works nicely on my Arch Linux.</p>

<p>After ibus gets installed, run <code>ibus-setup</code>, it will show a setting guide
window where you can adjust ibus settings to adapt to <a href="awesome">Awesome WM</a>
environment.</p>

<ul>
<li><p>I prefer to change the keyboard shortcut of switching to next input method to
<code>&lt;Atl&gt;&lt;Shift&gt;space</code></p></li>

<li><p>Check off the <em>Embed preedit text in application window</em> option, because I
found it does not run properly in some applications (e.g. Vim).</p></li>
</ul>

<p>On  environments, ibus-daemon can not be loaded automatically on
startup, so we need to manually run it. There are many ways to auto-start
applications on linux platform, I choose to let <a href="awesome">Awesome WM</a> to start it by adding
auto-start code in <em>rc.lua</em>.</p>

<p>For ibus-rime, it is in tranditional chinese mode by default. To switch to
simplified chinese mode, press <code>Ctrl-~</code> when ibus-rime is active to open setup
candiate menu and choose <em>朙月拼音-简化字</em></p>

<pre><code class="language-bash">sudo pacman -S ibus ibus-qt ibus-rime

ibus-setup

# manually start ibus daemon for this session.
# this command has been added in my Awesome config file 'rc.lua' to auto-start
# it in the beginning of each Awesome session.
ibus-daemon -drx
</code></pre>

<p>references:</p>

<ul>
<li><a href="https://wiki.archlinux.org/index.php/Ibus">IBus from ArchWiki</a></li>
</ul>

<h1 id="toc_10">WINDOW MANAGER</h1>

<p>On Linux platforms, I prefer WMs to DEs.</p>

<p>The <a href="http://awesome.naquadah.org">Awesome WM</a> is my favorite window manager.</p>

<p>see <a href="/memo/setup_my_aweseome_wm_environment/">SETUP MY AWESOME WM ENVIRONMENT</a>
for details.</p>

<h1 id="toc_11">SHELL ENVIRONMENT</h1>

<p>I have used several terminal emulators (gnome-terminal, xvrt &hellip;), and finally
I settled myself on <strong>xterm</strong>, which I feel it:</p>

<ul>
<li><p>consume the smallest resource among other terminal emulators.</p></li>

<li><p>starts up very fast.</p></li>

<li><p>is much more robust.</p></li>

<li><p>is the standard shell for the X Window System, which bring a great
compatiblity.</p></li>
</ul>

<p>As to shells, I become a <strong>zsh</strong> fan soon after played with it as well as
bash &amp; fish shells. the reason is obvious:</p>

<ul>
<li><p>it is powerfull than bash, whose syntax is completely covered by zsh.</p></li>

<li><p>it provides more flexibility in configuration than fish shell.</p></li>

<li><p>there already exist quite a many user contributed resources on the net, e.g:</p>

<ul>
<li><p><a href="https://github.com/robbyrussell/oh-my-zsh">on-my-zsh</a>.</p></li>

<li><p><a href="https://github.com/zsh-users/antigen">antigen</a> plugin manager.</p></li>
</ul></li>
</ul>

<h2 id="toc_12">Pull down dot-files repo</h2>

<p>My configuration resource related to termianl emulator &amp; shells are managed in
a github repo &ndash; <a href="https://github.com/Mudox/dot-files.git">dot-files</a>.</p>

<pre><code class="language-bash">cd ~/Git # ~/Git is the place I assemble most of my github repos.
git clone https://github.com/Mudox/dot-files.git
</code></pre>

<h2 id="toc_13">Setup xterm</h2>

<p>First, install xterm from Arch Linux&rsquo;s official repository.</p>

<p>Then, link out the .Xresources file from my <a href="https://github.com/Mudox/dot-files.git">dot-files</a> repo. It is
the configuration file that hold my xterm settings (colors, cursors, fonts
etc.) among other x utility setttings.</p>

<pre><code class="language-bash">sudo pacman -S xterm
cd ~
ln -sf Git/dot-files/Xresources .Xresources
</code></pre>

<h2 id="toc_14">Setup zsh</h2>

<p>see <a href="/memo/setup_my_zsh_environment/">SETUP MY ZSH ENVIRONMENTS</a> for details.</p>

<h1 id="toc_15">SETUP VIRTUALBOX</h1>

<h2 id="toc_16">Installing Virtualbox</h2>

<p>First, from the official repository, install <code>virtualbox</code> package, which comes
with <code>virtualbox-host-modules</code>.</p>

<p>Then we need to add the basic <strong>vboxdrv</strong> kernel module to host kernel.</p>

<p>Finally, add my user name to the <strong>vboxusers</strong> group in order to use USB port in
virtual machines.</p>

<pre><code class="language-bash">sudo pacman -S virtualbox

# manually add vboxdrv to host kernel for one time.
sudo modeprobe vboxdrv

# auto-load vboxdrv on every system startup.
sudo echo 'vboxdrv' &gt; /etc/modules-load.d/virtualbox.conf

# add user name in vboxusers group to use USB ports in vitual machines.
sudo gpasswd -a &quot;${USER}&quot; vboxusers
</code></pre>

<h2 id="toc_17">Configuring Virtualbox</h2>

<ol>
<li><p>Set <em>Host Key Combination</em> to <code>right &lt;winkey&gt;</code> which is consistent with
<a href="awesome">Awesome WM</a>&rsquo;s keyboads shortcuts, it&rsquo;s in
<em>File-&gt;Preference-&gt;Input-&gt;Virtual Machine</em> of <em>Oracle VM VitualBox Manager</em>
window.</p></li>

<li><p>Enalbe <em>Bidiretional clipboard</em>, it&rsquo;s in <em>Devices-&gt;Shared
Clipboard-&gt;Bidirectional</em> of virtual machine window.</p></li>
</ol>

<p>references:</p>

<ul>
<li><p><a href="https://wiki.archlinux.org/index.php/Virtualbox">Virtualbox from ArchWiki</a></p></li>

<li><p><a href="https://wiki.archlinux.org/index.php/Kernel_modules">kernel_modules from ArchWiki</a></p></li>
</ul>

<h1 id="toc_18">VPN</h1>

<h2 id="toc_19">Setup pptpclient</h2>

<ol>
<li><p>install pptpclient from the official repository of Arch Linux.</p></li>

<li><p>use <code>pptpsetup</code> command to register my VPN account, which is just a helper
script that will create a readable text file <code>/etc/ppp/peers/&lt;tunnel_name&gt;</code>
where you can change the server address manaually using whatever text editor
you like. collect the following information in advance:</p>

<ul>
<li><p>VPN server&rsquo;s <strong>ip address</strong> from your VPN provider.</p></li>

<li><p><strong>user name</strong> of your VPN account.</p></li>

<li><p><strong>user password</strong> of your VPN account.</p></li>
</ul></li>

<li><p>install <code>ppp-mppe</code> (i.e. Microsoft Pointer-to-Pointer Encryption), if the
<code>pptpsetup</code> command complains about <em>MPPE</em> module things.</p></li>

<li><p>test configuration</p>

<ul>
<li><p>use <code>pon &lt;tunnel_name&gt; debug dump logfd 2 nodetach</code> to test the
configuration. If everything has been configured correctly, the command
should not terminate. <code>Ctrl-C</code> to quit it.</p></li>

<li><p>type <code>ip addr show</code>, and you will see a new device <strong>ppp0</strong> is listed in.</p></li>
</ul></li>

<li><p>connect VPN using <code>sudo pon &lt;tunnel_name&gt;</code>, <code>sudo poff &lt;tunnel_name&gt;</code> to
tear down.</p></li>
</ol>

<pre><code class="language-bash"># install pptpclient
sudo pacman -S pptpclient

# add you VPN account (i.e. create a new tunnel)
sudo pptpsetup \
  --create &lt;tunnel_name_whatever_you_like&gt; \
  --server &lt;your_VPN_server_ip_address&gt; \
  --username &lt;username_of_you_VPN_account&gt; \
  --password &lt;password_of_you_VPN_account&gt; \
  --encrypt

# install ppp-mppe, if the command above complains about lacking of `MPPE`
# module things. rerun `pptpsetup` command above after installing it.
sudo pacman -S ppp-mppe

# test 1, the command should not terminate if everything is okay.
sudo pon &lt;tunnel_name_above&gt; debug dump logfd 2 nodetach

# test 2, you would see `ppp0` listed in the output.
ip addr show

# finally, connect!
sudo pon &lt;tunnel_name&gt;
</code></pre>

<h2 id="toc_20">Route all traffic through VPN connection</h2>

<h3 id="toc_21">Manually</h3>

<p>Use the powerfull <code>ip</code> command to add a route rule into route table.</p>

<pre><code class="language-bash"># make all packages go through interface ppp0
ip route add default dev ppp0
</code></pre>

<p>This route rule is only effective during this ppp session. after your tear down
the VPN connection by <code>sudo pon &lt;tunnel_name&gt;</code>, it will vanish.</p>

<h3 id="toc_22">Automatically</h3>

<p>Every executable scripts under /etc/ppp/ip-up.d/ will be called when a VPN
connection startup. Hence, we can use it to automatically set route rules.</p>

<pre><code class="language-bash"># /etc/ppp/ip-up.d/01-routes.sh
# ----------------------------------------
#!/bin/bash

# This script is called with the following arguments:
# Arg Name
# $1 Interface name
# $2 The tty
# $3 The link speed
# $4 Local IP number
# $5 Peer IP number
# $6 Optional ``ipparam'' value foo

ip route add default via $4
</code></pre>

<pre><code class="language-bash">cd /etc/ppp/ip-up.d
echo 'ip route add default via $4' &gt; 01-routes.sh

# the script file need to have `x` permission to be run.
# it's stdin &amp; stderr will be redirected off terminal, so not output will
# be shown when run.
co
sudo chmod +x /etc/ppp/ip-up.d/01-routes.sh
</code></pre>

<h2 id="toc_23">Modify DNS server list</h2>

<p>If you found you still can not access some site (e.g. youtube, twitter, etc.)
after establishing the VPN connection, then you should insert <code>servername
8.8.8.8</code> ahead of existing lines in <em>/etc/resolve.conf</em>.</p>

<pre><code class="language-bash"># /etc/resolve.conf
# ----------------------------------------
nameserver 8.8.8.8
nameserver 192.168.0.1
</code></pre>

<h3 id="toc_24">My hacky way</h3>

<p>I wrote a script to get around of this:</p>

<pre><code class="language-bash"># ~/.bin/vpn.sh
# ----------------------------------------
#!/bin/sh

tunnel=&quot;your configured tunnel name&quot;

if [ &quot;$#&quot; -ne 1 ]; then
  echo &quot;usage: $0 [on|off]&quot;
  exit 1
fi

case &quot;$1&quot; in
  on )
    # connect
    pon ${tunnel} || exit 1

    # here we just overwrite the /etc/resolv.conf by `echo`ing the hard
    # written DNS list to it.
    printf &quot;nameserver 8.8.8.8\nnameserver 192.168.0.1&quot; &gt; /etc/resolv.conf || exit 1
    ;;
  off )
    # disconnect
    poff ${tunnel}

    # some as above, we just `echo` back.
    echo 'nameserver 192.168.0.1' &gt; /etc/resolv.conf || exit 1
    ;;
  * )
    echo &quot;usage: $0 [on|off]&quot;
    ;;
esac

unset tunnel
</code></pre>

<p>in your .bashrc or .zshrc file:</p>

<pre><code class="language-bash">alias vpon='sudo ~/.bin/vpn.sh on'
alias vpoff='sudo ~/.bin/vpn.sh off'
</code></pre>

<p>then, you can type <code>vpon</code> to turn on the VPN, and <code>vpoff</code> to shutdown.</p>

<p>references:</p>

<ul>
<li><a href="https://wiki.archlinux.org/index.php/PPTP_VPN_client_setup_with_pptpclient">PPTP VPN client setup with pptpclient</a></li>
</ul>

      </div>
      
      <div class="post">
        <h1 class="post-title">
          <a href="http://mudox.github.io/memo/setup_my_vim_environment/">
            SETUP MY VIM ENVIRONMENT
          </a>
        </h1>

        <span class="post-date">Sat, Nov 8, 2014</span>

        

<p>It is the Vim that bring we into the marvelous OSS world. Fiddling with it is
full of surprise and happy.</p>

<p>Below records my steps of setting up my Vim environment after every system
re-installation.</p>

<h1 id="toc_0">Installing Vim</h1>

<p>my vim config have be tested on:</p>

<ul>
<li><p>Windows XP and above.</p></li>

<li><p>Mac OSX 10.9 and above using <a href="https://github.com/b4winckler/macvim">MacVim</a>.</p></li>

<li><p>Arch Linux.</p></li>
</ul>

<p><strong>NOTE</strong>: currently I prefer to GUI version than terminal version, hence most
of my configurations are tailored to GUI environments.</p>

<h1 id="toc_1">Setup My Vim-Config Repo</h1>

<p>First pull down my <a href="https://github.com/Mudox/vim-config">vim-config</a> repo from github.</p>

<p>Then create a directory named <em>neobundle</em> under the pulled down repo, which
will holds almost all vim plugins that will be synced by <a href="https://github.com/Shougo/neobundle.vim">neobundle</a>
later.</p>

<p>Create the initial <em>cur_mode</em> file under <em>.vim/chameleon/</em>, which always stores
the chameleon mode of next vim session.</p>

<pre><code class="language-bash"># On Widnows, Must Be Put In C:/Documents And Settings/&lt;User Name&gt;/Vimfiles
git clone https://github.com/Mudox/vim-config.git ~/.vim

cd .vim
mkdir neobundle

cd chameleon
echo 'all' &gt; cur_mode
</code></pre>

<h1 id="toc_2">Install Prerequisites Vim Plugins</h1>

<h2 id="toc_3">Install <a href="https://github.com/Mudox/vim-chameleon">vim-chameleon</a></h2>

<p><a href="https://github.com/Mudox/vim-chameleon">vim-chameleon</a> is my own plugin for managing massive and ever
growing vim &amp; vim plugin configurations.</p>

<pre><code class="language-bash">cd ~/.vim/neobundle
# NOTE: The Renaming Is Important
git clone https://github.com/Mudox/vim-chameleon chameleon
</code></pre>

<h2 id="toc_4">Install <a href="https://github.com/Shougo/neobundle.vim">neobundle</a>.</h2>

<p><a href="https://github.com/Shougo/neobundle.vim">neobundle</a> is a sophisticated vim plugin manager that I have been
using for a long time.</p>

<pre><code class="language-bash">cd ~/.vim/neobundle
# NOTE: The Renaming Is Important
git clone https://github.com/Shougo/neobundle.vim neobundle
</code></pre>

<h2 id="toc_5">Install &amp; compile <a href="https://github.com/Shougo/vimproc.vim">vimproc</a>.</h2>

<p><a href="https://github.com/Shougo/vimproc.vim">vimproc</a> is another plugin written by <a href="https://github.com/Shougo">Shougo</a> that is very
useful, and is required by <a href="https://github.com/Shougo/neobundle.vim">neobundle</a>. The point is that you need to
compile it to get a dynamic library after pulling down its&rsquo; repo.</p>

<pre><code class="language-bash">cd ~/.vim/neobundle
# NOTE: The Renaming Is Important
git clone https://github.com/Shougo/vimproc.vim vimproc

cd vimproc
make # see vimproc/README.md for compilation commands for various platforms.
</code></pre>

<h2 id="toc_6">Run vim to see all other 140+ plugins get installed.</h2>

<p>You can run vim in terminals or open gVim. Better run vim in terminal to watch
the plugins installing progress and spot any errors clearly.</p>

<h1 id="toc_7">Vim Environment For Specific Use Case</h1>

<h2 id="toc_8">Web Developing</h2>

<p>Node.js (and NPM which comes with it) is the essentials of everything below.</p>

<h3 id="toc_9">HTML</h3>

<h3 id="toc_10">JavaScript</h3>

<p>I use:</p>

<ul>
<li><p><a href="https://github.com/jshint/jshint">jshint</a> &amp;
<a href="https://github.com/eslint/eslint">eshint</a> &amp;
<a href="https://github.com/douglascrockford/JSLint.git">jslint</a> for <a href="https://github.com/scrooloose/syntastic">syntastic</a>
checkers.</p></li>

<li><p><a href="https://github.com/beautify-web/js-beautify">js-beautify</a> to prettify
JavaScript code.</p></li>
</ul>

<pre><code class="language-bash">npm install jshint -g
npm install jslint -g
npm install eslint -g
npm install js-beautify -g
</code></pre>

<h3 id="toc_11">CSS</h3>

<p>I use:</p>

<ul>
<li><p><a href="https://github.com/CSSLint/csslint">csslint</a> for <a href="https://github.com/scrooloose/syntastic">syntastic</a> checkers.</p></li>

<li><p><a href="https://github.com/csscomb/csscomb.js">csscomb.js</a> for CSS code prettifier.</p></li>
</ul>

<pre><code class="language-bash">npm intall csslint -g
npm install csscomb -g
</code></pre>

<h2 id="toc_12">Python Scripting</h2>

<h2 id="toc_13">Lua Scripting</h2>

<h2 id="toc_14">Go Scripting</h2>

<h2 id="toc_15">C/C++ Coding</h2>

      </div>
      
      <div class="post">
        <h1 class="post-title">
          <a href="http://mudox.github.io/memo/error_collection_bash/">
            ERROR COLLECTION - BASH
          </a>
        </h1>

        <span class="post-date">Fri, Nov 7, 2014</span>

        <p>Errors that I collected day by day, when writing the Bash scripting language.</p>

<ul>
<li>Body of <code>select</code> constructs need a <code>break;</code> to quit the selection loop.</li>
</ul>

<pre><code class="language-bash">select answer in #choices#; do
  #body#
  break; # &lt;- go out of selection loop.
done
</code></pre>

<ul>
<li><p>Always <code>source</code> before testing a updated command.</p></li>

<li><p>Whence quoted with <code>&quot;</code>, which is the most case, use the <code>@</code> form (i.e.
<code>&quot;${ARRAY[@]}&quot;</code>) to expand a array correctly. The <code>*</code> form will make the
expanded string as a <strong>single word</strong>.</p></li>

<li><p>The <code>local path</code> is the source of all evil. It will shaddow the global <code>path</code>
where binary search paths is hold in zsh.</p></li>

<li><p>No need to <code>&quot;</code> quote variable that expand to a number in <code>$(( ))</code>, which need
a real number.</p></li>
</ul>

<pre><code class="language-bash">index=$(( RANDOM % &quot;${#array[@]}&quot; )) # no need to double quote '${array[@]}' here
</code></pre>

      </div>
      
      <div class="post">
        <h1 class="post-title">
          <a href="http://mudox.github.io/memo/error_collection_javascript/">
            ERROR COLLECTION - JAVASCRIPT
          </a>
        </h1>

        <span class="post-date">Fri, Nov 7, 2014</span>

        <p>Errors that I collected day by day when writing the JavaScript language.</p>

<ul>
<li>when assign a function to a event property, dot not appending <code>()</code> to the function name.</li>
</ul>

<pre><code class="language-javascript">window.onload = init/*()*/

function init() {
  // ...
}
</code></pre>

<ul>
<li>appending <code>()</code> to a property name.</li>
</ul>

<pre><code class="language-javascript">var x = Math.floor(Math.random() * canvas.width/*()*/
</code></pre>

<ul>
<li><code>$(this)</code> not <code>$(&quot;this&quot;)</code>.</li>
</ul>

      </div>
      
      <div class="post">
        <h1 class="post-title">
          <a href="http://mudox.github.io/memo/error_collection_sh/">
            ERROR COLLECTION - BASH
          </a>
        </h1>

        <span class="post-date">Fri, Nov 7, 2014</span>

        <p>Errors that I collected day by day, when writing the Bash scripting language.</p>

<ul>
<li>Body of <code>select</code> constructs need a <code>break;</code> to quit the selection loop.</li>
</ul>

<pre><code class="language-bash">select answer in #choices#; do
  #body#
  break; # &lt;- go out of selection loop.
done
</code></pre>

<ul>
<li><p>Always <code>source</code> before testing a updated command.</p></li>

<li><p>Whence quoted with <code>&quot;</code>, which is the most case, use the <code>@</code> form (i.e.
<code>&quot;${ARRAY[@]}&quot;</code>) to expand a array correctly. The <code>*</code> form will make the
expanded string as a <strong>single word</strong>.</p></li>
</ul>

      </div>
      
      <div class="post">
        <h1 class="post-title">
          <a href="http://mudox.github.io/memo/setup_my_zsh_environment/">
            SETUP MY ZSH ENVIRONMENT
          </a>
        </h1>

        <span class="post-date">Wed, Nov 5, 2014</span>

        

<p>Steps of setting up zsh environment on my systems (Arch Linux, MacOS,
Windows/Cygwin).</p>

<h2 id="toc_0">the <code>z</code> command</h2>

<h2 id="toc_1">the <code>fzf</code> command</h2>

      </div>
      
      <div class="post">
        <h1 class="post-title">
          <a href="http://mudox.github.io/memo/setup_my_aweseome_wm_environment/">
            SETUP MY AWESOME WM ENVIRONMENT
          </a>
        </h1>

        <span class="post-date">Wed, Nov 5, 2014</span>

        

<p>Awesome WM let you maniplate system windows like using Vim, besides its
bleeding fast window UI rendering &amp; switching speed on *nix platform I&rsquo;ve ever
seen.</p>

<p>Below records my steps of setting up the Awesome window manager on my Arch
Linux progressively.</p>

<h1 id="toc_0">Installing Awesome Packages</h1>

<p>The awesome package is in the official repository of Arch Linux.</p>

<p>Better install Xephyr for testing cases.</p>

<pre><code class="language-bash">sudo pacman -S awesome xorg-xephyr
</code></pre>

<h1 id="toc_1">Pulling Down My Awesome-Config Repository</h1>

<p>The pulled down repo must be put in ~/.config/awesome, where awesome will
correctly load the configuration resources.</p>

<pre><code class="language-bash">mkdir ~/.config # if .config does not exist before.
cd ~/.config
git clone https://github.com/Mudox/awesome-config.git awesome
cd awesome
git submodule update --init --recursive
</code></pre>

      </div>
      
      <div class="post">
        <h1 class="post-title">
          <a href="http://mudox.github.io/memo/setup_my_cygwin_environment/">
            SETUP MY CYGWIN ENVIRONMENT
          </a>
        </h1>

        <span class="post-date">Wed, Nov 5, 2014</span>

        

<p>Cygwin &ndash; bring *nix command line user experence (paritially though) and
efficiency onto Windows.
Below is the steps of setting up the Cygwin environment on my Windows.</p>

<h1 id="toc_0">Why Cygwin over other tools.</h1>

<h1 id="toc_1">Setup Cygwin</h1>

<h2 id="toc_2">Cygwin path remapping</h2>

<h2 id="toc_3">mintty setting</h2>

<h2 id="toc_4">color</h2>

<h3 id="toc_5">mintty color palette</h3>

<h3 id="toc_6">ls_color</h3>

<h3 id="toc_7">colorful manpage</h3>

<h3 id="toc_8">colout</h3>

<h2 id="toc_9">encoding</h2>

<h2 id="toc_10">other settings</h2>

<h2 id="toc_11">Shell environment setup</h2>

<h2 id="toc_12">Cygwin package manager</h2>

<h1 id="toc_13">Cygwin Using Tips</h1>

<h2 id="toc_14">Working with gVim of Windows</h2>

<p>Most of the time, I prefer gui version of Vim than terminal version for it
being free of various shackles of terminal emulator, such as key confliction,
color presentation limit, UI rendering efficiency limit, etc.</p>

<p>First make sure a gVim instance already exists outside of Cygwin.</p>

<p>When I need to handle off some files to gVim for Windows, I can use <code>--remote</code>
(type <code>:h clientserver</code> in gVim for details) command families, for example:</p>

<pre><code class="language-bash">alias gvim='/c/Program Files/Vim/vim74/gvim.exe'

gvim --remote-tab /path/of/file
</code></pre>

<p>it will open the file in new tab of an already running gVim instance.</p>

      </div>
      
      <div class="post">
        <h1 class="post-title">
          <a href="http://mudox.github.io/post/about_the_site/">
            ABOUT THE SITE
          </a>
        </h1>

        <span class="post-date">Wed, Nov 5, 2014</span>

        

<h1 id="toc_0">Note To Myself</h1>

<h2 id="toc_1">When to use</h2>

<h3 id="toc_2">&lt;code&gt;</h3>

<ul>
<li><p>in-line command line.</p></li>

<li><p>command name</p></li>

<li><p>package / software / application name offen appears in script code</p></li>

<li><p>file path</p></li>
</ul>

<h3 id="toc_3">&lt;strong&gt;</h3>

<ul>
<li>single word or words that should be prominent in a sentence.</li>
</ul>

<h3 id="toc_4">&lt;em&gt;</h3>

<h2 id="toc_5">To-Do List of the Site</h2>

<ul>
<li><p>plural view customization.</p></li>

<li><p>list of content in sidebar for article single view.</p></li>

<li><p>top menu item more fancier.</p></li>

<li><p>tidy up CSS file.</p></li>

<li><p>term list view pagination.</p></li>

<li><p>home page.</p></li>

<li><p>add summary to each article.</p></li>

<li><p>chinese version of the site.</p></li>

<li><p>translation posts.</p></li>
</ul>

<h1 id="toc_6">Acknowledgements</h1>

<h2 id="toc_7"><a href="http://gohugo.io/">Hugo</a></h2>

<blockquote>
<p>A Fast and Flexible Static Site Generator built with love by spf13 in GoLang.</p>
</blockquote>

<h2 id="toc_8"><a href="https://github.com/spf13/hyde.git">Hyde</a></h2>

<blockquote>
<p>Hyde is a brazen two-column hugo theme based on the Jekyll theme of the same
name. It pairs a prominent sidebar with uncomplicated content.</p>
</blockquote>

<h2 id="toc_9"><a href="http://jquery.com/">JQuery</a></h2>

<blockquote>
<p>jQuery is a fast, small, and feature-rich JavaScript library. It makes things
like HTML document traversal and manipulation, event handling, animation, and
Ajax much simpler with an easy-to-use API that works across a multitude of
browsers. With a combination of versatility and extensibility, jQuery has
changed the way that millions of people write JavaScript.</p>
</blockquote>

<h2 id="toc_10"><a href="https://github.com/isagalaev/highlight.js.git">Highlight.js</a></h2>

<blockquote>
<p>Highlight.js is a syntax highlighter written in JavaScript. It works in the
browser as well as on the server. It works with pretty much any markup,
doesn&rsquo;t depend on any framework and has automatic language detection.</p>
</blockquote>

<h2 id="toc_11"><a href="http://www.nodejs.org/">Node.js</a></h2>

<blockquote>
<p>Node.js® is a platform built on Chrome&rsquo;s JavaScript runtime for easily
building fast, scalable network applications. Node.js uses an event-driven,
non-blocking I/O model that makes it lightweight and efficient, perfect for
data-intensive real-time applications that run across distributed devices.</p>
</blockquote>

<h2 id="toc_12"><a href="http://bower.io/">Bower</a></h2>

<blockquote>
<p>A package manager for the web.</p>

<p>Bower works by fetching and installing packages from all over, taking care of
hunting, finding, downloading, and saving the stuff you’re looking for. Bower
keeps track of these packages in a manifest file, bower.json. How you use
packages is up to you. Bower provides hooks to facilitate using packages in
your tools and workflows.</p>
</blockquote>

<h2 id="toc_13"><a href="http://www.goat1000.com/tagcanvas.php">TagCanvas</a></h2>

<blockquote>
<p>TagCanvas is a Javascript class which will draw and animate a HTML5 canvas
based tag cloud.</p>
</blockquote>

<h2 id="toc_14"><a href="https://github.com/VincentGarreau/particles.js">particles.js</a></h2>

<blockquote>
<p>A lightweight JavaScript library for creating particles.</p>
</blockquote>

<h2 id="toc_15"><a href="https://github.com/necolas/normalize.css">normalize.css</a></h2>

<blockquote>
<p>A collection of HTML element and attribute style-normalizations.</p>
</blockquote>

<h2 id="toc_16"><a href="https://github.com/ramswaroop/animatescroll.js">animatescroll.js</a></h2>

<blockquote>
<p>A Simple jQuery Plugin for Animating Scroll</p>
</blockquote>

<h2 id="toc_17"><a href="https://github.com/daneden/animate.css">animate.css</a></h2>

<blockquote>
<p>A cross-browser library of CSS animations. As easy to use as an easy thing.
<a href="http://daneden.github.io/animate.css">http://daneden.github.io/animate.css</a></p>
</blockquote>

<h2 id="toc_18"><a href="https://github.com/hakimel/stroll.js">stroll.js</a></h2>

<blockquote>
<p>CSS3 list scroll effects <a href="http://lab.hakim.se/scroll-effects">http://lab.hakim.se/scroll-effects</a></p>
</blockquote>

<h2 id="toc_19"><a href="https://github.com/knsv/mermaid.git">mermaid.js</a></h2>

<blockquote>
<p>Generation of diagrams and flowcharts from text in a similar manner as
markdown.</p>
</blockquote>

<h2 id="toc_20"><a href="https://github.com/mbostock/d3">D3.js</a></h2>

<blockquote>
<p>D3.js is a JavaScript library for manipulating documents based on data. D3
helps you bring data to life using HTML, SVG and CSS. D3’s emphasis on web
standards gives you the full capabilities of modern browsers without tying
yourself to a proprietary framework, combining powerful visualization
components and a data-driven approach to DOM manipulation.</p>
</blockquote>

<h2 id="toc_21"><a href="http://www.vim.org">gVim</a></h2>

<blockquote>
<p>the editor.</p>
</blockquote>

      </div>
      
      <div class="post">
        <h1 class="post-title">
          <a href="http://mudox.github.io/memo/my_vim_customization_policy/">
            MY VIM CUSTOMIZATION POLICY
          </a>
        </h1>

        <span class="post-date">Thu, Oct 30, 2014</span>

        

<p>It is the Vim that bring we into the fantastic OSS world. Fiddling with it is
full of surprise and happy.</p>

<p>Below records my thoughts and rules of customizing my Vim.</p>

<h1 id="toc_0">About Mapping</h1>

<h2 id="toc_1">Good prefixes for normal mode mappings</h2>

<h3 id="toc_2">The comma <code>,</code></h3>

<p>use 2 ~ 3 suffix characters, then we can get more candidates key combinations
for mapping.</p>

<h3 id="toc_3">The backslash <code>\</code></h3>

<p>different keyboard layouts have different locations for <code>\</code>, so it should be
used less frequently than <code>,</code>.</p>

<h3 id="toc_4">The space key <code>&lt;Space&gt;</code></h3>

<p>the <code>&lt;Space&gt;</code> is the best prefix for normal mappings I&rsquo;ve ever found. It spans
a long distance at the bottom of the keyboard, which makes it&rsquo;s very easy and
comfortable to touch.</p>

<p>currrently, I only assigned it to</p>

<ul>
<li><p><a href="https://github.com/kien/ctrlp.vim.git">kien&rsquo;s &lsquo;CtrlP&rsquo;</a> family mappings</p></li>

<li><p><a href="https://github.com/Mudox/vim-omnimenu">my &lsquo;vim-omnimenu&rsquo;</a> mappings</p></li>

<li><p><a href="https://github.com/Mudox/vim-chameleon">my &lsquo;vim-chameleon&rsquo;</a> mappings</p></li>
</ul>

<h3 id="toc_5">The enter <code>&lt;Cr&gt;</code> or <code>&lt;Enter&gt;</code></h3>

<p>since many vim itself and many plugin use <Cr>, so I should use it sparely.
when a single click of <Cr> is needed, you will feel a noticeable response lag.</p>

<h3 id="toc_6">The backspace key <code>&lt;BS&gt;</code></h3>

<p>by default, the <code>&lt;BS&gt;</code> acts the same as <code>h</code>, <code>Ctrl-H</code> and <code>&lt;Left&gt;</code> keys on
normal mode. so I have substituted it with the <code>&lt;Enter&gt;</code> key as a main prefix.</p>

<h3 id="toc_7">other possible key for prefixes</h3>

<ul>
<li><p><code>&lt;C-P&gt;</code></p></li>

<li><p><code>&lt;C-N&gt;</code></p></li>

<li><p><code>=</code></p></li>
</ul>

<h2 id="toc_8">Mapping toggling commands</h2>

<ol>
<li><p>use <code>co</code> prefix, which is derived from <a href="https://github.com/tpope/vim-unimpaired.git">tpope&rsquo;s &lsquo;unimpaired&rsquo;</a> plugin.</p></li>

<li><p>use <code>,*&lt;Space&gt;</code> pattern, which is derived from <a href="https://github.com/scrooloose/nerdcommenter.git">scrooloose&rsquo;s &lsquo;NERD commenter&rsquo;</a> plugin.</p></li>
</ol>

      </div>
      
      <div class="post">
        <h1 class="post-title">
          <a href="http://mudox.github.io/note/swift_oo/">
            SWIFT OJECT-ORIENTED FEATURE
          </a>
        </h1>

        <span class="post-date">Wed, Oct 29, 2014</span>

        

<p>Learning notes about object oriented features of the Swift programming
language.</p>

<h1 id="toc_0">Class Like Constructs In Swift</h1>

<p>In Swift, <code>enum</code>, <code>struct</code>, <code>class</code> all can:</p>

<ol>
<li><p>have <strong>properties</strong> to keep states.</p></li>

<li><p>have <strong>methods</strong> to perform actions.</p></li>

<li><p>define <strong>subscript</strong> operators to let user access their properties through
subscript syntax.</p></li>

<li><p>define <strong>initializers</strong> to have a reasonable initial state.</p></li>

<li><p>be <strong>extended</strong> to have additional behaviors beyond their default implementations.</p></li>

<li><p>conform to <strong>protocols</strong>.</p></li>
</ol>

<p>Only <code>class</code> can:</p>

<ol>
<li><p>have <strong>inheritance</strong> capability.</p></li>

<li><p>have <strong>deinitializer</strong>.</p></li>

<li><p>be <strong>referenced</strong> by mutiple variable or constants. the <code>struct</code> and <code>enum</code>
are both value types.</p></li>
</ol>

<h1 id="toc_1">Properties</h1>

<h2 id="toc_2">stored properties</h2>

<h3 id="toc_3">lazy properties</h3>

<h2 id="toc_4">computed properties</h2>

<h3 id="toc_5">shorthand setter syntax</h3>

<h3 id="toc_6">shorthand read-only getter syntax</h3>

<h1 id="toc_7">Initializers</h1>

      </div>
      
      <div class="post">
        <h1 class="post-title">
          <a href="http://mudox.github.io/note/javascript_type_conversions/">
            JAVASCRIPT TYPE CONVERSIONS
          </a>
        </h1>

        <span class="post-date">Tue, Oct 28, 2014</span>

        

<p>Here records what I learned about JavaScript&rsquo;s type conversion.</p>

<h1 id="toc_0">Sepcial Value Or Types In JavaScript</h1>

<h2 id="toc_1">The <code>undefined</code></h2>

<p>The <code>undefined</code> is the only value of <code>undefined</code>, represents unknown value of any
other types, including primitive types &amp; object.</p>

<pre><code class="language-js">// play with 'undefined'
typeof undefiend                  /* undfeined        */
undefined == undefined            /* true             */
undefined == null                 /* true             */
undefined !== null                /* true             */
Boolean(undefined)                /* false            */
Number(undefined)                 /* NaN              */
</code></pre>

<h2 id="toc_2">The <code>null</code></h2>

<p>The <code>null</code>, by standards, should be the only value of <code>null</code> type, but in certain
browser (e.g. firfox, chrome), it is of type <code>object</code>. <code>null</code> is used to
represent unknown value of an object.</p>

<p>It is equal to itself and it is equal to <code>undefined</code>.</p>

<pre><code class="language-js">// play with 'null'
typeof null                       /* object           */
null == null                      /* true             */
null == undefined                 /* true             */
null !== undefined                /* true             */
Boolean(null)                     /* false            */
Number(null)                      /* 0                */
</code></pre>

<h2 id="toc_3">The <code>NaN</code></h2>

<p>The <code>NaN</code> is a <code>Number</code> that can not be represented as a number.</p>

<p>It dose <strong>NOT</strong> equal to itself, hence JavaScript provide a built-in function
<code>isNaN()</code> to test if a value is a NaN.</p>

<pre><code class="language-javascri">// play with 'NaN'
typeof NaN                        /* number           */
NaN == NaN                        /* false            */
NaN == undefined                  /* false            */
NaN == null                       /* false            */
Boolean(NaN)                      /* false            */
Number(NaN)                       /* NaN              */
isNaN(NaN)                        /* true             */
NaN == 0/0                        /* true             */
isNaN(0/0)                        /* true             */
</code></pre>

<h1 id="toc_4">Implicit Type Conversions</h1>

<h2 id="toc_5">When other types need to be converted into a number</h2>

<p>When different types are mixed in a relational operation (i.e <code>== != &lt; &lt;= &gt;
&gt;=</code>) except the <code>===</code> operator, or an arithmetic operation, except
the <code>+</code> operator, they would be converted into numbers first.</p>

<h3 id="toc_6">For Boolean:</h3>

<ul>
<li><p>true would be converted to 1</p></li>

<li><p>false would be converted to 0</p></li>
</ul>

<h3 id="toc_7">For String:</h3>

<p>It is converted literally, i.e.</p>

<pre><code class="language-js">'2014' &lt; 2 /* 2014 &lt; 2 yields false */
'3.1415' == 3.1415 /* 3.1415 == 3.1415 yields true */
</code></pre>

<p>There is one exception: a <code>emtpy</code> string would be converted to 0.</p>

<pre><code class="language-js">var emptyText = '';

/* 'emptyText' here, converetd to 0, is compared to true which is converted to 1,
and then '!' negates the results to true */
if (!emptyText) {
  console.log('empty text is not true!')
}
</code></pre>

<h2 id="toc_8">When other types need to be converted into a string</h2>

<h3 id="toc_9">The special <code>+</code> operator</h3>

<p>In JavaScript, the <code>+</code> is first a string concatenation operator, then a
arithmetic addition operator.</p>

<p>When one of <code>+</code>&rsquo;s operands is a string, JavaScript will try to convert the
other operand into a string, and perform a concatenation operation.</p>

<h3 id="toc_10">For Boolean:</h3>

<ul>
<li><p><code>true</code> would be conveted bo &ldquo;true&rdquo;</p></li>

<li><p><code>false</code> would be conveted to &ldquo;false&rdquo;</p></li>
</ul>

<h3 id="toc_11">For <code>null</code>, <code>undefined</code> &amp; <code>NaN</code></h3>

<p>they all be converted literally.</p>

<h2 id="toc_12">When other types need to be converted into a boolean value</h2>

<p>from 《Head First JavaScript Programming》:</p>

<blockquote>
<p>the secret to learning what is truthy and what is falsey is to learn what’s
falsey, and then consider everything else truthy.
concentrate on  knowing what is falsey, and then everything else you can
consider truthy.</p>
</blockquote>

<p>it is a golden rule that also applys in many other programming language
learning situations.</p>

<p>As to what value should be considered as falsey, different language has
different policy. There are <strong>5</strong> falsey value in JavaScript:</p>

<ol>
<li><p><code>undefined</code></p></li>

<li><p><code>null</code></p></li>

<li><p><code>NaN</code></p></li>

<li><p><code>&quot;&quot;</code></p></li>

<li><p><code>0</code></p></li>
</ol>

      </div>
      
      <div class="post">
        <h1 class="post-title">
          <a href="http://mudox.github.io/note/web_page_layouts/">
            WEB PAGE LAYOUTS
          </a>
        </h1>

        <span class="post-date">Sun, Oct 26, 2014</span>

        

<h1 id="toc_0">Liquid Layout</h1>

<p>This is the browser&rsquo;s default layout behavior, if you did not add any CSS to
style a page. The block elements, like liquid, just fill as much space as they
can in the pages.</p>

<h1 id="toc_1">Frozen Layout</h1>

<p>By using the CSS attribute combination of <code>float</code> and <code>width</code>, we can put a
<strong>containing</strong> block (i.e. <code>&lt;seciton&gt;</code>, <code>&lt;aside&gt;</code>, <code>&lt;div&gt;</code>) to float on to
left-most or right-most side forming a <strong>column</strong>, and let the  remaining
content to flow around the fixed-width floating column, forming the other
column.</p>

<p>Use CSS attribute <code>clear: [left | right]</code> to let a block to layout fully
underneath a floating elements.</p>

<h1 id="toc_2">Jello Layout</h1>

<p>On the basis of frozen layout, we can use containing fixed-width block to wrap
all columns (floating or flowing), and by using <code>margin-left: auto;
margin-right: auto;</code> CSS style, to center the contained columns in the page.</p>

<h1 id="toc_3">Absolute Position</h1>

<p>By using the CSS attribute combination of <code>position: [absolute | fixed]</code> and
<code>left | right | top | bottom: ...</code>, we can take the column fully out of layout
flow, and fix their position relative to the page (<code>position: absolute</code>), or to
the viewport (<code>position: fixed</code>).</p>

<h1 id="toc_4">Table Display</h1>

<p>Use CSS attribute <code>display: [table | table-row | table-cell]</code> to organize HTML
elements into an invisible table.</p>

<p>Most of the time, <code>vertical-align: top</code> will help you to get what you want to see.</p>

      </div>
      
      <div class="post">
        <h1 class="post-title">
          <a href="http://mudox.github.io/note/swift_features/">
            SWIFT FEATURES
          </a>
        </h1>

        <span class="post-date">Tue, Oct 14, 2014</span>

        

<p>During the learning of the Swift programming language, many of it&rsquo;s features
impressed me.</p>

<h1 id="toc_0">Powerful <code>switch</code> Statement</h1>

<ol>
<li><p>no implicitly fall-through</p></li>

<li><p>match multiple conditions in one case statement.</p></li>

<li><p>match against range.</p></li>

<li><p>match against tuple.</p></li>

<li><p>value binding.</p></li>

<li><p><code>where</code> clause can provide more conditions.</p></li>

<li><p><code>break</code> &amp; <code>continue</code> can <em>jump</em> further (to some label)</p></li>
</ol>

<pre><code class="language-swift">var aPoint = (x: 2, y: -1)
// labeled `swtich`
// NOTE: only loop statements and 'switch' statement can labeled.
theSwitch: switch aPoint {
// against tuple
case (0, 0):
  println(&quot;origin point&quot;)

// against multiple conditions separated by comma
case (1, 1), (2, 2):
  println(&quot;(1, 1) or (2, 2)&quot;)

// '_' means 'any value is ok'
case (_, 0):
  // the `break` here is just like the `pass` in python, acting as a
  // 'placeholder statement', nullifing this case branch.
  break

case (0, _):
  println(&quot;on the Y-axis&quot;)

// against range
case (-2...2, -2...2):
  println(&quot;on or in the 2x2 box&quot;)

// value binding
case (let x, -10):
  println(&quot;on the horizontal line y = -10, with a x value: \(x)&quot;)

// where clause
// NOTE: `let` can be replaced with `var` if you need to change the bound
// value afterwards.
case (0, var y) where y &gt;= 0:
  y++    // mutable
  println(&quot;on the 1st or 2nd quadrant&quot;)

// value binding as a whole, which is an required exhaustive match
case let (x, y):
  theLoop: for i in 1..&lt;100 {
    switch i {
      case let x where (x &amp; 1) == 1: // a odd number
        break theSwitch     // jump further
      default:
        continue theLoop    // jump
    }
  }
}
</code></pre>

<h1 id="toc_1">Closure &ndash; Too Much Sugar!</h1>

<p>The closure in Swift language adopts many syntactic sugar.</p>

<p>The basic full syntax of a closure is as follows:</p>

<pre><code class="language-swift">{
  (parameters) -&gt; retrunType in
  ... statements ...
}
</code></pre>

<p>Here is an example that uses the array&rsquo;s method <code>sorted</code> to sort an array of word.</p>

<pre><code class="language-swift">var words = [ &quot;Dolor&quot;, &quot;eum&quot;, &quot;id&quot;, &quot;suscipit&quot;, &quot;necessitatibus&quot;, &quot;quod&quot;, &quot;hic&quot;, &quot;dignissimos&quot; ]

let sortedWords = words.sorted({
  (lhs: String, rhs: String) -&gt; Bool in
  return lhs &lt; rhs
})
</code></pre>

<h2 id="toc_2">Sugar #0 &ndash; trailing closure</h2>

<p>Often, closure parameter is placed last in parameter list. Swift thus provides
<strong>trailing closure</strong>, which means your can write the inline closure just
outside the parameter list, following the closing <code>)</code>.</p>

<p>Furthermore, if the closure is the only parameter, then the parenthesis can be
omitted.</p>

<pre><code class="language-swift">// trailing closure
let sortedWords = words.sorted/*()*/ {
  (lhs: String, rhs: String) -&gt; Bool in
  return lhs &lt; rhs
}
</code></pre>

<h2 id="toc_3">Sugar #1 &ndash; return type inference</h2>

<p><strong>return type</strong> can be inferred by swift compiler.</p>

<pre><code class="language-swift">// omit return type
let sortedWords = words.sorted {
  (lhs: String, rhs: String) /*-&gt; Bool*/ in
  return lhs &lt; rhs
}
</code></pre>

<h2 id="toc_4">Sugar #2 &ndash; parameter type inference</h2>

<p><strong>parameter types</strong> can be inferred by swift compiler as well.</p>

<pre><code class="language-swift">// omit parameter types
let sortedWords = words.sorted {
  (lhs/*: String*/, rhs/*: String*/) /*-&gt; Bool*/ in
  return lhs &lt; rhs
}
</code></pre>

<h2 id="toc_5">Sugar #3 &ndash; parenthesis-less</h2>

<p>Since no type annotation is needed, the <strong>parenthesis</strong> can be omitted.</p>

<pre><code class="language-swift">// omit parenthesis
let sortedWords = words.sorted {
  /*(*/lhs/*: String*/, rhs/*: String)*/ /*-&gt; Bool*/ in
  return lhs &lt; rhs
}
</code></pre>

<h2 id="toc_6">Sugar #4 &ndash; return statement inference</h2>

<p>If the closure has one statement, then the <strong>return</strong> statement can also be
inferred.</p>

<pre><code class="language-swift">// omit 'return'
let sortedWords = words.sorted {
  /*(*/lhs/*: String*/, rhs/*: String)*/ /*-&gt; Bool*/ in
  /*return*/ lhs &lt; rhs
}

//then we got:
let sortedWords = words.sorted { lhs, rhs in lhs &lt; rhs }
</code></pre>

<h2 id="toc_7">Sugar #5 &ndash; shorthand parameter name</h2>

<p>Swift provides <strong>shorthand parameter names</strong>: $0 for the 1st parameter, $1 for
the 2nd parameter, and so on. And as an side effect, the whole <code>(parameters) -&gt;
returType in</code> statement can be completely omitted</p>

<pre><code class="language-swift">// use shorthand parameters, omit the whole 'in' statement
let sortedWords = words.sorted {
  /*(lhs: String, rhs: String) -&gt; Bool in*/
  /*return*/ $0 &lt; $1
}

// then we got:
let sortedWords = words.sorted { $0 &lt; $1 }
</code></pre>

<h2 id="toc_8">Sugar #6 &ndash; operator as a closure</h2>

<p>In swift, <strong>operator</strong> is a function, which in turn is a special closure, so&hellip;</p>

<pre><code class="language-swift">// comes operator!
let sortedWords = words.sorted(&lt;)
</code></pre>

<h1 id="toc_9">Fully-fledged Enumeration</h1>

<p>In Swift, enumeration is fully-fledged type. You can associate different data
with each enumeration member, or define a raw type for enumeration.</p>

<h2 id="toc_10">Flexible definition syntax</h2>

<p>you can define more than one member a line.</p>

<h2 id="toc_11">Type inference</h2>

<h2 id="toc_12">Associated Value</h2>

<h2 id="toc_13">Raw type</h2>

<h2 id="toc_14">Struct like enumeration</h2>

<p>enumeration in Swift can have properties &amp; methods.</p>

<p>enumeration, like struct in Swift, is value type (while class is reference
accounted type).</p>

      </div>
      
      <div class="post">
        <h1 class="post-title">
          <a href="http://mudox.github.io/post/about_me/">
            ABOUT ME
          </a>
        </h1>

        <span class="post-date">Thu, Oct 2, 2014</span>

        <p>Hi, I&rsquo;m Mudox.</p>

<p>I am also in:</p>

<ul>
<li><p><a href="https://github.com/Mudox">github.com/Mudox</a></p></li>

<li><p><a href="http://my.oschina.net/mudox">oschina.net/mudox</a></p></li>
</ul>

      </div>
      
      <div class="post">
        <h1 class="post-title">
          <a href="http://mudox.github.io/note/git/">
            GIT MISC
          </a>
        </h1>

        <span class="post-date">Thu, Oct 2, 2014</span>

        

<h1 id="toc_0">Alias</h1>

<ul>
<li><p>working tree, working directory</p></li>

<li><p>index, staging area, cache, staged snapshot</p></li>

<li><p>commit[ted] history, commit[ted] snapshot</p></li>
</ul>

<h1 id="toc_1">The <code>add</code> &amp; <code>rm</code> &amp; <code>reset</code> &amp; <code>commit</code> &amp; <code>checkout</code> Sub-commands.</h1>

<ul>
<li><p>between the <em>committed history</em> &amp; <em>staging area</em></p>

<ul>
<li><p><code>commit</code> submit changes from <em>staging area</em> to <em>committed history</em></p></li>

<li><p><code>reset</code> revert changes from <em>committed history</em> back to <em>staging area</em></p></li>
</ul></li>

<li><p>between the <em>staging area</em> &amp; <em>working tree</em>.</p>

<ul>
<li><p><code>add</code> submit changes from <em>working tree</em> to <em>staging area</em>, preparing
for committing.</p></li>

<li><p><code>rm</code> remove file(s) from <em>stageing area</em>, so they become <em>untracked</em>.</p></li>
</ul></li>

<li><p><code>checkout</code> restore changes from staging area or a specific commit of committed
history to <em>working directory</em>.</p></li>

<li><p><code>reset</code></p>

<ul>
<li><p><strong>unstages</strong> changes in staging area.
v
    git reset <paths></p></li>

<li><p>or, if you ask for more, <strong>uncommits</strong> changes in history.</p>

<pre><code>git reset &lt;commit-ish&gt;
</code></pre></li>
</ul></li>

<li><p><code>rm</code></p>

<ul>
<li><p><strong>untracks</strong> file(s) previously tracked in staging area.</p>

<pre><code>git rm --cache &lt;paths&gt;
</code></pre></li>

<li><p>or, if you ask for more, <strong>removes</strong> file(s) in the work directory.</p>

<pre><code>git rm &lt;paths&gt;
</code></pre></li>
</ul></li>

<li><p><code>git reset</code> vs <code>git checkout</code></p>

<ul>
<li><p><code>git reset &lt;commit-ish&gt; &lt;paths&gt;</code> only update <em>staging area</em>.</p></li>

<li><p><code>git checkout &lt;paths&gt;</code> fetch <code>&lt;paths&gt;</code> from <em>staging area</em> to working
direcotry.</p></li>

<li><p><code>git checkout &lt;commit-ish&gt;</code> fetch <code>&lt;paths&gt;</code> from <em>history</em> to both
<em>index</em> &amp; <em>working direcotry</em>.</p></li>
</ul></li>
</ul>

<h1 id="toc_2">The <code>git Rebase</code> Sub-command</h1>

<h2 id="toc_3">Advantage of <code>rebase</code>:</h2>

<ul>
<li><p>no additional merge commit</p></li>

<li><p>linear commit history</p></li>
</ul>

<h2 id="toc_4">Disadvantage of <code>rebase</code>:</h2>

<ul>
<li><p>safety</p></li>

<li><p>tracability: the evidences of merging are wiped away.</p></li>
</ul>

<h2 id="toc_5">Golden rule of <code>git rebase</code>:</h2>

<p><strong>never</strong> use it on <strong>public</strong> branches.</p>

<h2 id="toc_6">When to use <code>rebase</code></h2>

<ul>
<li><p>Local cleanup</p></li>

<li><p>Incorporating upstream changes into a feature branch</p></li>

<li><p>Integrating a approved feature</p></li>
</ul>

<h1 id="toc_7">The <code>reset</code>, <code>checkout</code> And <code>revert</code> Sub-commands</h1>

<blockquote>
<p>The parameters that you pass to <code>git reset</code> and <code>git checkout</code> determine
their scope. When you don’t include a <strong>&lt;file path&gt;</strong> as a parameter, they
operate on whole commits.  Note that git revert has no file-level counterpart</p>
</blockquote>

<p>from <a href="https://www.atlassian.com/git/tutorials/resetting-checking-out-and-reverting/commit-level-operations">atlassian&rsquo;s git tutorials</a></p>

<h2 id="toc_8">Commit level operations</h2>

<p><code>git reset --[soft | mixed | hard] &lt;commit-ish&gt;</code> <strong>move</strong> branch tips backwards
or even forwards, while affecting <em>staging area</em> &amp; <em>working direcotry</em> according to
options it is given.</p>

<table>
<thead>
<tr>
<th>option</th>
<th>history</th>
<th>staging area</th>
<th>working directory</th>
</tr>
</thead>

<tbody>
<tr>
<td><code>--soft</code></td>
<td>√</td>
<td></td>
<td></td>
</tr>

<tr>
<td><code>--mixed</code></td>
<td>√</td>
<td>√</td>
<td></td>
</tr>

<tr>
<td><code>--hard</code></td>
<td>√</td>
<td>√</td>
<td>√</td>
</tr>
</tbody>
</table>

<p><code>git checkout &lt;commit-ish&gt;</code> dose not move tips around.</p>

<p><code>git revert</code> undo commits by adding a new commit. it is a safe (reversible) way
to undo commits, while <code>git reset</code> is dangerous (irreversible) way to undo
commits.</p>

<h2 id="toc_9">File level operations</h2>

<pre><code>git [reset|checkout] &lt;commit-ish&gt; &lt;pathspec&gt;
</code></pre>

<table>
<thead>
<tr>
<th>command</th>
<th>history</th>
<th>staging area</th>
<th>working directory</th>
</tr>
</thead>

<tbody>
<tr>
<td><code>reset</code></td>
<td></td>
<td>√</td>
<td>√</td>
</tr>

<tr>
<td><code>checkout</code></td>
<td></td>
<td></td>
<td>√</td>
</tr>
</tbody>
</table>

<h1 id="toc_10">Summary</h1>

<table>
<thead>
<tr>
<th>command</th>
<th>commit level</th>
<th>file level</th>
</tr>
</thead>

<tbody>
<tr>
<td><code>reset</code></td>
<td>discard commits in private branches or throw away uncommited changes</td>
<td>unstage a file</td>
</tr>

<tr>
<td><code>checkout</code></td>
<td>swtich between branches or inspect old snapshots</td>
<td>discard changes in the working directory</td>
</tr>

<tr>
<td><code>revert</code></td>
<td>undo commits in public branches</td>
<td><strong>N/A</strong></td>
</tr>
</tbody>
</table>

      </div>
      
      <div class="post">
        <h1 class="post-title">
          <a href="http://mudox.github.io/memo/compile_macvim_and_ycm_on_osx/">
            COMPILE MACVIM &amp; YCM ON OSX
          </a>
        </h1>

        <span class="post-date">Mon, Sep 29, 2014</span>

        

<p>Compiling <a href="http://valloric.github.io/YouCompleteMe/">Youcompleteme</a> and <a href="https://github.com/b4winckler/macvim">Macvim</a> on MacOSX once beaten me
down for several nights.</p>

<p>I eventually found out that this is because the interference from
<a href="https://github.com/yyuu/pyenv">pyenv</a> and [homebrew][brew].</p>

<p>[homebrew][brew] installs packages into a unconventional path, which makes
MacVim and Youcompleteme can found buidling dependencies in default paths.</p>

<p>While <a href="https://github.com/yyuu/pyenv">pyenv</a> will shadow <a href="https://github.com/b4winckler/macvim">Macvim</a>&rsquo;s default python &hellip;</p>

<h1 id="toc_0">Preparation</h1>

<ul>
<li><p>disable pyenv</p>

<ol>
<li><p>run <code>brew unlink pyenv</code> (<code>brew link pyenv</code> after compilation)</p></li>

<li><p>restart shell (e.g. itemr2)</p></li>
</ol></li>

<li><p>reset develop directory of Xcode</p>

<ol>
<li><code>sudo xcode-select -r</code></li>
</ol></li>
</ul>

<h1 id="toc_1">Compile YCM</h1>

<p>On MacOSX using native clang package has proven to be very stable, besides, it
drastically accelerates the installing process &ndash; leaving <code>install.sh</code> no need
to download the prebuild binaries from LLVM&rsquo;s site.</p>

<pre><code class="language-bash">cd /to/ycm/root/directory/
    ./install.sh --clang-completer --system-libclang
</code></pre>

<h1 id="toc_2">Compile MacVim</h1>

<pre><code class="language-bash">make distclean
./configure               \
    --with-features=huge  \
    -with-macarchs=x86_64 \
    --enable-perlinterp   \
    --enable-rubyinterp   \
    --enable-pythoninterp \
    --enable-luainterp    \
    --enable-perlinterp   \
    --enable-cscope       \
    --with-lua-prefix=/usr/local/Cellar/lua/&lt;current_version&gt; &gt;/tmp/log
make
</code></pre>

      </div>
      
      <div class="post">
        <h1 class="post-title">
          <a href="http://mudox.github.io/memo/vim_chameleon_startup_menu/">
            VIM CHAMELEON STARTUP MENU
          </a>
        </h1>

        <span class="post-date">Mon, Sep 29, 2014</span>

        

<p>Records here the steps of making a small and neat vim-chameleon startup screen.</p>

<h1 id="toc_0">On Windows:</h1>

<ol>
<li><p>create a shortcut from gVim.exe.</p></li>

<li><p>right click on the shorcut to open it&rsquo;s property dialog.</p></li>

<li><p>append the following lines (<em>concatenated into one line</em>) to the <strong>target</strong> field.</p></li>
</ol>

<pre><code class="language-bash">--cmd &quot;let g:mdx_chameleon_cur_mode = 'startup'&quot;
--cmd &quot;set lines=9 columns=32&quot;
--cmd &quot;winpos 475 320&quot;
-c &quot;let &amp;titlestring='Happy Vimming!'&quot;
-c &quot;ChamStartup&quot;
</code></pre>

<ol>
<li>optionally, put this shortcut under paths listed in system&rsquo;s $PATH environment variable.</li>
</ol>

<h1 id="toc_1">On Mac OSX:</h1>

<p>the <code>MacVim.app</code> does not accepts arguemnts above, we should use:</p>

<pre><code class="language-bash">/Applications/MacVim.app/Contents/MacOS/Vim -g
</code></pre>

<p>instead:</p>

<pre><code class="language-bash">/Applications/MacVim.app/Contents/MacOS/Vim -g            \
        --cmd &quot;let g:mdx_chameleon_cur_mode = 'startup'&quot;  \
        --cmd &quot;set lines=9 columns=22&quot;                    \
        --cmd &quot;winpos 880 370&quot;                            \
        -c &quot;let &amp;titlestring='Happy Vimming!'&quot;            \
        -c &quot;let &amp;guifont = 'Monaco for Powerline:h16'&quot;    \
        -c &quot;ChamStartup&quot;
</code></pre>

<h1 id="toc_2">On Linux:</h1>

<pre><code class="language-bash">
</code></pre>

      </div>
      
      <div class="post">
        <h1 class="post-title">
          <a href="http://mudox.github.io/note/git_flow/">
            GIT FLOW
          </a>
        </h1>

        <span class="post-date">Sun, Sep 28, 2014</span>

        

<h1 id="toc_0">1. Main Branches</h1>

<ul>
<li><p>the <code>main</code> branch</p>

<p>keeps the official release history (usually with version nubmer tags
attached).</p>

<p>i.e. every commits in master is a new release. all branches merged back
into master must have a new incremental version number.</p></li>

<li><p>the <code>develop</code> branch</p>

<p>serves as an integration branch for features.</p>

<p>nitghly build built from it.</p></li>
</ul>

<h1 id="toc_1">2. Supporting Branches</h1>

<h2 id="toc_2">2.1 feature (or topic) branches</h2>

<p>branch off from: <code>develop</code> branch</p>

<p>merge into: <code>develop</code> branch</p>

<p>naming convention: any name except <code>master</code>, <code>develop</code>, <code>relase[/-]*</code>,
<code>hotfix[/-]*</code></p>

<pre><code class="language-bash"># Branch A New Feature Branch Off From Develop Branch
git checkout -b some-feature develop
# Add Feature Commits To Branch Some-feature ...
# Merge Feature Branch Back Into Develop Branch.
git checkout develop
git merge --no-ff some-feature
git push origin develop
</code></pre>

<h2 id="toc_3">2.2 release branches</h2>

<p>branch off from: <code>develop</code> branch</p>

<p>merge into: <code>develop</code> &amp; <code>master</code> branch</p>

<p>naming convention: <code>release/*</code> or <code>release-*</code></p>

<pre><code class="language-bash"># Branch A New Release Branch Off From Develop Branch
git checkout -b release-&lt;version number&gt; develop
# Bummp Up Version In Related Fiels.
git commit -m 'Bumped version number to &lt;version number&gt;'
# Roll Out Release, Minor Bug Fixes
# Merge The Release Into Master, And Give It A New Tag.
git checkout master
git merge --no-ff release-&lt;version number&gt;
git tag -a &lt;version number&gt;
# Merge The Release Back Into Develop
git checkout develop
git merge --no-ff release-&lt;version number&gt;
</code></pre>

<h2 id="toc_4">2.3 hotfix (or maintenance) branches</h2>

<p>branch off from: <code>master</code> branch
merge into: <code>develop</code> &amp; <code>master</code> branch if no active release branch existed
currrently.
naming convention: <code>hotfix/*</code> or <code>hotfix-*</code></p>

<pre><code class="language-bash"># Branch A New Hotfix Branch Off From Master Branch
git checkout -b hotfix-&lt;version number&gt; master
# Bummp Up Version In Related Fiels, Becuase It Will Finnaly Be Merged Back
# Into Master Branch.
git commit -m 'Bumped version number to &lt;version number&gt;'
# Roll Out Hotfix, Minor Bug Fixes
# Merge The Hotfix Into Master, And Give It A New Tag.
git checkout master
git merge --no-ff hotfix-&lt;version number&gt;
git tag -a &lt;version number&gt;
# Merge The Hotfix Back Into Develop
git checkout develop
git merge --no-ff hotfix-&lt;version number&gt;
</code></pre>

      </div>
      
      <div class="post">
        <h1 class="post-title">
          <a href="http://mudox.github.io/note/go_stdlib_template/">
            GO&#39;S TEMPLATE LIBRARY
          </a>
        </h1>

        <span class="post-date">Fri, Sep 26, 2014</span>

        

<p>I come across this library when I started to use <a href="http://gohugo.io">Hugo</a>,
which says:</p>

<blockquote>
<p>It is an extremely <strong>lightweight</strong> engine that provides a very small amount of
logic. In our experience it is <strong>just the right amount of logic</strong> to be able to
create a good static website.</p>
</blockquote>

<h1 id="toc_0">3 Steps Using The Template Object</h1>

<ol>
<li><p><code>New</code> an template object.</p></li>

<li><p><code>Parse</code> template text.</p></li>

<li><p><code>Execute</code> (apply) the template to data structure.</p></li>
</ol>

<h1 id="toc_1">6 Action Families</h1>

<p><strong>comment</strong></p>

<pre><code class="language-go">{{/* comment here, line spanning allowed */}}
</code></pre>

<p><strong>pipeline</strong> like variable expansion (substitution)</p>

<pre><code class="language-go">{{pipeline}}
</code></pre>

<p><strong>if</strong> family for branching logic</p>

<pre><code class="language-go">{{if _pipline_}} T1 {{end}}
{{if _pipline_}} T1 {{else}} T0 {{end}}
{{if _pipline_}} T1 {{else if _pipeline_ }} T0 {{end}}

</code></pre>

<p><strong>range</strong> family for iteration (loop)</p>

<pre><code class="language-go">{{range pipepine}} T1 {{end}}
{{range pipepine}} T1 {{else}} T0 {{end}}

</code></pre>

<p><strong>with</strong> family for cursor (dot) moving</p>

<pre><code class="language-go">{{with pipeline}} T1 {{end}}
{{with pipeline}} T1 {{else}} T0 {{end}}

</code></pre>

<p><strong>template</strong> family for tempates invocation</p>

<pre><code class="language-go">// with the dot '.' set to nil.
{{tempalte &quot;name&quot;}}
// with the dot '.' set to value of 'pipeline'.
{{tempalte &quot;name&quot; pipeline}}

</code></pre>

<h1 id="toc_2">Argument Types</h1>

<ul>
<li><p>untyped <strong>constants</strong> in go syntax</p></li>

<li><p><strong>nil</strong> &ndash; the special constant</p></li>

<li><p><strong>variable</strong> name</p>

<p><code>$variable_name</code> or <code>$</code></p></li>

<li><p><code>.</code> &ndash; the so called &lsquo;context&rsquo; constant</p></li>

<li><p>dot chain consist of: <strong>field</strong> name,  <strong>key</strong> name,  niladic <strong>method</strong> name</p></li>
</ul>

<pre><code class="language-go">(.Field.Key.Method args...).Field.Key ...
</code></pre>

<ul>
<li><p>niladic <strong>function</strong> name</p></li>

<li><p>parenthesized <strong>group</strong> of above</p></li>
</ul>

<pre><code class="language-go">print (func arg...) (.method arg...)
</code></pre>

      </div>
      
      <div class="post">
        <h1 class="post-title">
          <a href="http://mudox.github.io/note/ios_notes_cocoa_concurrency/">
            iOS NOTES - COCOA CONCURRENCY
          </a>
        </h1>

        <span class="post-date">Wed, Sep 24, 2014</span>

        

<h1 id="toc_0">Members Of Cocoa Concurrency</h1>

<ul>
<li><p>Operation Queue</p>

<ul>
<li><p>abstract base class <code>NSOperation</code></p></li>

<li><p>concrete subclass <code>NSInvocation</code></p></li>

<li><p>concrete subclass <code>NSBlockOperation</code></p></li>
</ul></li>

<li><p>Dispatch Queue</p></li>

<li><p>Dispatch Source</p></li>
</ul>

<h1 id="toc_1">Operation Queue Features</h1>

<ol>
<li><p>graph-based dependencies</p></li>

<li><p>completion block</p></li>

<li><p>execution status monitoring</p></li>

<li><p>prioritizeing</p></li>

<li><p>canceling</p></li>
</ol>

      </div>
      
      <div class="post">
        <h1 class="post-title">
          <a href="http://mudox.github.io/note/ios_notes_cocoa_threading/">
            iOS NOTES - COCOA THREADING
          </a>
        </h1>

        <span class="post-date">Wed, Sep 24, 2014</span>

        

<h1 id="toc_0">Run Loop</h1>

<h2 id="toc_1">4 roles participate in the run loop game:</h2>

<ol>
<li><p><strong>Run Loop</strong></p>

<p>which is represented by <code>NSRun Loop</code> &amp; <code>CFRunLoop</code>.</p></li>

<li><p><strong>Run Loop Mode</strong></p>

<p>which is represented by <code>CFStringRef</code> associated to each instance of run
loop object.</p></li>

<li><p><strong>Run Loop Source</strong></p>

<p>which is represented by <code>CFRunloopSource</code>.</p>

<ul>
<li><p>Input source</p>

<ul>
<li><p>Port-based source</p></li>

<li><p>Perform selctor on other threads</p></li>

<li><p>Custom source</p></li>
</ul></li>

<li><p>Timer</p>

<p>which is represented by <code>CFRunloopTimerRef</code>.</p>

<ul>
<li><p>Explictly defined timer</p></li>

<li><p>Perform selector on current thread with delay</p></li>

<li><p>Perform selector</p></li>
</ul></li>
</ul></li>

<li><p><strong>Run Loop Observer</strong></p></li>
</ol>

<h2 id="toc_2">4 ways to kill a run loop iteration:</h2>

<ol>
<li><p>no sources exists</p>

<p>since some system routines may install certain input sources to the run
 loop implictly, we should not kill a run loop iteration by clearing &lsquo;<em>all</em>&lsquo;
 sources we known.</p></li>

<li><p>timeout</p></li>

<li><p>sourced handled in one-shot mode</p></li>

<li><p>explicitly stoped by <code>CRunloopStop</code></p></li>
</ol>

<h2 id="toc_3">3 kinds of perform selector sources.</h2>

<table>
<thead>
<tr>
<th>on thread</th>
<th>invocation</th>
<th>delay</th>
<th>blocking call?</th>
<th>mode</th>
</tr>
</thead>

<tbody>
<tr>
<td>current thread</td>
<td>√</td>
<td>√</td>
<td>always non-blocking</td>
<td>√</td>
</tr>

<tr>
<td>other thread</td>
<td>√</td>
<td>x</td>
<td>√</td>
<td>x</td>
</tr>

<tr>
<td>main thread</td>
<td>√</td>
<td>x</td>
<td>√</td>
<td>x</td>
</tr>
</tbody>
</table>

<h1 id="toc_4">Alternatives To Threaing</h1>

<ol>
<li><p>Operation Objects</p></li>

<li><p>Grand Central Dispatch (GCD)</p></li>

<li><p>Idle-time notifications</p></li>

<li><p>Asynchronous functions</p></li>

<li><p>Timers</p></li>

<li><p>Separate processes</p></li>
</ol>

<h1 id="toc_5">Cocoa Support For Threading</h1>

<ol>
<li><p>Cocoa threads</p></li>

<li><p>POSIX threads</p></li>

<li><p><del>Mutiprocessing Services</del> (<em>obsolete</em>)</p></li>
</ol>

<h1 id="toc_6">Inter-Thread Communication</h1>

<ol>
<li><p>Direct messageing</p></li>

<li><p>Global variables, shared memory &amp; objects</p></li>

<li><p>Conditions</p></li>

<li><p>Run loop sources</p></li>

<li><p>Ports &amp; sockets</p></li>

<li><p><del>Message queues</del> (<em>obsolete</em>)</p></li>

<li><p>Cocoa distributed objects</p></li>
</ol>

<h1 id="toc_7">Synchronization Tools</h1>

<ol>
<li><p>Atomic operation</p>

<ul>
<li><p>atomic add</p></li>

<li><p>atomic increment</p></li>

<li><p>atomic decrement</p></li>

<li><p>compare-and-swap</p></li>

<li><p>test-and-set</p></li>

<li><p>test-and-clear</p></li>
</ul></li>

<li><p>Memory barriers</p></li>

<li><p>Volatile variables</p></li>

<li><p>Locks</p>

<ul>
<li><p>Mutex</p>

<ul>
<li><p>POSIX API provides <code>pthread_lock_t</code></p></li>

<li><p>Cocoa provides <code>NSLock</code> &amp;  <code>@synchronized()</code></p></li>
</ul></li>

<li><p>Recursive lock</p>

<p>which is provided as class <code>NSRecursiveLock</code></p></li>

<li><p>Read-write lock (<em>pthread only</em>)</p></li>

<li><p>Distributed lock</p></li>

<li><p>Spin lock (<em>not implemented</em>)</p></li>

<li><p>Double-checked lock</p></li>
</ul></li>

<li><p>Conditions (aka <em>condition variable</em>)</p></li>

<li><p>Perform selector routines</p></li>
</ol>

      </div>
      
    </div>
  </div>

      
    <script src="/lib/mudox.js"></script>
</body>
</html>

